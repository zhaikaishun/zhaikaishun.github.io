<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8" >
    <meta name="baidu-site-verification" content="dIcXMeY8Ya" />
    
    <title>zookeeper的watch（原生API） | 挡路人</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" >
    <meta name="keywords" content="Jelon, 前端, Web, 张德龙, 前端开发" >
    <meta name="description" content="Jelon个人前端小站" >

    
    <link rel="alternative" href="/atom.xml" title="挡路人" type="application/atom+xml" >
    
    
    <link rel="shortcut icon" href="/favicon.ico" >
    
    <link rel="stylesheet" href="/css/style.css">
    <!--[if lt IE 9]>
    <script src="/js/html5.js"></script>
    <![endif]-->
    
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?fd459238242776d173cdc64918fb32f2";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</head>

<body class="home">
    <!--[if lt IE 9]>
    <div class="browsehappy">
        当前网页 <strong>不支持</strong>
        你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <!-- 博客头部 -->
    <header class="header">
    <section class="container header-main">
        <div class="logo">
            <a href="/">
                <div class="cover">
                    <span class="name">挡路人</span>
                    <span class="description">学有所思，思有所感</span>
                </div>
            </a>
        </div>
        <div class="dropnav icon-paragraph-justify" id="JELON__btnDropNav"></div>
        <ul class="menu hidden" id="JELON__menu">
            
            <li rel="/架构/zookeeper5.html" class="item ">
                <a href="/" title="首页" class="icon-home">&nbsp;首页</a>
            </li>
            
            <li rel="/架构/zookeeper5.html" class="item ">
                <a href="/lab/" title="实验室" class="icon-lab">&nbsp;实验室</a>
            </li>
            
            <li rel="/架构/zookeeper5.html" class="item ">
                <a href="/about/" title="关于" class="icon-about">&nbsp;关于</a>
            </li>
            
            <li rel="/架构/zookeeper5.html" class="item ">
                <a href="/comment/" title="留言" class="icon-comment">&nbsp;留言</a>
            </li>
            
        </ul>
        <div class="profile clearfix">
            <div class="feeds fl">
                
                
                <p class="links">
                    
                        <a href="https://github.com/jangdelong" target="_blank">Github</a>
                        |
                    
                        <a href="https://pages.coding.me" target="_blank">Hosted by Coding Pages</a>
                        
                    
                </p>
                <p class="sns">
                    
                        <a href="http://weibo.com/jangdelong" class="sinaweibo" target="_blank"><b>■</b> 新浪微博</a>
                    
                        <a href="https://www.facebook.com/profile.php?id=100011855760219&amp;ref=bookmarks" class="qqweibo" target="_blank"><b>■</b> Facebook</a>
                    
                    <a href="javascript: void(0);" class="wechat">
                        <b>■</b>
                        公众号
                        <span class="popover">
                            <img src="/img/wechat_mp.jpg" width="120" height="120" alt="我的微信订阅号">
                            <i class="arrow"></i>
                        </span>
                    </a>
                </p>
                
            </div>
            <div class="avatar fr">
                <img src="/img/jelon.jpg" alt="avatar" title="Jelon" >
            </div>
        </div>
    </section>
</header>


    <!-- 博客正文 -->
    <div class="container body clearfix">
        <section class="content">
            <div class="content-main widget">
                <!-- 文章页 -->
<!-- 文章 -->
<article class="post article">
    <header class="text-center">
        <h3 class="post-title"><span>zookeeper的watch（原生API）</span></h3>
    </header>
    <p class="post-meta text-center">
        kaishun 发表于
        <time datetime="2017-12-20T13:25:21.000Z">2017-12-20</time>
    </p>
    <div class="post-content">
	<!-- Table of Contents -->

        <p>github: <a href="https://github.com/zhaikaishun/zookeeper_tutorial" target="_blank" rel="external">https://github.com/zhaikaishun/zookeeper_tutorial</a></p>
<hr>
<h2 id="Zookeeper的watcher事件"><a href="#Zookeeper的watcher事件" class="headerlink" title="Zookeeper的watcher事件"></a>Zookeeper的watcher事件</h2><p>zookeeper有watch事件，是<strong>一次性触发</strong>的，当watch监视的数据发生变化时，通知设置了该watch的client，即watcher。<br>同样，其watcher是监听数据发生了某些变化，那就一定会有对应的事件类型，和状态类型。<br><a id="more"></a><br><strong>事件类型</strong>（znode节点相关的）  </p>
<ul>
<li>EventType.NodeCreated  </li>
<li>EventType.NodeDataChanged  </li>
<li>EventType.NodeChildrenChanged  </li>
<li>EventType.NodeDeleted<br><strong>状态类型：</strong>（是跟客户端实例相关的,简单的说就是客户端和服务器端连接状态相关的）    </li>
<li>KeeperState.Disconnected  </li>
<li>KeeperState.SyncConnected</li>
<li>KeeperState.AuthFailed  认证失败</li>
<li>KeeperState.Expired   过期  </li>
</ul>
<h2 id="watcher和watch"><a href="#watcher和watch" class="headerlink" title="watcher和watch"></a>watcher和watch</h2><p>简单的说，一个节点上的某个程序监控某个节点，那么这个节点上的这个程序就是一个watcher，而监听的这个事件（动作），就是一个watch。watch事件，是<strong>一次性触发</strong>的，只能监听一次，第二次对此节点的修改就监听不到了，如果想一直监听，大概有两种方案，一种是在出发事件后执行方法的时候有个watch的参数再设置为true，一种是这个时候再创建一个watch，这种是有点麻烦。<br>看一个例子吧：<br>最好是去github上下载下来自己运行一下。  </p>
<ul>
<li>设置watcher, 我这里每次create的时候，都设置了一下watcher，例如下面代码中 this.zk.exists(path, ifsetTrue);  </li>
<li>需要实现implements Watcher接口以及重写实现方法process，我这里监听比较简单。也就不多说了。  </li>
<li>反正是要注意，如果只设置一次监听，那么监听完之后，第二次就监听不到了。若需要多次监听，那么最好是再监听一次<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Zookeeper Wathcher </div><div class="line"> * 本类就是一个Watcher类（实现了org.apache.zookeeper.Watcher类）</div><div class="line"> * @author（alienware）</div><div class="line"> * @since 2015-6-14</div><div class="line"> */</div><div class="line">public class ZooKeeperWatcher implements Watcher &#123;</div><div class="line"></div><div class="line">	/** 定义原子变量 */</div><div class="line">	AtomicInteger seq = new AtomicInteger();</div><div class="line">	/** 定义session失效时间 */</div><div class="line">	private static final int SESSION_TIMEOUT = 10000;</div><div class="line">	/** zookeeper服务器地址 */</div><div class="line">	private static final String CONNECTION_ADDR = &quot;192.168.1.31:2181&quot;;</div><div class="line">	/** zk父路径设置 */</div><div class="line">	private static final String PARENT_PATH = &quot;/testWatch&quot;;</div><div class="line">	/** zk子路径设置 */</div><div class="line">	private static final String CHILDREN_PATH = &quot;/testWatch/children&quot;;</div><div class="line">	/** 进入标识 */</div><div class="line">	private static final String LOG_PREFIX_OF_MAIN = &quot;【Main】&quot;;</div><div class="line">	/** zk变量 */</div><div class="line">	private ZooKeeper zk = null;</div><div class="line">	/** 信号量设置，用于等待zookeeper连接建立之后 通知阻塞程序继续向下执行 */</div><div class="line">	private CountDownLatch connectedSemaphore = new CountDownLatch(1);</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 创建ZK连接</div><div class="line">	 * @param connectAddr ZK服务器地址列表</div><div class="line">	 * @param sessionTimeout Session超时时间</div><div class="line">	 */</div><div class="line">	public void createConnection(String connectAddr, int sessionTimeout) &#123;</div><div class="line">		this.releaseConnection();</div><div class="line">		try &#123;</div><div class="line">			zk = new ZooKeeper(connectAddr, sessionTimeout, this);</div><div class="line">			System.out.println(LOG_PREFIX_OF_MAIN + &quot;开始连接ZK服务器&quot;);</div><div class="line">			connectedSemaphore.await();</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 关闭ZK连接</div><div class="line">	 */</div><div class="line">	public void releaseConnection() &#123;</div><div class="line">		if (this.zk != null) &#123;</div><div class="line">			try &#123;</div><div class="line">				this.zk.close();</div><div class="line">			&#125; catch (InterruptedException e) &#123;</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 创建节点</div><div class="line">	 * @param path 节点路径</div><div class="line">	 * @param data 数据内容</div><div class="line">	 * @return </div><div class="line">	 */</div><div class="line">	public boolean createPath(String path, String data,boolean ifsetTrue) &#123;</div><div class="line">		try &#123;</div><div class="line">			//设置监控(由于zookeeper的监控都是一次性的所以 每次必须设置监控)</div><div class="line">			this.zk.exists(path, ifsetTrue);</div><div class="line">			System.out.println(LOG_PREFIX_OF_MAIN + &quot;节点创建成功, Path: &quot; + </div><div class="line">							   this.zk.create(	/**路径*/ </div><div class="line">									   			path, </div><div class="line">									   			/**数据*/</div><div class="line">									   			data.getBytes(), </div><div class="line">									   			/**所有可见*/</div><div class="line">								   				Ids.OPEN_ACL_UNSAFE, </div><div class="line">								   				/**永久存储*/</div><div class="line">								   				CreateMode.PERSISTENT ) + 	</div><div class="line">							   &quot;, content: &quot; + data);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">			return false;</div><div class="line">		&#125;</div><div class="line">		return true;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 读取指定节点数据内容</div><div class="line">	 * @param path 节点路径</div><div class="line">	 * @return</div><div class="line">	 */</div><div class="line">	public String readData(String path, boolean needWatch) &#123;</div><div class="line">		try &#123;</div><div class="line">			return new String(this.zk.getData(path, needWatch, null));</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">			return &quot;&quot;;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 更新指定节点数据内容</div><div class="line">	 * @param path 节点路径</div><div class="line">	 * @param data 数据内容</div><div class="line">	 * @return</div><div class="line">	 */</div><div class="line">	public boolean writeData(String path, String data) &#123;</div><div class="line">		try &#123;</div><div class="line">			System.out.println(LOG_PREFIX_OF_MAIN + &quot;更新数据成功，path：&quot; + path + &quot;, stat: &quot; +</div><div class="line">								this.zk.setData(path, data.getBytes(), -1));</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		return false;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 删除指定节点</div><div class="line">	 * </div><div class="line">	 * @param path</div><div class="line">	 *            节点path</div><div class="line">	 */</div><div class="line">	public void deleteNode(String path) &#123;</div><div class="line">		try &#123;</div><div class="line">			this.zk.delete(path, -1);</div><div class="line">			System.out.println(LOG_PREFIX_OF_MAIN + &quot;删除节点成功，path：&quot; + path);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 判断指定节点是否存在</div><div class="line">	 * @param path 节点路径</div><div class="line">	 */</div><div class="line">	public Stat exists(String path, boolean needWatch) &#123;</div><div class="line">		try &#123;</div><div class="line">			return this.zk.exists(path, needWatch);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 获取子节点</div><div class="line">	 * @param path 节点路径</div><div class="line">	 */</div><div class="line">	private List&lt;String&gt; getChildren(String path, boolean needWatch) &#123;</div><div class="line">		try &#123;</div><div class="line">			return this.zk.getChildren(path, needWatch);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 删除所有节点</div><div class="line">	 */</div><div class="line">	public void deleteAllTestPath() &#123;</div><div class="line">		if(this.exists(CHILDREN_PATH, false) != null)&#123;</div><div class="line">			this.deleteNode(CHILDREN_PATH);</div><div class="line">		&#125;</div><div class="line">		if(this.exists(PARENT_PATH, false) != null)&#123;</div><div class="line">			this.deleteNode(PARENT_PATH);</div><div class="line">		&#125;		</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	/**</div><div class="line">	 * 收到来自Server的Watcher通知后的处理。</div><div class="line">	 */</div><div class="line">	@Override</div><div class="line">	public void process(WatchedEvent event) &#123;</div><div class="line">		</div><div class="line">		System.out.println(&quot;进入 process 。。。。。event = &quot; + event);</div><div class="line">		</div><div class="line">		try &#123;</div><div class="line">			Thread.sleep(200);</div><div class="line">		&#125; catch (InterruptedException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		if (event == null) &#123;</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		// 连接状态</div><div class="line">		KeeperState keeperState = event.getState();</div><div class="line">		// 事件类型</div><div class="line">		EventType eventType = event.getType();</div><div class="line">		// 受影响的path</div><div class="line">		String path = event.getPath();</div><div class="line">		</div><div class="line">		String logPrefix = &quot;【Watcher-&quot; + this.seq.incrementAndGet() + &quot;】&quot;;</div><div class="line"></div><div class="line">		System.out.println(logPrefix + &quot;收到Watcher通知&quot;);</div><div class="line">		System.out.println(logPrefix + &quot;连接状态:\t&quot; + keeperState.toString());</div><div class="line">		System.out.println(logPrefix + &quot;事件类型:\t&quot; + eventType.toString());</div><div class="line"></div><div class="line">		if (KeeperState.SyncConnected == keeperState) &#123;</div><div class="line">			// 成功连接上ZK服务器</div><div class="line">			if (EventType.None == eventType) &#123;</div><div class="line">				System.out.println(logPrefix + &quot;成功连接上ZK服务器&quot;);</div><div class="line">				connectedSemaphore.countDown();</div><div class="line">			&#125; </div><div class="line">			//创建节点</div><div class="line">			else if (EventType.NodeCreated == eventType) &#123;</div><div class="line">				System.out.println(logPrefix + &quot;节点创建&quot;);</div><div class="line">				try &#123;</div><div class="line">					Thread.sleep(100);</div><div class="line">				&#125; catch (InterruptedException e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;</div><div class="line">				this.exists(path, true);</div><div class="line">			&#125; </div><div class="line">			//更新节点</div><div class="line">			else if (EventType.NodeDataChanged == eventType) &#123;</div><div class="line">				System.out.println(logPrefix + &quot;节点数据更新&quot;);</div><div class="line">				System.out.println(&quot;我看看走不走这里........&quot;);</div><div class="line">				try &#123;</div><div class="line">					Thread.sleep(100);</div><div class="line">				&#125; catch (InterruptedException e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;</div><div class="line">				System.out.println(logPrefix + &quot;数据内容: &quot; + this.readData(PARENT_PATH, true));</div><div class="line">			&#125; </div><div class="line">			//更新子节点</div><div class="line">			else if (EventType.NodeChildrenChanged == eventType) &#123;</div><div class="line">				System.out.println(logPrefix + &quot;子节点变更&quot;);</div><div class="line">				try &#123;</div><div class="line">					Thread.sleep(3000);</div><div class="line">				&#125; catch (InterruptedException e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;</div><div class="line">				System.out.println(logPrefix + &quot;子节点列表：&quot; + this.getChildren(PARENT_PATH, true));</div><div class="line">			&#125; </div><div class="line">			//删除节点</div><div class="line">			else if (EventType.NodeDeleted == eventType) &#123;</div><div class="line">				System.out.println(logPrefix + &quot;节点 &quot; + path + &quot; 被删除&quot;);</div><div class="line">			&#125;</div><div class="line">			else ;</div><div class="line">		&#125; </div><div class="line">		else if (KeeperState.Disconnected == keeperState) &#123;</div><div class="line">			System.out.println(logPrefix + &quot;与ZK服务器断开连接&quot;);</div><div class="line">		&#125; </div><div class="line">		else if (KeeperState.AuthFailed == keeperState) &#123;</div><div class="line">			System.out.println(logPrefix + &quot;权限检查失败&quot;);</div><div class="line">		&#125; </div><div class="line">		else if (KeeperState.Expired == keeperState) &#123;</div><div class="line">			System.out.println(logPrefix + &quot;会话失效&quot;);</div><div class="line">		&#125;</div><div class="line">		else ;</div><div class="line"></div><div class="line">		System.out.println(&quot;--------------------------------------------&quot;);</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * &lt;B&gt;方法名称：&lt;/B&gt;测试zookeeper监控&lt;BR&gt;</div><div class="line">	 * &lt;B&gt;概要说明：&lt;/B&gt;主要测试watch功能&lt;BR&gt;</div><div class="line">	 * @param args</div><div class="line">	 * @throws Exception</div><div class="line">	 */</div><div class="line">	public static void main(String[] args) throws Exception &#123;</div><div class="line"></div><div class="line">		//建立watcher</div><div class="line">		ZooKeeperWatcher zkWatch = new ZooKeeperWatcher();</div><div class="line">		//创建连接</div><div class="line">		zkWatch.createConnection(CONNECTION_ADDR, SESSION_TIMEOUT);</div><div class="line">		//System.out.println(zkWatch.zk.toString());</div><div class="line">		</div><div class="line">		Thread.sleep(1000);</div><div class="line">		</div><div class="line">		// 清理节点</div><div class="line">		zkWatch.deleteAllTestPath();</div><div class="line">		</div><div class="line">		if (zkWatch.createPath(PARENT_PATH, System.currentTimeMillis() + &quot;&quot;,true)) &#123;</div><div class="line">			</div><div class="line">			Thread.sleep(1000);</div><div class="line">			</div><div class="line">			</div><div class="line">			// 读取数据</div><div class="line">			System.out.println(&quot;---------------------- read parent ----------------------------&quot;);</div><div class="line">			//zkWatch.readData(PARENT_PATH, true);</div><div class="line">			</div><div class="line">			// 读取子节点</div><div class="line">			System.out.println(&quot;---------------------- read children path ----------------------------&quot;);</div><div class="line">			zkWatch.getChildren(PARENT_PATH, true);</div><div class="line"></div><div class="line">			// 更新数据</div><div class="line">			zkWatch.writeData(PARENT_PATH, System.currentTimeMillis() + &quot;&quot;);</div><div class="line">			</div><div class="line">			Thread.sleep(1000);</div><div class="line">			</div><div class="line">			// 创建子节点</div><div class="line">			zkWatch.createPath(CHILDREN_PATH, System.currentTimeMillis() + &quot;&quot;,true);</div><div class="line">			</div><div class="line">			Thread.sleep(1000);</div><div class="line">			</div><div class="line">			zkWatch.writeData(CHILDREN_PATH, System.currentTimeMillis() + &quot;&quot;);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		Thread.sleep(50000);</div><div class="line">		// 清理节点</div><div class="line">		zkWatch.deleteAllTestPath();</div><div class="line">		Thread.sleep(1000);</div><div class="line">		zkWatch.releaseConnection();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>输出就在这里了，想具体了解的话，自己敲一下，然后覆盖一下代码。一个一个功能的执行，查看功能即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line">【Main】开始连接ZK服务器</div><div class="line">进入 process 。。。。。event = WatchedEvent state:SyncConnected type:None path:null</div><div class="line">【Watcher-1】收到Watcher通知</div><div class="line">【Watcher-1】连接状态:	SyncConnected</div><div class="line">【Watcher-1】事件类型:	None</div><div class="line">【Watcher-1】成功连接上ZK服务器</div><div class="line">--------------------------------------------</div><div class="line">进入 process 。。。。。event = WatchedEvent state:SyncConnected type:NodeCreated path:/testWatch</div><div class="line">【Main】节点创建成功, Path: /testWatch, content: 1508077399368</div><div class="line">【Watcher-2】收到Watcher通知</div><div class="line">【Watcher-2】连接状态:	SyncConnected</div><div class="line">【Watcher-2】事件类型:	NodeCreated</div><div class="line">【Watcher-2】节点创建</div><div class="line">--------------------------------------------</div><div class="line">---------------------- read parent ----------------------------</div><div class="line">---------------------- read children path ----------------------------</div><div class="line">进入 process 。。。。。event = WatchedEvent state:SyncConnected type:NodeDataChanged path:/testWatch</div><div class="line">【Main】更新数据成功，path：/testWatch, stat: 30064771078,30064771079,1508071193606,1508071194762,1,0,0,0,13,0,30064771078</div><div class="line"></div><div class="line">【Watcher-3】收到Watcher通知</div><div class="line">【Watcher-3】连接状态:	SyncConnected</div><div class="line">【Watcher-3】事件类型:	NodeDataChanged</div><div class="line">【Watcher-3】节点数据更新</div><div class="line">我看看走不走这里........</div><div class="line">【Watcher-3】数据内容: 1508077400538</div><div class="line">--------------------------------------------</div><div class="line">进入 process 。。。。。event = WatchedEvent state:SyncConnected type:NodeCreated path:/testWatch/children</div><div class="line">【Main】节点创建成功, Path: /testWatch/children, content: 1508077401581</div><div class="line">【Watcher-4】收到Watcher通知</div><div class="line">【Watcher-4】连接状态:	SyncConnected</div><div class="line">【Watcher-4】事件类型:	NodeCreated</div><div class="line">【Watcher-4】节点创建</div><div class="line">--------------------------------------------</div><div class="line">进入 process 。。。。。event = WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/testWatch</div><div class="line">【Watcher-5】收到Watcher通知</div><div class="line">【Watcher-5】连接状态:	SyncConnected</div><div class="line">【Watcher-5】事件类型:	NodeChildrenChanged</div><div class="line">【Watcher-5】子节点变更</div><div class="line">【Main】更新数据成功，path：/testWatch/children, stat: 30064771080,30064771081,1508071195777,1508071196784,1,0,0,0,13,0,30064771080</div><div class="line"></div><div class="line">【Watcher-5】子节点列表：[children]</div><div class="line">--------------------------------------------</div><div class="line">进入 process 。。。。。event = WatchedEvent state:SyncConnected type:NodeDataChanged path:/testWatch/children</div><div class="line">【Watcher-6】收到Watcher通知</div><div class="line">【Watcher-6】连接状态:	SyncConnected</div><div class="line">【Watcher-6】事件类型:	NodeDataChanged</div><div class="line">【Watcher-6】节点数据更新</div><div class="line">我看看走不走这里........</div><div class="line">【Watcher-6】数据内容: 1508077400538</div><div class="line">--------------------------------------------</div><div class="line">进入 process 。。。。。event = WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/testWatch</div><div class="line">【Main】删除节点成功，path：/testWatch/children</div><div class="line">【Main】删除节点成功，path：/testWatch</div><div class="line">【Watcher-7】收到Watcher通知</div><div class="line">【Watcher-7】连接状态:	SyncConnected</div><div class="line">【Watcher-7】事件类型:	NodeChildrenChanged</div><div class="line">【Watcher-7】子节点变更</div><div class="line"></div><div class="line">```  </div><div class="line"></div><div class="line">## 实际应用一个场景  </div><div class="line">我们希望zookeeper对分布式系统的配置文件进行管理，也就是说多个服务器进行watcher,zookeeper节点发送变化，则我们实时更新配置文件。我们要完成多个应用服务器注册watcher，然后实时观察数据的变化，然后反馈给媒体服务器变更的数据信息，观察zookeeper节点</div><div class="line"></div><div class="line">下面是一个例子： 代码在bjsxt.zookeeper.cluster中  </div><div class="line">本例子模拟多台服务器同时监控一个节点。然后另外一个程序进行管理，所监控的这几台机器得到节点变更的通知。  </div><div class="line">本例中，Client1和Client2相当于两台服务器，共同watch一个节点。Test相当于管理者，用来管理这两个客户端的配置。  </div><div class="line">代码如下,具体的需要自己下载下来进行调试  </div><div class="line">Client1</div><div class="line">```java</div><div class="line">public class Client1 &#123;</div><div class="line"></div><div class="line">	public static void main(String[] args) throws Exception&#123;</div><div class="line">		</div><div class="line">		ZKWatcher myWatcher = new ZKWatcher();</div><div class="line">		Thread.sleep(100000000);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">```  </div><div class="line">Client2</div></pre></td></tr></table></figure></p>
<p>public class Client2 {</p>
<pre><code>public static void main(String[] args) throws Exception{

    ZKWatcher myWatcher = new ZKWatcher();
    Thread.sleep(100000000);
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div></pre></td><td class="code"><pre><div class="line">ZKWatcher</div><div class="line">```java</div><div class="line">public class ZKWatcher implements Watcher &#123;</div><div class="line"></div><div class="line">	/** zk变量 */</div><div class="line">	private ZooKeeper zk = null;</div><div class="line">	</div><div class="line">	/** 父节点path */</div><div class="line">	static final String PARENT_PATH = &quot;/super&quot;;</div><div class="line">	</div><div class="line">	/** 信号量设置，用于等待zookeeper连接建立之后 通知阻塞程序继续向下执行 */</div><div class="line">	private CountDownLatch connectedSemaphore = new CountDownLatch(1);</div><div class="line">	</div><div class="line">	private List&lt;String&gt; cowaList = new CopyOnWriteArrayList&lt;String&gt;();</div><div class="line">	</div><div class="line">	</div><div class="line">	/** zookeeper服务器地址 */</div><div class="line">	public static final String CONNECTION_ADDR = &quot;192.168.1.31:2181,192.168.1.32:2181,192.168.1.33:2181&quot;;</div><div class="line">	/** 定义session失效时间 */</div><div class="line">	public static final int SESSION_TIMEOUT = 30000;</div><div class="line">	</div><div class="line">	public ZKWatcher() throws Exception&#123;</div><div class="line">		zk = new ZooKeeper(CONNECTION_ADDR, SESSION_TIMEOUT, this);</div><div class="line">		System.out.println(&quot;开始连接ZK服务器&quot;);</div><div class="line">		connectedSemaphore.await();</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void process(WatchedEvent event) &#123;</div><div class="line">		// 连接状态</div><div class="line">		KeeperState keeperState = event.getState();</div><div class="line">		// 事件类型</div><div class="line">		EventType eventType = event.getType();</div><div class="line">		// 受影响的path</div><div class="line">		String path = event.getPath();</div><div class="line">		System.out.println(&quot;受影响的path : &quot; + path);</div><div class="line">		</div><div class="line">		</div><div class="line">		if (KeeperState.SyncConnected == keeperState) &#123;</div><div class="line">			// 成功连接上ZK服务器</div><div class="line">			if (EventType.None == eventType) &#123;</div><div class="line">				System.out.println(&quot;成功连接上ZK服务器&quot;);</div><div class="line">				connectedSemaphore.countDown();</div><div class="line">				try &#123;</div><div class="line">					if(this.zk.exists(PARENT_PATH, false) == null)&#123;</div><div class="line">						this.zk.create(PARENT_PATH, &quot;root&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);		 </div><div class="line">					&#125;</div><div class="line">					List&lt;String&gt; paths = this.zk.getChildren(PARENT_PATH, true);</div><div class="line">					for (String p : paths) &#123;</div><div class="line">						System.out.println(p);</div><div class="line">						this.zk.exists(PARENT_PATH + &quot;/&quot; + p, true);</div><div class="line">					&#125;</div><div class="line">				&#125; catch (KeeperException | InterruptedException e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;		</div><div class="line">			&#125; </div><div class="line">			//创建节点</div><div class="line">			else if (EventType.NodeCreated == eventType) &#123;</div><div class="line">				System.out.println(&quot;节点创建&quot;);</div><div class="line">				try &#123;</div><div class="line">					this.zk.exists(path, true);</div><div class="line">				&#125; catch (KeeperException | InterruptedException e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;</div><div class="line">			&#125; </div><div class="line">			//更新节点</div><div class="line">			else if (EventType.NodeDataChanged == eventType) &#123;</div><div class="line">				System.out.println(&quot;节点数据更新&quot;);</div><div class="line">				try &#123;</div><div class="line">					//update nodes  call function</div><div class="line">					this.zk.exists(path, true);</div><div class="line">				&#125; catch (KeeperException | InterruptedException e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;</div><div class="line">			&#125; </div><div class="line">			//更新子节点</div><div class="line">			else if (EventType.NodeChildrenChanged == eventType) &#123;</div><div class="line">				System.out.println(&quot;子节点 ... 变更&quot;);</div><div class="line">				try &#123;</div><div class="line">					List&lt;String&gt; paths = this.zk.getChildren(path, true);</div><div class="line">					if(paths.size() &gt;= cowaList.size())&#123;</div><div class="line">						paths.removeAll(cowaList);</div><div class="line">						for(String p : paths)&#123;</div><div class="line">							this.zk.exists(path + &quot;/&quot; + p, true);</div><div class="line">							//this.zk.getChildren(path + &quot;/&quot; + p, true);</div><div class="line">							System.out.println(&quot;这个是新增的子节点 : &quot; + path + &quot;/&quot; + p);</div><div class="line">							//add new nodes  call function</div><div class="line">						&#125;</div><div class="line">						cowaList.addAll(paths);</div><div class="line">					&#125; else &#123;</div><div class="line">						cowaList = paths;</div><div class="line">					&#125;</div><div class="line">					System.out.println(&quot;cowaList: &quot; + cowaList.toString());</div><div class="line">					System.out.println(&quot;paths: &quot; + paths.toString());</div><div class="line">					</div><div class="line">				&#125; catch (KeeperException | InterruptedException e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;</div><div class="line">			&#125; </div><div class="line">			//删除节点</div><div class="line">			else if (EventType.NodeDeleted == eventType) &#123;</div><div class="line">				System.out.println(&quot;节点 &quot; + path + &quot; 被删除&quot;);</div><div class="line">				try &#123;</div><div class="line">					//delete nodes  call function</div><div class="line">					this.zk.exists(path, true);</div><div class="line">				&#125; catch (KeeperException | InterruptedException e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			else ;</div><div class="line">		&#125; </div><div class="line">		else if (KeeperState.Disconnected == keeperState) &#123;</div><div class="line">			System.out.println(&quot;与ZK服务器断开连接&quot;);</div><div class="line">		&#125; </div><div class="line">		else if (KeeperState.AuthFailed == keeperState) &#123;</div><div class="line">			System.out.println(&quot;权限检查失败&quot;);</div><div class="line">		&#125; </div><div class="line">		else if (KeeperState.Expired == keeperState) &#123;</div><div class="line">			System.out.println(&quot;会话失效&quot;);</div><div class="line">		&#125;</div><div class="line">		else ;</div><div class="line"></div><div class="line">		System.out.println(&quot;--------------------------------------------&quot;);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Test<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line"></div><div class="line"></div><div class="line">	/** zookeeper地址 */</div><div class="line">	static final String CONNECT_ADDR = &quot;192.168.1.31:2181,192.168.1.32:2181,192.168.1.33:2181&quot;;</div><div class="line">	/** session超时时间 */</div><div class="line">	static final int SESSION_OUTTIME = 2000;//ms </div><div class="line">	/** 信号量，阻塞程序执行，用于等待zookeeper连接成功，发送成功信号 */</div><div class="line">	static final CountDownLatch connectedSemaphore = new CountDownLatch(1);</div><div class="line">	</div><div class="line">	public static void main(String[] args) throws Exception&#123;</div><div class="line">		</div><div class="line">		ZooKeeper zk = new ZooKeeper(CONNECT_ADDR, SESSION_OUTTIME, new Watcher()&#123;</div><div class="line">			@Override</div><div class="line">			public void process(WatchedEvent event) &#123;</div><div class="line">				//获取事件的状态</div><div class="line">				KeeperState keeperState = event.getState();</div><div class="line">				EventType eventType = event.getType();</div><div class="line">				//如果是建立连接</div><div class="line">				if(KeeperState.SyncConnected == keeperState)&#123;</div><div class="line">					if(EventType.None == eventType)&#123;</div><div class="line">						//如果建立连接成功，则发送信号量，让后续阻塞程序向下执行</div><div class="line">						connectedSemaphore.countDown();</div><div class="line">						System.out.println(&quot;zk 建立连接&quot;);</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		//进行阻塞</div><div class="line">		connectedSemaphore.await();</div><div class="line">		</div><div class="line">//		//创建子节点</div><div class="line">//		zk.create(&quot;/super/c1&quot;, &quot;c1&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</div><div class="line">		//创建子节点</div><div class="line">//		zk.create(&quot;/super/c2&quot;, &quot;c2&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</div><div class="line">		//创建子节点</div><div class="line">		String result = zk.create(&quot;/super/c3&quot;, &quot;c3&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</div><div class="line">		System.out.println(result);</div><div class="line">		//创建子节点</div><div class="line">//		zk.create(&quot;/super/c4&quot;, &quot;c4&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</div><div class="line">		</div><div class="line">//		zk.create(&quot;/super/c4/c44&quot;, &quot;c44&quot;.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</div><div class="line">		</div><div class="line">		//获取节点信息</div><div class="line">//		byte[] data = zk.getData(&quot;/testRoot&quot;, false, null);</div><div class="line">//		System.out.println(new String(data));</div><div class="line">//		System.out.println(zk.getChildren(&quot;/testRoot&quot;, false));</div><div class="line">		</div><div class="line">		//修改节点的值</div><div class="line">//		zk.setData(&quot;/super/c1&quot;, &quot;modify c1&quot;.getBytes(), -1);</div><div class="line">//		zk.setData(&quot;/super/c2&quot;, &quot;modify c2&quot;.getBytes(), -1);</div><div class="line">//		byte[] data = zk.getData(&quot;/super/c2&quot;, false, null);</div><div class="line">//		System.out.println(new String(data));		</div><div class="line">		</div><div class="line">//		//判断节点是否存在</div><div class="line">//		System.out.println(zk.exists(&quot;/super/c3&quot;, false));</div><div class="line">//		//删除节点</div><div class="line">//		zk.delete(&quot;/super/c3&quot;, -1);</div><div class="line"></div><div class="line">		zk.close();</div><div class="line">	</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>先启动Client1,client1打印<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">开始连接ZK服务器</div><div class="line">受影响的path : <span class="keyword">null</span></div><div class="line">成功连接上ZK服务器</div></pre></td></tr></table></figure></p>
<p>再启动Client2,<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">开始连接ZK服务器</div><div class="line">受影响的path : <span class="keyword">null</span></div><div class="line">成功连接上ZK服务器</div><div class="line">--------------------------------------------</div></pre></td></tr></table></figure></p>
<p>再启动Test类，此时Client1和Client2打印的内容是<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">开始连接ZK服务器</div><div class="line">受影响的path : <span class="keyword">null</span></div><div class="line">成功连接上ZK服务器</div><div class="line">--------------------------------------------  </div><div class="line">受影响的path : /<span class="keyword">super</span></div><div class="line">子节点 ... 变更</div><div class="line">这个是新增的子节点 : /<span class="keyword">super</span>/c3</div><div class="line">cowaList: [c3]</div><div class="line">paths: [c3]</div></pre></td></tr></table></figure></p>
<p>Test打印的内容是<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">zk 建立连接</div><div class="line">/<span class="keyword">super</span>/c3</div></pre></td></tr></table></figure></p>
<p>更多测试，需要自己来运行并且思考结果。这里只起抛砖引玉的作用  </p>

    </div>
    <p class="post-meta">
        <span class="post-cat">分类：
            <a class="cat-link" href="/categories/架构/">架构</a>
        </span>
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/zookeeper/" title="zookeeper">zookeeper</a>
    

        </span>
    </p>
</article>
<!-- 分享按钮 -->

  <div class="article-share clearfix text-center">
    <div class="share-area">
      <span class="share-txt">分享到：</span>
      <a href="javascript: window.open('http://service.weibo.com/share/share.php?url=' + encodeURIComponent(location.href) + '&title=' + document.title + '&language=zh_cn');" class="share-icon weibo"></a>
      <a href="javascript: alert('请复制链接到微信并发送');" class="share-icon wechat"></a>
      <a href="javascript: window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=' + encodeURIComponent(location.href) + '&title=' + document.title);" class="share-icon qqzone"></a>
      <a href="javascript: window.open('http://connect.qq.com/widget/shareqq/index.html?url=' + encodeURIComponent(location.href) + '&desc=Jelon个人博客&title=' + document.title + '&callback=' + encodeURIComponent(location.href));" class="share-icon qq"></a>
      <a href="javascript: window.open('http://shuo.douban.com/!service/share?href=' + encodeURIComponent(location.href) + '&name=' + document.title + '&text=' + document.title);" class="share-icon douban"></a>
    </div>
  </div>


<!-- 上一篇/下一篇 -->

<div class="article-nav clearfix">
    
    <span class="prev fl">
        上一篇<br >
        <a href="/架构/zookeeper6.html">
            
                zookeeper分布式锁思路（无代码）
            
        </a>
    </span>
    

    
    <span class="next fr">
        下一篇<br >
        <a href="/架构/zookeeper4.html">
            
                操作zookeeper之原生API的基本操作
            
        </a>
    </span>
    
</div>

<!-- 文章评论 -->

  <script src="/js/comment.js"></script>
  <div id="comments" class="comment">
    <!--
    <div class="sign-bar">
      GitHub 已登录!
      <span class="sign-link">登出</span>
    </div>
    <section class="box">
      <div class="com-avatar"><img src="/img/jelon.jpg" alt="avatar"></div>
      <div class="com-text">
        <div class="main">
          <textarea class="text-area-edited show" placeholder="欢迎评论！"></textarea>
          <div class="text-area-preview"></div>
        </div>
        <div class="switch">
          <div class="switch-item on">编辑</div>
          <div class="switch-item">预览</div>
        </div>
        <div class="button">提交</div>
      </div>
    </section>
    <section class="tips">注：评论支持 markdown 语法！</section>
    <section class="list-wrap">
      <ul class="list">
        <li>
          <div class="user-avatar">
            <a href="/">
              <img src="/img/jelon.jpg" alt="user-avatar">
            </a>
          </div>
          <div class="user-comment">
            <div class="user-comment-header">
              <span class="post-name">张德龙</span>
              <span class="post-time">2017年12月12日</span>
              <span class="like liked">已赞</span>
              <span class="like-num">2</span>
            </div>
            <div class="user-comment-body">333333</div>
          </div>
        </li>
        <li>
          <div class="user-avatar">
            <a href="/">
              <img src="/img/jelon.jpg" alt="user-avatar">
            </a>
          </div>
          <div class="user-comment">
            <div class="user-comment-header">
              <span class="post-name">刘德华</span>
              <span class="post-time">2017年12月12日</span>
              <span class="like">点赞</span>
              <span class="like-num">2</span>
            </div>
            <div class="user-comment-body">vvvvv</div>
          </div>
        </li>
      </ul>
      <div class="page-nav">
        <a href="javascript: void(0);" class="item">1</a>
        <a href="javascript: void(0);" class="item">2</a>
        <a href="javascript: void(0);" class="item current">3</a>
      </div>
    </section>
    -->
  </div>
  <script>
  JELON.Comment({
    container: 'comments',
    label: 'zookeeper5' || '架构/zookeeper5.html',
    owner: 'jangdelong',
    repo: 'blog_comments',
    clientId: 'b08ed25e52c57993e69c',
    clientSecret: '1cb9545488f0380904b87350e7c5a270ae03bab7'
  });
  </script>


            </div>

        </section>
        <!-- 侧栏部分 -->
<aside class="sidebar">
    <section class="widget">
        <h3 class="widget-hd"><strong>文章分类</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
    <li>
        <a href="/categories/hadoop/">大数据</a>
        <span class="badge">(43)</span>
    </li>
    
    <li>
        <a href="/categories/linux/">linux</a>
        <span class="badge">(5)</span>
    </li>
    
    <li>
        <a href="/categories/hadoop/hdfs/">hdfs</a>
        <span class="badge">(8)</span>
    </li>
    
    <li>
        <a href="/categories/hadoop/hadoop/">hadoop</a>
        <span class="badge">(11)</span>
    </li>
    
    <li>
        <a href="/categories/programme/">programme</a>
        <span class="badge">(12)</span>
    </li>
    
    <li>
        <a href="/categories/Linux/">Linux</a>
        <span class="badge">(2)</span>
    </li>
    
    <li>
        <a href="/categories/架构/">架构</a>
        <span class="badge">(21)</span>
    </li>
    
    <li>
        <a href="/categories/hadoop/spark/">spark</a>
        <span class="badge">(23)</span>
    </li>
    
    <li>
        <a href="/categories/算法/">算法</a>
        <span class="badge">(3)</span>
    </li>
    
    <li>
        <a href="/categories/随笔/">随笔</a>
        <span class="badge">(2)</span>
    </li>
    
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-hd"><strong>热门标签</strong></h3>
        <!-- 文章标签 -->
<div class="widget-bd tag-wrap">
  
    <a class="tag-item" href="/tags/大数据/" title="大数据">大数据 (4)</a>
  
    <a class="tag-item" href="/tags/hadoop/" title="hadoop">hadoop (11)</a>
  
    <a class="tag-item" href="/tags/yarn/" title="yarn">yarn (2)</a>
  
    <a class="tag-item" href="/tags/linux/" title="linux">linux (7)</a>
  
    <a class="tag-item" href="/tags/hdfs/" title="hdfs">hdfs (8)</a>
  
    <a class="tag-item" href="/tags/java/" title="java">java (15)</a>
  
    <a class="tag-item" href="/tags/JDBC/" title="JDBC">JDBC (1)</a>
  
    <a class="tag-item" href="/tags/工具类/" title="工具类">工具类 (1)</a>
  
    <a class="tag-item" href="/tags/crontab/" title="crontab">crontab (1)</a>
  
    <a class="tag-item" href="/tags/Netty/" title="Netty">Netty (2)</a>
  
    <a class="tag-item" href="/tags/netty/" title="netty">netty (1)</a>
  
    <a class="tag-item" href="/tags/spark/" title="spark">spark (23)</a>
  
    <a class="tag-item" href="/tags/架构/" title="架构">架构 (1)</a>
  
    <a class="tag-item" href="/tags/算法/" title="算法">算法 (3)</a>
  
    <a class="tag-item" href="/tags/Hexo/" title="Hexo">Hexo (1)</a>
  
    <a class="tag-item" href="/tags/hive/" title="hive">hive (1)</a>
  
    <a class="tag-item" href="/tags/曲线拟合/" title="曲线拟合">曲线拟合 (1)</a>
  
    <a class="tag-item" href="/tags/io/" title="io">io (1)</a>
  
    <a class="tag-item" href="/tags/scala/" title="scala">scala (3)</a>
  
    <a class="tag-item" href="/tags/zookeeper/" title="zookeeper">zookeeper (9)</a>
  
    <a class="tag-item" href="/tags/随笔/" title="随笔">随笔 (2)</a>
  
    <a class="tag-item" href="/tags/剑指向offer/" title="剑指向offer">剑指向offer (1)</a>
  
    <a class="tag-item" href="/tags/笔试题/" title="笔试题">笔试题 (1)</a>
  
    <a class="tag-item" href="/tags/动态规划/" title="动态规划">动态规划 (1)</a>
  
    <a class="tag-item" href="/tags/数学/" title="数学">数学 (1)</a>
  
    <a class="tag-item" href="/tags/Exception/" title="Exception">Exception (1)</a>
  
    <a class="tag-item" href="/tags/xml解析/" title="xml解析">xml解析 (1)</a>
  
    <a class="tag-item" href="/tags/资源/" title="资源">资源 (1)</a>
  
</div>
    </section>
    

    

    
    <!-- 友情链接 -->
    <section class="widget">
        <h3 class="widget-hd"><strong>友情链接</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
        <li>
            <a href="http://blog.sina.com.cn/u/1825875765" target="_blank" title="网络安全博客">Haoren博客</a>
        </li>
    
        <li>
            <a href="http://blog.csdn.net/yeweiouyang" target="_blank" title="技术博客">Maxwell博客</a>
        </li>
    
        <li>
            <a href="http://xuanzh.cc/" target="_blank" title="技术博客">朱旋个人博客</a>
        </li>
    
</ul>
    </section>
    
</aside>
<!-- / 侧栏部分 -->
    </div>

    <!-- 博客底部 -->
    <footer class="footer">
    &copy;
    
        2016-2018
    

    <a href="/">Jelon Loves You</a>
</footer>
<div class="back-to-top" id="JELON__backToTop" title="返回顶部">返回顶部</div>

    <!--博客js脚本 -->
    <!-- 这里放网站js脚本 -->
<script src="/js/main.js"></script>
</body>
</html>