<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8" >
    <meta name="baidu-site-verification" content="dIcXMeY8Ya" />
    
    <title>文章归档: 2017/3 | 挡路人</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" >
    <meta name="keywords" content="Jelon, 前端, Web, 张德龙, 前端开发" >
    <meta name="description" content="Jelon个人前端小站" >

    
    <link rel="alternative" href="/atom.xml" title="挡路人" type="application/atom+xml" >
    
    
    <link rel="shortcut icon" href="/favicon.ico" >
    
    <link rel="stylesheet" href="/css/style.css">
    <!--[if lt IE 9]>
    <script src="/js/html5.js"></script>
    <![endif]-->
    
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?fd459238242776d173cdc64918fb32f2";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</head>

<body class="home">
    <!--[if lt IE 9]>
    <div class="browsehappy">
        当前网页 <strong>不支持</strong>
        你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <!-- 博客头部 -->
    <header class="header">
    <section class="container header-main">
        <div class="logo">
            <a href="/">
                <div class="cover">
                    <span class="name">挡路人</span>
                    <span class="description">学有所思，思有所感</span>
                </div>
            </a>
        </div>
        <div class="dropnav icon-paragraph-justify" id="JELON__btnDropNav"></div>
        <ul class="menu hidden" id="JELON__menu">
            
            <li rel="/archives/2017/03/index.html" class="item ">
                <a href="/" title="首页" class="icon-home">&nbsp;首页</a>
            </li>
            
            <li rel="/archives/2017/03/index.html" class="item ">
                <a href="/lab/" title="实验室" class="icon-lab">&nbsp;实验室</a>
            </li>
            
            <li rel="/archives/2017/03/index.html" class="item ">
                <a href="/about/" title="关于" class="icon-about">&nbsp;关于</a>
            </li>
            
            <li rel="/archives/2017/03/index.html" class="item ">
                <a href="/comment/" title="留言" class="icon-comment">&nbsp;留言</a>
            </li>
            
        </ul>
        <div class="profile clearfix">
            <div class="feeds fl">
                
                
                <p class="links">
                    
                        <a href="https://github.com/jangdelong" target="_blank">Github</a>
                        |
                    
                        <a href="https://pages.coding.me" target="_blank">Hosted by Coding Pages</a>
                        
                    
                </p>
                <p class="sns">
                    
                        <a href="http://weibo.com/jangdelong" class="sinaweibo" target="_blank"><b>■</b> 新浪微博</a>
                    
                        <a href="https://www.facebook.com/profile.php?id=100011855760219&amp;ref=bookmarks" class="qqweibo" target="_blank"><b>■</b> Facebook</a>
                    
                    <a href="javascript: void(0);" class="wechat">
                        <b>■</b>
                        公众号
                        <span class="popover">
                            <img src="/img/wechat_mp.jpg" width="120" height="120" alt="我的微信订阅号">
                            <i class="arrow"></i>
                        </span>
                    </a>
                </p>
                
            </div>
            <div class="avatar fr">
                <img src="/img/jelon.jpg" alt="avatar" title="Jelon" >
            </div>
        </div>
    </section>
</header>


    <!-- 博客正文 -->
    <div class="container body clearfix">
        <section class="content">
            <div class="content-main widget">
                <!-- 文章归档 -->

    <h3 class="widget-hd">
        <strong>
            
                文章归档
            
        </strong>
    </h3>
    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-9.html">
    		spark RDD算子（九）之基本的Action操作 first, take, collect, count, countByValue, reduce, aggregate, fold,top
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-28T13:25:21.000Z">2017-03-28</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="first"><a href="#first" class="headerlink" title="first"></a><strong>first</strong></h1><p>返回第一个元素<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.first()</div><div class="line">res1: <span class="type">Int</span> = <span class="number">1</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>));</div><div class="line">Integer first = rdd.first();</div></pre></td></tr></table></figure></p>
<h1 id="take"><a href="#take" class="headerlink" title="take"></a><strong>take</strong></h1><p>rdd.take(n)返回第n个元素<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.take(<span class="number">2</span>)</div><div class="line">res3: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>));</div><div class="line">List&lt;Integer&gt; take = rdd.take(<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<h1 id="collect"><a href="#collect" class="headerlink" title="collect"></a><strong>collect</strong></h1><p>rdd.collect() 返回 RDD 中的所有元素<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.collect()</div><div class="line">res4: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>));</div><div class="line">List&lt;Integer&gt; collect = rdd.collect();</div></pre></td></tr></table></figure></p>
<h1 id="count"><a href="#count" class="headerlink" title="count"></a><strong>count</strong></h1><p>rdd.count() 返回 RDD 中的元素个数<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.count()</div><div class="line">res5: <span class="type">Long</span> = <span class="number">4</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>));</div><div class="line"><span class="keyword">long</span> count = rdd.count();</div></pre></td></tr></table></figure></p>
<h1 id="countByValue"><a href="#countByValue" class="headerlink" title="countByValue"></a><strong>countByValue</strong></h1><p>各元素在 RDD 中出现的次数 返回{(key1,次数),(key2,次数),…(keyn,次数)}<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.countByValue()</div><div class="line">res6: scala.collection.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">Long</span>] = <span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="number">1</span>, <span class="number">2</span> -&gt; <span class="number">1</span>, <span class="number">3</span> -&gt; <span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>));</div><div class="line">Map&lt;Integer, Long&gt; integerLongMap = rdd.countByValue();</div></pre></td></tr></table></figure></p>
<h1 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a><strong>reduce</strong></h1><p>rdd.reduce(func)<br>并行整合RDD中所有数据， 类似于是scala中集合的reduce<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.reduce((x,y)=&gt;x+y)</div><div class="line">res7: <span class="type">Int</span> = <span class="number">9</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Integer reduce = rdd.reduce(<span class="keyword">new</span> Function2&lt;Integer, Integer, Integer&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">(Integer integer, Integer integer2)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">return</span> integer + integer2;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h1 id="aggregate"><a href="#aggregate" class="headerlink" title="aggregate"></a><strong>aggregate</strong></h1><p>和 reduce() 相 似， 但 是 通 常<br>返回不同类型的函数  一般不用这个函数</p>
<p><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"><span class="type">TODO</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h1 id="fold"><a href="#fold" class="headerlink" title="fold"></a><strong>fold</strong></h1><p>rdd.fold(num)(func) 一般不用这个函数<br>和 reduce() 一 样， 但是提供了初始值num,每个元素计算时，先要合这个初始值进行折叠, 注意，这里会按照每个分区进行fold，然后分区之间还会再次进行fold<br>提供初始值<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 解释 TODO </span></div><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>)，<span class="number">2</span>)</div><div class="line"></div><div class="line">scala&gt; rdd.fold(<span class="number">1</span>)((x,y)=&gt;x+y)</div><div class="line">res8: <span class="type">Int</span> = <span class="number">12</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">    JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>),<span class="number">2</span>);</div><div class="line">    Integer fold = rdd.fold(<span class="number">1</span>, <span class="keyword">new</span> Function2&lt;Integer, Integer, Integer&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">(Integer integer, Integer integer2)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">            <span class="keyword">return</span> integer + integer2;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    System.out.println(fold);</div><div class="line">-------输出-----</div><div class="line"><span class="number">12</span></div></pre></td></tr></table></figure></p>
<h1 id="top"><a href="#top" class="headerlink" title="top"></a><strong>top</strong></h1><p>rdd.top(n)<br>按照降序的或者指定的排序规则，返回前n个元素<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.top(<span class="number">2</span>)</div><div class="line">res9: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">3</span>, <span class="number">3</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>),<span class="number">2</span>);</div><div class="line">List&lt;Integer&gt; top = rdd.top(<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<h1 id="takeOrdered"><a href="#takeOrdered" class="headerlink" title="takeOrdered"></a><strong>takeOrdered</strong></h1><p>rdd.take(n)<br>对RDD元素进行升序排序,取出前n个元素并返回，也可以自定义比较器（这里不介绍），类似于top的相反的方法<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.takeOrdered(<span class="number">2</span>)</div><div class="line">res10: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>),<span class="number">2</span>);</div><div class="line">List&lt;Integer&gt; integers = rdd.takeOrdered(<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<h1 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a><strong>foreach</strong></h1><p>对 RDD 中的每个元素使用给<br>定的函数<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line">    rdd.foreach(print(_))</div><div class="line">-----输出-----------</div><div class="line"><span class="number">1233</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">rdd.foreach(<span class="keyword">new</span> VoidFunction&lt;Integer&gt;() &#123;</div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">       System.out.println(integer);</div><div class="line">   &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-9.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-9.html" title="spark RDD算子（九）之基本的Action操作 first, take, collect, count, countByValue, reduce, aggregate, fold,top">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/8.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-8.html">
    		spark RDD算子（八）之键值对关联操作 subtractByKey, join, rightOuterJoin, leftOuterJoin
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-18T13:25:21.000Z">2017-03-18</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>先从spark-learning中的一张图大致了解其功能<br><img src="http://i1.piimg.com/567571/1ccee438414f9c6f.png" alt=""></p>
<h1 id="subtractByKey"><a href="#subtractByKey" class="headerlink" title="subtractByKey"></a><strong>subtractByKey</strong></h1><p><strong>函数定义</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">def subtractByKey[W](other: RDD[(K, W)])(implicit arg0: ClassTag[W]): RDD[(K, V)]</div><div class="line"></div><div class="line">def subtractByKey[W](other: RDD[(K, W)], numPartitions: Int)(implicit arg0: ClassTag[W]): RDD[(K, V)]</div><div class="line"></div><div class="line">def subtractByKey[W](other: RDD[(K, W)], p: Partitioner)(implicit arg0: ClassTag[W]): RDD[(K, V)]</div></pre></td></tr></table></figure></p>
<p>类似于subtrac，删掉 RDD 中键与 other RDD 中的键相同的元素</p>
<h1 id="join"><a href="#join" class="headerlink" title="join"></a><strong>join</strong></h1><p><strong>函数定义</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">def join[W](other: RDD[(K, W)]): RDD[(K, (V, W))]</div><div class="line"></div><div class="line">def join[W](other: RDD[(K, W)], numPartitions: Int): RDD[(K, (V, W))]</div><div class="line"></div><div class="line">def join[W](other: RDD[(K, W)], partitioner: Partitioner): RDD[(K, (V, W))]</div></pre></td></tr></table></figure></p>
<p>RDD1.join(RDD2)<br>可以把RDD1,RDD2中的相同的key给连接起来，类似于sql中的join操作  </p>
<h1 id="leftOuterJoin"><a href="#leftOuterJoin" class="headerlink" title="leftOuterJoin"></a><strong>leftOuterJoin</strong></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">def leftOuterJoin[W](other: RDD[(K, W)]): RDD[(K, (V, Option[W]))]</div><div class="line"></div><div class="line">def leftOuterJoin[W](other: RDD[(K, W)], numPartitions: Int): RDD[(K, (V, Option[W]))]</div><div class="line"></div><div class="line">def leftOuterJoin[W](other: RDD[(K, W)], partitioner: Partitioner): RDD[(K, (V, Option[W]))]</div><div class="line">```  </div><div class="line">直接看图即可 </div><div class="line">对两个 RDD 进行连接操作，类似于sql中的左外连接</div><div class="line"># **rightOuterJoin**</div><div class="line">对两个 RDD 进行连接操作，类似于sql中的右外连接，存在的话，value用的Some, 不存在用的None,具体的看上面的图和下面的代码即可  </div><div class="line"></div><div class="line"># **代码示例**</div><div class="line"></div><div class="line">**scala语言**</div><div class="line">```scala  </div><div class="line">    scala&gt; val rdd = sc.makeRDD(Array((<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">4</span>),(<span class="number">3</span>,<span class="number">6</span>)))</div><div class="line">    scala&gt; val other = sc.makeRDD(Array((<span class="number">3</span>,<span class="number">9</span>)))</div><div class="line">    </div><div class="line">    scala&gt;  rdd.subtractByKey(other).collect()</div><div class="line">    res0: Array[(Int, Int)] = Array((<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">    </div><div class="line">    scala&gt; rdd.join(other).collect()</div><div class="line">    res1: Array[(Int, (Int, Int))] = Array((<span class="number">3</span>,(<span class="number">4</span>,<span class="number">9</span>)), (<span class="number">3</span>,(<span class="number">6</span>,<span class="number">9</span>)))</div><div class="line">    </div><div class="line">    scala&gt; rdd.leftOuterJoin(other).collect()</div><div class="line">    res2: Array[(Int, (Int, Option[Int]))] = Array((<span class="number">1</span>,(<span class="number">2</span>,None)), (<span class="number">3</span>,(<span class="number">4</span>,Some(<span class="number">9</span>))), (<span class="number">3</span>,(<span class="number">6</span>,Some(<span class="number">9</span>))))</div><div class="line">    </div><div class="line">    scala&gt; rdd.rightOuterJoin(other).collect()</div><div class="line">    res3: Array[(Int, (Option[Int], Int))] = Array((<span class="number">3</span>,(Some(<span class="number">4</span>),<span class="number">9</span>)), (<span class="number">3</span>,(Some(<span class="number">6</span>),<span class="number">9</span>)))</div></pre></td></tr></table></figure>
<p><strong>java语言</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">   JavaRDD&lt;Tuple2&lt;Integer,Integer&gt;&gt; rddPre = sc.parallelize(Arrays.asList(<span class="keyword">new</span> Tuple2(<span class="number">1</span>,<span class="number">2</span>)</div><div class="line">           , <span class="keyword">new</span> Tuple2(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">           , <span class="keyword">new</span> Tuple2(<span class="number">3</span>,<span class="number">6</span>)));</div><div class="line">   JavaRDD&lt;Tuple2&lt;Integer,Integer&gt;&gt; otherPre = sc.parallelize(Arrays.asList(<span class="keyword">new</span> Tuple2(<span class="number">3</span>,<span class="number">10</span>)));</div><div class="line"></div><div class="line"><span class="comment">//JavaRDD转换成JavaPairRDD</span></div><div class="line">   JavaPairRDD&lt;Integer, Integer&gt; rdd = JavaPairRDD.fromJavaRDD(rddPre);</div><div class="line">   JavaPairRDD&lt;Integer, Integer&gt; other = JavaPairRDD.fromJavaRDD(otherPre);</div><div class="line">   <span class="comment">//subtractByKey</span></div><div class="line">   JavaPairRDD&lt;Integer, Integer&gt; subRDD = rdd.subtractByKey(other);</div><div class="line">   </div><div class="line">   <span class="comment">//join</span></div><div class="line">   JavaPairRDD&lt;Integer, Tuple2&lt;Float, Integer&gt;&gt; joinRDD =  rdd.join(other);</div><div class="line">   </div><div class="line">   <span class="comment">//leftOuterJoin</span></div><div class="line">   JavaPairRDD&lt;Integer, Tuple2&lt;Integer, Optional&lt;Integer&gt;&gt;&gt; integerTuple2JavaPairRDD = rdd.leftOuterJoin(other);</div><div class="line">   </div><div class="line">   <span class="comment">//rightOutJoin</span></div><div class="line">   JavaPairRDD&lt;Integer, Tuple2&lt;Optional&lt;Integer&gt;, Integer&gt;&gt; rightOutJoin = rdd.rightOuterJoin(other);</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-8.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-8.html" title="spark RDD算子（八）之键值对关联操作 subtractByKey, join, rightOuterJoin, leftOuterJoin">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/8.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-7.html">
    		spark RDD算子（七）之键值对分组操作 groupByKey，cogroup
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-07T13:25:21.000Z">2017-03-07</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="groupByKey"><a href="#groupByKey" class="headerlink" title="groupByKey"></a><strong>groupByKey</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">def groupByKey(): RDD[(K, Iterable[V])]</div><div class="line"></div><div class="line">def groupByKey(numPartitions: Int): RDD[(K, Iterable[V])]</div><div class="line"></div><div class="line">def groupByKey(partitioner: Partitioner): RDD[(K, Iterable[V])]</div></pre></td></tr></table></figure>
<p>groupByKey会将RDD[key,value] 按照相同的key进行分组，形成RDD[key,Iterable[value]]的形式， 有点类似于sql中的groupby，例如类似于mysql中的group_concat<br>例如这个例子， 我们对学生的成绩进行分组<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">val</span> scoreDetail = sc.parallelize(<span class="type">List</span>((<span class="string">"xiaoming"</span>,<span class="number">75</span>),(<span class="string">"xiaoming"</span>,<span class="number">90</span>),(<span class="string">"lihua"</span>,<span class="number">95</span>),(<span class="string">"lihua"</span>,<span class="number">100</span>),(<span class="string">"xiaofeng"</span>,<span class="number">85</span>)))</div><div class="line">    scoreDetail.groupByKey().collect().foreach(println(_));</div><div class="line">    <span class="comment">/*输出</span></div><div class="line"><span class="comment">(lihua,CompactBuffer(95, 100))</span></div><div class="line"><span class="comment">(xiaoming,CompactBuffer(75, 90))</span></div><div class="line"><span class="comment">(xiaofeng,CompactBuffer(85))</span></div><div class="line"><span class="comment">    */</span></div></pre></td></tr></table></figure></p>
<p><strong>java版本</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Tuple2&lt;String,Float&gt;&gt; scoreDetails = sc.parallelize(Arrays.asList(<span class="keyword">new</span> Tuple2(<span class="string">"xiaoming"</span>, <span class="number">75</span>)</div><div class="line">        , <span class="keyword">new</span> Tuple2(<span class="string">"xiaoming"</span>, <span class="number">90</span>)</div><div class="line">        , <span class="keyword">new</span> Tuple2(<span class="string">"lihua"</span>, <span class="number">95</span>)</div><div class="line">        , <span class="keyword">new</span> Tuple2(<span class="string">"lihua"</span>, <span class="number">188</span>)));</div><div class="line"><span class="comment">//将JavaRDD&lt;Tuple2&lt;String,Float&gt;&gt; 类型转换为 JavaPairRDD&lt;String, Float&gt;</span></div><div class="line">JavaPairRDD&lt;String, Float&gt; scoreMapRDD = JavaPairRDD.fromJavaRDD(scoreDetails);</div><div class="line">Map&lt;String, Iterable&lt;Float&gt;&gt; resultMap = scoreMapRDD.groupByKey().collectAsMap();</div><div class="line"><span class="keyword">for</span> (String key:resultMap.keySet()) &#123;</div><div class="line">    System.out.println(<span class="string">"("</span>+key+<span class="string">", "</span>+resultMap.get(key)+<span class="string">")"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="cogroup"><a href="#cogroup" class="headerlink" title="cogroup"></a><strong>cogroup</strong></h1><p>groupByKey是对单个 RDD 的数据进行分组，还可以使用一个叫作 cogroup() 的函数对多个共享同一个键的 RDD 进行分组<br>例如<br>RDD1.cogroup(RDD2) 会将RDD1和RDD2按照相同的key进行分组，得到(key,RDD[key,Iterable[value1],Iterable[value2]])的形式<br>cogroup也可以多个进行分组<br>例如RDD1.cogroup(RDD2,RDD3,…RDDN), 可以得到(key,Iterable[value1],Iterable[value2],Iterable[value3],…,Iterable[valueN])<br>案例,scoreDetail存放的是学生的优秀学科的分数，scoreDetai2存放的是刚刚及格的分数，scoreDetai3存放的是没有及格的科目的分数，我们要对每一个学生的优秀学科，刚及格和不及格的分数给分组统计出来<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> scoreDetail = sc.parallelize(<span class="type">List</span>((<span class="string">"xiaoming"</span>,<span class="number">95</span>),(<span class="string">"xiaoming"</span>,<span class="number">90</span>),(<span class="string">"lihua"</span>,<span class="number">95</span>),(<span class="string">"lihua"</span>,<span class="number">98</span>),(<span class="string">"xiaofeng"</span>,<span class="number">97</span>)))</div><div class="line">scala&gt; <span class="keyword">val</span> scoreDetai2 = sc.parallelize(<span class="type">List</span>((<span class="string">"xiaoming"</span>,<span class="number">65</span>),(<span class="string">"lihua"</span>,<span class="number">63</span>),(<span class="string">"lihua"</span>,<span class="number">62</span>),(<span class="string">"xiaofeng"</span>,<span class="number">67</span>)))</div><div class="line">scala&gt; <span class="keyword">val</span> scoreDetai3 = sc.parallelize(<span class="type">List</span>((<span class="string">"xiaoming"</span>,<span class="number">25</span>),(<span class="string">"xiaoming"</span>,<span class="number">15</span>),(<span class="string">"lihua"</span>,<span class="number">35</span>),(<span class="string">"lihua"</span>,<span class="number">28</span>),(<span class="string">"xiaofeng"</span>,<span class="number">36</span>)))</div><div class="line">scala&gt; scoreDetail.cogroup(scoreDetai2,scoreDetai3)</div><div class="line"></div><div class="line"><span class="comment">//输出</span></div><div class="line">res1: <span class="type">Array</span>[(<span class="type">String</span>, (<span class="type">Iterable</span>[<span class="type">Int</span>], <span class="type">Iterable</span>[<span class="type">Int</span>], <span class="type">Iterable</span>[<span class="type">Int</span>]))] = <span class="type">Array</span>((xiaoming,(<span class="type">CompactBuffer</span>(<span class="number">95</span>, <span class="number">90</span>),<span class="type">CompactBuffer</span>(<span class="number">65</span>),<span class="type">CompactBuffer</span>(<span class="number">25</span>, <span class="number">15</span>))), (lihua,(<span class="type">CompactBuffer</span>(<span class="number">95</span>, <span class="number">98</span>),<span class="type">CompactBuffer</span>(<span class="number">63</span>, <span class="number">62</span>),<span class="type">CompactBuffer</span>(<span class="number">35</span>, <span class="number">28</span>))), (xiaofeng,(<span class="type">CompactBuffer</span>(<span class="number">97</span>),<span class="type">CompactBuffer</span>(<span class="number">67</span>),<span class="type">CompactBuffer</span>(<span class="number">36</span>))))</div><div class="line"></div><div class="line">```  </div><div class="line">**java版本**  </div><div class="line">```java</div><div class="line">        <span class="type">JavaRDD</span>&lt;<span class="type">Tuple2</span>&lt;<span class="type">String</span>,<span class="type">Float</span>&gt;&gt; scoreDetails1 = sc.parallelize(<span class="type">Arrays</span>.asList(<span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"xiaoming"</span>, <span class="number">75</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"xiaoming"</span>, <span class="number">90</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">95</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">96</span>)));</div><div class="line">        <span class="type">JavaRDD</span>&lt;<span class="type">Tuple2</span>&lt;<span class="type">String</span>,<span class="type">Float</span>&gt;&gt; scoreDetails2 = sc.parallelize(<span class="type">Arrays</span>.asList(<span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"xiaoming"</span>, <span class="number">75</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">60</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">62</span>)));</div><div class="line">        <span class="type">JavaRDD</span>&lt;<span class="type">Tuple2</span>&lt;<span class="type">String</span>,<span class="type">Float</span>&gt;&gt; scoreDetails3 = sc.parallelize(<span class="type">Arrays</span>.asList(<span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"xiaoming"</span>, <span class="number">75</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"xiaoming"</span>, <span class="number">45</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">24</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">57</span>)));</div><div class="line">        </div><div class="line">        <span class="type">JavaPairRDD</span>&lt;<span class="type">String</span>, <span class="type">Float</span>&gt; scoreMapRDD1 = <span class="type">JavaPairRDD</span>.fromJavaRDD(scoreDetails1);</div><div class="line">        <span class="type">JavaPairRDD</span>&lt;<span class="type">String</span>, <span class="type">Float</span>&gt; scoreMapRDD2 = <span class="type">JavaPairRDD</span>.fromJavaRDD(scoreDetails2);</div><div class="line">        <span class="type">JavaPairRDD</span>&lt;<span class="type">String</span>, <span class="type">Float</span>&gt; scoreMapRDD3 = <span class="type">JavaPairRDD</span>.fromJavaRDD(scoreDetails2);</div><div class="line">        </div><div class="line">        <span class="type">JavaPairRDD</span>&lt;<span class="type">String</span>, <span class="type">Tuple3</span>&lt;<span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;&gt;&gt; cogroupRDD = (<span class="type">JavaPairRDD</span>&lt;<span class="type">String</span>, <span class="type">Tuple3</span>&lt;<span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;&gt;&gt;) scoreMapRDD1.cogroup(scoreMapRDD2, scoreMapRDD3);</div><div class="line">        <span class="type">Map</span>&lt;<span class="type">String</span>, <span class="type">Tuple3</span>&lt;<span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;&gt;&gt; tuple3 = cogroupRDD.collectAsMap();</div><div class="line">        <span class="keyword">for</span> (<span class="type">String</span> key:tuple3.keySet()) &#123;</div><div class="line">            <span class="type">System</span>.out.println(<span class="string">"("</span>+key+<span class="string">", "</span>+tuple3.get(key)+<span class="string">")"</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">-----输出----------</div><div class="line">(lihua, ([<span class="number">95</span>, <span class="number">96</span>],[<span class="number">60</span>, <span class="number">62</span>],[<span class="number">60</span>, <span class="number">62</span>]))</div><div class="line">(xiaoming, ([<span class="number">75</span>, <span class="number">90</span>],[<span class="number">75</span>],[<span class="number">75</span>]))</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-7.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-7.html" title="spark RDD算子（七）之键值对分组操作 groupByKey，cogroup">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/7.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-6.html">
    		spark RDD算子（六）之键值对聚合操作reduceByKey，foldByKey，排序操作sortByKey
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-06T13:25:21.000Z">2017-03-06</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="reduceByKey"><a href="#reduceByKey" class="headerlink" title="reduceByKey"></a><strong>reduceByKey</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">def reduceByKey(func: (V, V) =&gt; V): RDD[(K, V)]</div><div class="line"></div><div class="line">def reduceByKey(func: (V, V) =&gt; V, numPartitions: Int): RDD[(K, V)]</div><div class="line"></div><div class="line">def reduceByKey(partitioner: Partitioner, func: (V, V) =&gt; V): RDD[(K, V)]</div></pre></td></tr></table></figure>
<p>接收一个函数，按照相同的key进行reduce操作，类似于scala的reduce的操作<br>例如RDD {(1, 2), (3, 4), (3, 6)}进行reduce<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">var</span> mapRDD = sc.parallelize(<span class="type">List</span>((<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">4</span>),(<span class="number">3</span>,<span class="number">6</span>)))</div><div class="line">    <span class="keyword">var</span> reduceRDD = mapRDD.reduceByKey((x,y)=&gt;x+y)</div><div class="line">    reduceRDD.foreach(x=&gt;println(x))</div><div class="line">------输出---------</div><div class="line">(<span class="number">1</span>,<span class="number">2</span>)</div><div class="line">(<span class="number">3</span>,<span class="number">10</span>)</div></pre></td></tr></table></figure></p>
<p>再举例<br><strong>单词计数</strong><br>F:\sparktest\sample.txt中的内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">aa bb cc aa aa aa dd dd ee ee ee ee </div><div class="line">ff aa bb zks</div><div class="line">ee kks</div><div class="line">ee  zz zks</div></pre></td></tr></table></figure></p>
<p><strong>scala版本</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">val</span> lines = sc.textFile(<span class="string">"F:\\sparktest\\sample.txt"</span>)</div><div class="line">    <span class="keyword">val</span> wordsRDD = lines.flatMap(x=&gt;x.split(<span class="string">"\\s+"</span>)).map(x=&gt;(x,<span class="number">1</span>))</div><div class="line">    <span class="keyword">val</span> wordCountRDD = wordsRDD.reduceByKey((x,y)=&gt;x+y)</div><div class="line">    wordCountRDD.foreach(x=&gt;println(x))</div><div class="line">---------输出-----------</div><div class="line">(ee,<span class="number">6</span>)</div><div class="line">(aa,<span class="number">5</span>)</div><div class="line">(dd,<span class="number">2</span>)</div><div class="line">(zz,<span class="number">1</span>)</div><div class="line">(zks,<span class="number">2</span>)</div><div class="line">(kks,<span class="number">1</span>)</div><div class="line">(ff,<span class="number">1</span>)</div><div class="line">(bb,<span class="number">2</span>)</div><div class="line">(cc,<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><strong>java版本</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"> JavaRDD&lt;String&gt; lines = sc.textFile(<span class="string">"F:\\sparktest\\sample.txt"</span>);</div><div class="line"></div><div class="line">        JavaPairRDD&lt;String, Integer&gt; wordPairRDD = lines.flatMapToPair(<span class="keyword">new</span> PairFlatMapFunction&lt;String, String, Integer&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> Iterable&lt;Tuple2&lt;String, Integer&gt;&gt; call(String s) <span class="keyword">throws</span> Exception &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt; tpLists = <span class="keyword">new</span> ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt;();</div><div class="line">                String[] split = s.split(<span class="string">"\\s+"</span>);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;split.length ; i++) &#123;</div><div class="line">                    Tuple2 tp = <span class="keyword">new</span> Tuple2&lt;String,Integer&gt;(split[i], <span class="number">1</span>);</div><div class="line">                    tpLists.add(tp);</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">return</span> tpLists;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        JavaPairRDD&lt;String, Integer&gt; wordCountRDD = wordPairRDD.reduceByKey(<span class="keyword">new</span> Function2&lt;Integer, Integer, Integer&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">(Integer i1, Integer i2)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                <span class="keyword">return</span> i1 + i2;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        Map&lt;String, Integer&gt; collectAsMap = wordCountRDD.collectAsMap();</div><div class="line">        <span class="keyword">for</span> (String key:collectAsMap.keySet()) &#123;</div><div class="line">            System.out.println(<span class="string">"("</span>+key+<span class="string">","</span>+collectAsMap.get(key)+<span class="string">")"</span>);</div><div class="line">        &#125;</div><div class="line">----------输出-------------------------------</div><div class="line">(kks,<span class="number">1</span>)</div><div class="line">(ee,<span class="number">6</span>)</div><div class="line">(bb,<span class="number">2</span>)</div><div class="line">(zz,<span class="number">1</span>)</div><div class="line">(ff,<span class="number">1</span>)</div><div class="line">(cc,<span class="number">1</span>)</div><div class="line">(zks,<span class="number">2</span>)</div><div class="line">(dd,<span class="number">2</span>)</div><div class="line">(aa,<span class="number">5</span>)</div></pre></td></tr></table></figure></p>
<h1 id="foldByKey"><a href="#foldByKey" class="headerlink" title="foldByKey"></a><strong>foldByKey</strong></h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foldByKey</span></span>(zeroValue: <span class="type">V</span>)(func: (<span class="type">V</span>, <span class="type">V</span>) =&gt; <span class="type">V</span>): <span class="type">RDD</span>[(<span class="type">K</span>, <span class="type">V</span>)]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foldByKey</span></span>(zeroValue: <span class="type">V</span>, numPartitions: <span class="type">Int</span>)(func: (<span class="type">V</span>, <span class="type">V</span>) =&gt; <span class="type">V</span>): <span class="type">RDD</span>[(<span class="type">K</span>, <span class="type">V</span>)]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foldByKey</span></span>(zeroValue: <span class="type">V</span>, partitioner: <span class="type">Partitioner</span>)(func: (<span class="type">V</span>, <span class="type">V</span>) =&gt; <span class="type">V</span>): <span class="type">RDD</span>[(<span class="type">K</span>, <span class="type">V</span>)]</div></pre></td></tr></table></figure>
<p>该函数用于RDD[K,V]根据K将V做折叠、合并处理，其中的参数zeroValue表示先根据映射函数将zeroValue应用于V,进行初始化V,再将映射函数应用于初始化后的V.<br>foldByKey可以参考我之前的<a href="http://blog.csdn.net/t1dmzks/article/details/69858060#t27" target="_blank" rel="external">scala的fold的介绍</a><br>与reduce不同的是 foldByKey开始折叠的第一个元素不是集合中的第一个元素，而是传入的一个元素<br><a href="http://lxw1234.com/archives/2015/07/358.htm" target="_blank" rel="external">参考LXW的博客  scala的例子</a><br><strong>直接看例子</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">var</span> rdd1 = sc.makeRDD(<span class="type">Array</span>((<span class="string">"A"</span>,<span class="number">0</span>),(<span class="string">"A"</span>,<span class="number">2</span>),(<span class="string">"B"</span>,<span class="number">1</span>),(<span class="string">"B"</span>,<span class="number">2</span>),(<span class="string">"C"</span>,<span class="number">1</span>)))</div><div class="line">scala&gt; rdd1.foldByKey(<span class="number">0</span>)(_+_).collect</div><div class="line">res75: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="type">A</span>,<span class="number">2</span>), (<span class="type">B</span>,<span class="number">3</span>), (<span class="type">C</span>,<span class="number">1</span>)) </div><div class="line"><span class="comment">//将rdd1中每个key对应的V进行累加，注意zeroValue=0,需要先初始化V,映射函数为+操</span></div><div class="line"><span class="comment">//作，比如("A",0), ("A",2)，先将zeroValue应用于每个V,得到：("A",0+0), ("A",2+0)，即：</span></div><div class="line"><span class="comment">//("A",0), ("A",2)，再将映射函数应用于初始化后的V，最后得到(A,0+2),即(A,2)</span></div></pre></td></tr></table></figure></p>
<p><strong>再看：</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; rdd1.foldByKey(<span class="number">2</span>)(_+_).collect</div><div class="line">res76: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="type">A</span>,<span class="number">6</span>), (<span class="type">B</span>,<span class="number">7</span>), (<span class="type">C</span>,<span class="number">3</span>))</div><div class="line"><span class="comment">//先将zeroValue=2应用于每个V,得到：("A",0+2), ("A",2+2)，即：("A",2), ("A",4)，再将映射函</span></div><div class="line"><span class="comment">//数应用于初始化后的V，最后得到：(A,2+4)，即：(A,6)</span></div></pre></td></tr></table></figure></p>
<p><strong>再看乘法操作：</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">scala&gt; rdd1.foldByKey(<span class="number">0</span>)(_*_).collect</div><div class="line">res77: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="type">A</span>,<span class="number">0</span>), (<span class="type">B</span>,<span class="number">0</span>), (<span class="type">C</span>,<span class="number">0</span>))</div><div class="line"><span class="comment">//先将zeroValue=0应用于每个V,注意，这次映射函数为乘法，得到：("A",0*0), ("A",2*0)，</span></div><div class="line"><span class="comment">//即：("A",0), ("A",0)，再将映射函//数应用于初始化后的V，最后得到：(A,0*0)，即：(A,0)</span></div><div class="line"><span class="comment">//其他K也一样，最终都得到了V=0</span></div><div class="line"> </div><div class="line">scala&gt; rdd1.foldByKey(<span class="number">1</span>)(_*_).collect</div><div class="line">res78: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="type">A</span>,<span class="number">0</span>), (<span class="type">B</span>,<span class="number">2</span>), (<span class="type">C</span>,<span class="number">1</span>))</div><div class="line"><span class="comment">//映射函数为乘法时，需要将zeroValue设为1，才能得到我们想要的结果。</span></div></pre></td></tr></table></figure></p>
<h1 id="SortByKey"><a href="#SortByKey" class="headerlink" title="SortByKey"></a><strong>SortByKey</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">def sortByKey(ascending : scala.Boolean = &#123; /* compiled code */ &#125;, numPartitions : scala.Int = &#123; /* compiled code */ &#125;) : org.apache.spark.rdd.RDD[scala.Tuple2[K, V]] = &#123; /* compiled code */ &#125;</div></pre></td></tr></table></figure>
<p>SortByKey用于对pairRDD按照key进行排序，第一个参数可以设置true或者false，默认是true<br><strong>scala例子</strong></p>
<pre><code class="scala">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">Array</span>((<span class="number">3</span>, <span class="number">4</span>),(<span class="number">1</span>, <span class="number">2</span>),(<span class="number">4</span>,<span class="number">4</span>),(<span class="number">2</span>,<span class="number">5</span>), (<span class="number">6</span>,<span class="number">5</span>), (<span class="number">5</span>, <span class="number">6</span>)))  

<span class="comment">// sortByKey不是Action操作，只能算是转换操作</span>
scala&gt; rdd.sortByKey()
res9: org.apache.spark.rdd.<span class="type">RDD</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = <span class="type">ShuffledRDD</span>[<span class="number">28</span>] at sortByKey at &lt;console&gt;:<span class="number">24</span> 

<span class="comment">//看看sortByKey后是什么类型</span>
scala&gt; rdd.sortByKey().collect() 
res10: <span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="number">1</span>,<span class="number">2</span>), (<span class="number">2</span>,<span class="number">5</span>), (<span class="number">3</span>,<span class="number">4</span>), (<span class="number">4</span>,<span class="number">4</span>), (<span class="number">5</span>,<span class="number">6</span>), (<span class="number">6</span>,<span class="number">5</span>)) 

<span class="comment">//降序排序</span>
scala&gt; rdd.sortByKey(<span class="literal">false</span>).collect() 
res12: <span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="number">6</span>,<span class="number">5</span>), (<span class="number">5</span>,<span class="number">6</span>), (<span class="number">4</span>,<span class="number">4</span>), (<span class="number">3</span>,<span class="number">4</span>), (<span class="number">2</span>,<span class="number">5</span>), (<span class="number">1</span>,<span class="number">2</span>))
</code></pre>
<p>java例子也是一样的，这里就不写了</p>
<p>参考文章: Spark快速大数据分析,<a href="http://lxw1234.com/archives/2015/07/358.htm" target="_blank" rel="external">LXW的大数据田地</a>,spark官网  </p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-6.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-6.html" title="spark RDD算子（六）之键值对聚合操作reduceByKey，foldByKey，排序操作sortByKey">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/6.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-5.html">
    		spark RDD算子（五）之键值对聚合操作 combineByKey
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-05T13:25:21.000Z">2017-03-05</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="combineByKey"><a href="#combineByKey" class="headerlink" title="combineByKey"></a><strong>combineByKey</strong></h1><p>聚合数据一般在集中式数据比较方便，如果涉及到分布式的数据集，该如何去实现呢。这里介绍一下combineByKey, 这个是各种聚集操作的鼻祖，应该要好好了解一下,<a href="http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.rdd.PairRDDFunctions" target="_blank" rel="external">参考scala API</a>  </p>
<h2 id="简要介绍"><a href="#简要介绍" class="headerlink" title="简要介绍"></a><strong>简要介绍</strong></h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">combineByKey</span></span>[<span class="type">C</span>](createCombiner: (<span class="type">V</span>) =&gt; <span class="type">C</span>,  </div><div class="line">                    mergeValue: (<span class="type">C</span>, <span class="type">V</span>) =&gt; <span class="type">C</span>,   </div><div class="line">                    mergeCombiners: (<span class="type">C</span>, <span class="type">C</span>) =&gt; <span class="type">C</span>): <span class="type">RD</span></div></pre></td></tr></table></figure>
<ul>
<li><strong>createCombiner</strong>: combineByKey() 会遍历分区中的所有元素，因此每个元素的键要么还没有遇到过，要么就<br>和之前的某个元素的键相同。如果这是一个新的元素， combineByKey() 会使用一个叫作 createCombiner() 的函数来创建<br>那个键对应的累加器的初始值</li>
<li><strong>mergeValue:</strong> 如果这是一个在处理当前分区之前已经遇到的键， 它会使用 mergeValue() 方法将该键的累加器对应的当前值与这个新的值进行合并  </li>
<li><strong>mergeCombiners:</strong> 由于每个分区都是独立处理的， 因此对于同一个键可以有多个累加器。如果有两个或者更<br>多的分区都有对应同一个键的累加器， 就需要使用用户提供的 mergeCombiners() 方法将各<br>个分区的结果进行合并。</li>
</ul>
<h2 id="计算学生平均成绩例子"><a href="#计算学生平均成绩例子" class="headerlink" title="计算学生平均成绩例子"></a><strong>计算学生平均成绩例子</strong></h2><p>这里举一个计算学生平均成绩的例子,例子参考至<a href="https://www.edureka.co/blog/apache-spark-combinebykey-explained" target="_blank" rel="external">https://www.edureka.co/blog/apache-spark-combinebykey-explained</a>, <a href="https://github.com/prithvirajbose/spark-dev/blob/master/src/main/scala/examples/TestCombineByKey.scala" target="_blank" rel="external">github源码</a>  我对此进行了解析<br><strong>创建一个学生成绩说明的类</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">ScoreDetail</span>(<span class="params">studentName: <span class="type">String</span>, subject: <span class="type">String</span>, score: <span class="type">Float</span></span>)</span></div></pre></td></tr></table></figure></p>
<p><strong>下面是一些测试数据</strong>，加载测试数据集合  key = Students name and value = ScoreDetail instance<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> scores = <span class="type">List</span>(</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"xiaoming"</span>, <span class="string">"Math"</span>, <span class="number">98</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"xiaoming"</span>, <span class="string">"English"</span>, <span class="number">88</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"wangwu"</span>, <span class="string">"Math"</span>, <span class="number">75</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"wangwu"</span>, <span class="string">"English"</span>, <span class="number">78</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"lihua"</span>, <span class="string">"Math"</span>, <span class="number">90</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"lihua"</span>, <span class="string">"English"</span>, <span class="number">80</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"zhangsan"</span>, <span class="string">"Math"</span>, <span class="number">91</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"zhangsan"</span>, <span class="string">"English"</span>, <span class="number">80</span>))</div></pre></td></tr></table></figure></p>
<p><strong>将集合转换成二元组</strong>， 也可以理解成转换成一个map, 利用了for 和 yield的组合<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> scoresWithKey = <span class="keyword">for</span> &#123; i &lt;- scores &#125; <span class="keyword">yield</span> (i.studentName, i)</div></pre></td></tr></table></figure></p>
<p><strong>创建RDD, 并且指定三个分区</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> scoresWithKeyRDD = sc.parallelize(scoresWithKey).partitionBy(<span class="keyword">new</span> <span class="type">HashPartitioner</span>(<span class="number">3</span>)).cache</div></pre></td></tr></table></figure></p>
<p><strong>输出打印一下各个分区的长度和各个分区的一些数据</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">    println(<span class="string">"&gt;&gt;&gt;&gt; Elements in each partition"</span>)</div><div class="line"></div><div class="line">    scoresWithKeyRDD.foreachPartition(partition =&gt; println(partition.length))</div><div class="line"></div><div class="line">    <span class="comment">// explore each partition...</span></div><div class="line">    println(<span class="string">"&gt;&gt;&gt;&gt; Exploring partitions' data..."</span>)</div><div class="line"></div><div class="line">    scoresWithKeyRDD.foreachPartition(</div><div class="line">      partition =&gt; partition.foreach(</div><div class="line">        item =&gt; println(item._2)))</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">会输出 </span></div><div class="line"><span class="comment">&gt;&gt;&gt;&gt; Elements in each partition</span></div><div class="line"><span class="comment">6</span></div><div class="line"><span class="comment">2</span></div><div class="line"><span class="comment">0</span></div><div class="line"><span class="comment">&gt;&gt;&gt;&gt; Exploring partitions' data...</span></div><div class="line"><span class="comment">ScoreDetail(xiaoming,Math,98.0)</span></div><div class="line"><span class="comment">ScoreDetail(xiaoming,English,88.0)</span></div><div class="line"><span class="comment">ScoreDetail(lihua,Math,90.0)</span></div><div class="line"><span class="comment">ScoreDetail(lihua,English,80.0)</span></div><div class="line"><span class="comment">ScoreDetail(zhangsan,Math,91.0)</span></div><div class="line"><span class="comment">ScoreDetail(zhangsan,English,80.0)</span></div><div class="line"><span class="comment">ScoreDetail(wangwu,Math,75.0)</span></div><div class="line"><span class="comment">ScoreDetail(wangwu,English,78.0)</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure></p>
<p><strong>聚合求平均值让后打印</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">      <span class="keyword">val</span> avgScoresRDD = scoresWithKeyRDD.combineByKey(</div><div class="line">      (x: <span class="type">ScoreDetail</span>) =&gt; (x.score, <span class="number">1</span>) <span class="comment">/*createCombiner*/</span>,</div><div class="line">      (acc: (<span class="type">Float</span>, <span class="type">Int</span>), x: <span class="type">ScoreDetail</span>) =&gt; (acc._1 + x.score, acc._2 + <span class="number">1</span>) <span class="comment">/*mergeValue*/</span>,</div><div class="line">      (acc1: (<span class="type">Float</span>, <span class="type">Int</span>), acc2: (<span class="type">Float</span>, <span class="type">Int</span>)) =&gt; (acc1._1 + acc2._1, acc1._2 + acc2._2) <span class="comment">/*mergeCombiners*/</span></div><div class="line">      <span class="comment">// calculate the average</span></div><div class="line">    ).map( &#123; <span class="keyword">case</span>(key, value) =&gt; (key, value._1/value._2) &#125;)</div><div class="line"></div><div class="line">    avgScoresRDD.collect.foreach(println)</div><div class="line"><span class="comment">/*输出:</span></div><div class="line"><span class="comment">(zhangsan,85.5)</span></div><div class="line"><span class="comment">(lihua,85.0)</span></div><div class="line"><span class="comment">(xiaoming,93.0)</span></div><div class="line"><span class="comment">(wangwu,76.5)</span></div><div class="line"><span class="comment">*/</span></div><div class="line">```   </div><div class="line">**解释一下scoresWithKeyRDD.combineByKey**  </div><div class="line">**createCombiner:**  (x: <span class="type">ScoreDetail</span>) =&gt; (x.score, <span class="number">1</span>)  </div><div class="line">这是第一次遇到zhangsan，创建一个函数，把map中的value转成另外一个类型   ，这里是把(zhangsan,(<span class="type">ScoreDetail</span>类))**转换成**(zhangsan,(<span class="number">91</span>,<span class="number">1</span>))  </div><div class="line">**mergeValue:** (acc: (<span class="type">Float</span>, <span class="type">Int</span>), x: <span class="type">ScoreDetail</span>) =&gt; (acc._1 + x.score, acc._2 + <span class="number">1</span>)  再次碰到张三， 就把这两个合并, 这里是将(zhangsan,(<span class="number">91</span>,<span class="number">1</span>)) 这种类型 和 (zhangsan,(<span class="type">ScoreDetail</span>类))这种类型合并，合并成了(zhangsan,(<span class="number">171</span>,<span class="number">2</span>))  </div><div class="line">**mergeCombiners** (acc1: (<span class="type">Float</span>, <span class="type">Int</span>), acc2: (<span class="type">Float</span>, <span class="type">Int</span>))  这个是将多个分区中的zhangsan的数据进行合并， 我们这里zhansan在同一个分区，这个地方就没有用上  </div><div class="line"></div><div class="line">## java版本的介绍</div><div class="line">**<span class="type">ScoreDetail</span>类**</div><div class="line">```java</div><div class="line"></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ScoreDetail</span> <span class="title">implements</span> <span class="title">Serializable</span></span>&#123;</div><div class="line">    <span class="comment">//case class ScoreDetail(studentName: String, subject: String, score: Float)</span></div><div class="line">    public <span class="type">String</span> studentName;</div><div class="line">    public <span class="type">String</span> subject;</div><div class="line">    public float score;</div><div class="line"></div><div class="line">    public <span class="type">ScoreDetail</span>(<span class="type">String</span> studentName, <span class="type">String</span> subject, float score) &#123;</div><div class="line">        <span class="keyword">this</span>.studentName = studentName;</div><div class="line">        <span class="keyword">this</span>.subject = subject;</div><div class="line">        <span class="keyword">this</span>.score = score;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>CombineByKey的测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CombineTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SparkConf sparkConf = <span class="keyword">new</span> SparkConf().setAppName(<span class="string">"JavaWordCount"</span>).setMaster(<span class="string">"local"</span>);</div><div class="line">        JavaSparkContext sc = <span class="keyword">new</span> JavaSparkContext(sparkConf);</div><div class="line">        ArrayList&lt;ScoreDetail&gt; scoreDetails = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"xiaoming"</span>, <span class="string">"Math"</span>, <span class="number">98</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"xiaoming"</span>, <span class="string">"English"</span>, <span class="number">88</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"wangwu"</span>, <span class="string">"Math"</span>, <span class="number">75</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"wangwu"</span>, <span class="string">"Englist"</span>, <span class="number">78</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"lihua"</span>, <span class="string">"Math"</span>, <span class="number">90</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"lihua"</span>, <span class="string">"English"</span>, <span class="number">80</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"zhangsan"</span>, <span class="string">"Math"</span>, <span class="number">91</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"zhangsan"</span>, <span class="string">"English"</span>, <span class="number">80</span>));</div><div class="line"></div><div class="line">        JavaRDD&lt;ScoreDetail&gt; scoreDetailsRDD = sc.parallelize(scoreDetails);</div><div class="line"></div><div class="line">        JavaPairRDD&lt;String, ScoreDetail&gt; pairRDD = scoreDetailsRDD.mapToPair(<span class="keyword">new</span> PairFunction&lt;ScoreDetail, String, ScoreDetail&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;String, ScoreDetail&gt; <span class="title">call</span><span class="params">(ScoreDetail scoreDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(scoreDetail.studentName, scoreDetail);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"><span class="comment">//        new Function&lt;ScoreDetail, Float,Integer&gt;();</span></div><div class="line"></div><div class="line">        Function&lt;ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt; createCombine = <span class="keyword">new</span> Function&lt;ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;Float, Integer&gt; <span class="title">call</span><span class="params">(ScoreDetail scoreDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(scoreDetail.score, <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        <span class="comment">// Function2传入两个值，返回一个值</span></div><div class="line">        Function2&lt;Tuple2&lt;Float, Integer&gt;, ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt; mergeValue = <span class="keyword">new</span> Function2&lt;Tuple2&lt;Float, Integer&gt;, ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;Float, Integer&gt; <span class="title">call</span><span class="params">(Tuple2&lt;Float, Integer&gt; tp, ScoreDetail scoreDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(tp._1 + scoreDetail.score, tp._2 + <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        Function2&lt;Tuple2&lt;Float, Integer&gt;, Tuple2&lt;Float, Integer&gt;, Tuple2&lt;Float, Integer&gt;&gt; mergeCombiners = <span class="keyword">new</span> Function2&lt;Tuple2&lt;Float, Integer&gt;, Tuple2&lt;Float, Integer&gt;, Tuple2&lt;Float, Integer&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;Float, Integer&gt; <span class="title">call</span><span class="params">(Tuple2&lt;Float, Integer&gt; tp1, Tuple2&lt;Float, Integer&gt; tp2)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(tp1._1 + tp2._1, tp1._2 + tp2._2);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        JavaPairRDD&lt;String, Tuple2&lt;Float,Integer&gt;&gt; combineByRDD  = pairRDD.combineByKey(createCombine,mergeValue,mergeCombiners);</div><div class="line"></div><div class="line">        <span class="comment">//打印平均数</span></div><div class="line">        Map&lt;String, Tuple2&lt;Float, Integer&gt;&gt; stringTuple2Map = combineByRDD.collectAsMap();</div><div class="line">        <span class="keyword">for</span> ( String et:stringTuple2Map.keySet()) &#123;</div><div class="line">            System.out.println(et+<span class="string">" "</span>+stringTuple2Map.get(et)._1/stringTuple2Map.get(et)._2);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>注意有个坑的地方</strong>  createCombine方法必须是这样的<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Function&lt;ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt; createCombine = <span class="keyword">new</span> Function&lt;ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;Float, Integer&gt; <span class="title">call</span><span class="params">(ScoreDetail scoreDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(scoreDetail.score, <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><strong>而不能是这样的</strong>, 即使最后的RDD都类似<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">PairFunction&lt;ScoreDetail, Float, Integer&gt; createCombine = <span class="keyword">new</span> PairFunction&lt;ScoreDetail, Float, Integer&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;Float, Integer&gt; <span class="title">call</span><span class="params">(ScoreDetail scoreDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(scoreDetail.score, <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>再推荐几篇比较好的文章 <a href="http://lxw1234.com/archives/2015/07/358.htm" target="_blank" rel="external">LXW的大数据田地: combineByKey</a><br> 推荐图书快速大数据分析中combineByKey的讲解</p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-5.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-5.html" title="spark RDD算子（五）之键值对聚合操作 combineByKey">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/5.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-4.html">
    		spark RDD算子（四）之创建键值对RDD mapToPair flatMapToPair
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-04T13:25:21.000Z">2017-03-04</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="mapToPair"><a href="#mapToPair" class="headerlink" title="mapToPair"></a><strong>mapToPair</strong></h1><p>举例，在F:\sparktest\sample.txt 文件的内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">aa bb cc aa aa aa dd dd ee ee ee ee </div><div class="line">ff aa bb zks</div><div class="line">ee kks</div><div class="line">ee  zz zks</div><div class="line">``` </div><div class="line">将每一行的第一个单词作为键，1 作为value创建pairRDD</div><div class="line">**scala版本**  </div><div class="line">scala是没有mapToPair函数的，scala版本只需要map就可以了</div><div class="line">```scala</div><div class="line">    scala&gt; val lines = sc.textFile(&quot;F:\\sparktest\\sample.txt&quot;)</div><div class="line">    </div><div class="line">    scala&gt; val pairs = lines.map(x =&gt; (x.split(&quot;\\s+&quot;)(0), 1))</div><div class="line">    </div><div class="line">    scala&gt; pairs.collect</div><div class="line">    res0: Array[(String, Int)] = Array((aa,1), (ff,1), (ee,1), (ee,1))</div></pre></td></tr></table></figure></p>
<p><strong>java版本</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;String&gt; lines = sc.textFile(<span class="string">"F:\\sparktest\\sample.txt"</span>);</div><div class="line"><span class="comment">//输入的是一个string的字符串，输出的是一个(String, Integer) 的map</span></div><div class="line">JavaPairRDD&lt;String, Integer&gt; pairRDD = lines.mapToPair(<span class="keyword">new</span> PairFunction&lt;String, String, Integer&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;String, Integer&gt; <span class="title">call</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;String, Integer&gt;(s.split(<span class="string">"\\s+"</span>)[<span class="number">0</span>], <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h1 id="flatMapToPair"><a href="#flatMapToPair" class="headerlink" title="flatMapToPair"></a><strong>flatMapToPair</strong></h1><p>类似于xxx连接  mapToPair是一对一，一个元素返回一个元素，而flatMapToPair可以一个元素返回多个，相当于先flatMap,在mapToPair<br>例子: 将每一个单词都分成键为<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> lines = sc.textFile(<span class="string">"F:\\sparktest\\sample.txt"</span>)</div><div class="line"><span class="keyword">val</span> flatRDD = lines.flatMap(x =&gt; (x.split(<span class="string">"\\s+"</span>)))</div><div class="line"><span class="keyword">val</span> pairs = flatRDD.map(x=&gt;(x,<span class="number">1</span>))</div><div class="line"></div><div class="line">scala&gt; pairs.collect</div><div class="line">res1: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((aa,<span class="number">1</span>), (bb,<span class="number">1</span>), (cc,<span class="number">1</span>), (aa,<span class="number">1</span>), (aa,<span class="number">1</span>), (aa,<span class="number">1</span>), (dd,<span class="number">1</span>), (dd,<span class="number">1</span>), (ee,<span class="number">1</span>), (ee,<span class="number">1</span>), (ee,<span class="number">1</span>), (ee,<span class="number">1</span>), (ff,<span class="number">1</span>), (aa,<span class="number">1</span>), (bb,<span class="number">1</span>), (zks,<span class="number">1</span>), (ee,<span class="number">1</span>), (kks,<span class="number">1</span>), (ee,<span class="number">1</span>), (zz,<span class="number">1</span>), (zks,<span class="number">1</span>))</div></pre></td></tr></table></figure></p>
<p><strong>java版本 spark2.0以下</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">JavaPairRDD&lt;String, Integer&gt; wordPairRDD = lines.flatMapToPair(<span class="keyword">new</span> PairFlatMapFunction&lt;String, String, Integer&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> Iterable&lt;Tuple2&lt;String, Integer&gt;&gt; call(String s) <span class="keyword">throws</span> Exception &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt; tpLists = <span class="keyword">new</span> ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt;();</div><div class="line">                String[] split = s.split(<span class="string">"\\s+"</span>);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;split.length ; i++) &#123;</div><div class="line">                    Tuple2 tp = <span class="keyword">new</span> Tuple2&lt;String,Integer&gt;(split[i], <span class="number">1</span>);</div><div class="line">                    tpLists.add(tp);</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">return</span> tpLists;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">```  </div><div class="line">**java版本 spark2.0以上**</div><div class="line">主要是iterator和iteratable的一些区别</div><div class="line">```java</div><div class="line">        JavaPairRDD&lt;String, Integer&gt; wordPairRDD = lines.flatMapToPair(<span class="keyword">new</span> PairFlatMapFunction&lt;String, String, Integer&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> Iterator&lt;Tuple2&lt;String, Integer&gt;&gt; call(String s) <span class="keyword">throws</span> Exception &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt; tpLists = <span class="keyword">new</span> ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt;();</div><div class="line">                String[] split = s.split(<span class="string">"\\s+"</span>);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;split.length ; i++) &#123;</div><div class="line">                    Tuple2 tp = <span class="keyword">new</span> Tuple2&lt;String,Integer&gt;(split[i], <span class="number">1</span>);</div><div class="line">                    tpLists.add(tp);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> tpLists.iterator();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-4.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-4.html" title="spark RDD算子（四）之创建键值对RDD mapToPair flatMapToPair">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/4.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-3.html">
    		spark RDD算子（三） distinct，union，intersection，subtract，cartesian
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-03T13:25:21.000Z">2017-03-03</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p><strong>spark伪集合</strong><br>尽管 RDD 本身不是严格意义上的集合，但它也支持许多数学上的集合操作，比如合并和相交操作, 下图展示了这四种操作<br><img src="http://i2.muimg.com/567571/cf473cf5e7f9f270.png" alt="RDD伪集合">  </p>
<h1 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a><strong>distinct</strong></h1><p>distinct用于去重， 我们生成的RDD可能有重复的元素，使用distinct方法可以去掉重复的元素, 不过此方法涉及到混洗，操作开销很大<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">    scala&gt; <span class="keyword">var</span> <span class="type">RDD1</span> = sc.parallelize(<span class="type">List</span>(<span class="string">"aa"</span>,<span class="string">"aa"</span>,<span class="string">"bb"</span>,<span class="string">"cc"</span>,<span class="string">"dd"</span>))</div><div class="line">    </div><div class="line">    scala&gt; <span class="type">RDD1</span>.collect</div><div class="line">    res3: <span class="type">Array</span>[<span class="type">String</span>] = <span class="type">Array</span>(aa, aa, bb, cc, dd)</div><div class="line">    </div><div class="line">    scala&gt; <span class="keyword">var</span> distinctRDD = <span class="type">RDD1</span>.distinct</div><div class="line">    </div><div class="line">    scala&gt; distinctRDD.collect</div><div class="line">    res5: <span class="type">Array</span>[<span class="type">String</span>] = <span class="type">Array</span>(aa, dd, bb, cc)</div><div class="line">```  </div><div class="line">**java版本**</div><div class="line">```java</div><div class="line">    <span class="type">JavaRDD</span>&lt;<span class="type">String</span>&gt; <span class="type">RDD1</span> = sc.parallelize(<span class="type">Arrays</span>.asList(<span class="string">"aa"</span>, <span class="string">"aa"</span>, <span class="string">"bb"</span>, <span class="string">"cc"</span>, <span class="string">"dd"</span>));</div><div class="line">    <span class="type">JavaRDD</span>&lt;<span class="type">String</span>&gt; distinctRDD = <span class="type">RDD1</span>.distinct();</div><div class="line">    <span class="type">List</span>&lt;<span class="type">String</span>&gt; collect = distinctRDD.collect();</div><div class="line">    <span class="keyword">for</span> (<span class="type">String</span> str:collect) &#123;</div><div class="line">        <span class="type">System</span>.out.print(str+<span class="string">", "</span>);</div><div class="line">    &#125;</div><div class="line">---------输出----------</div><div class="line">aa, dd, bb, cc,</div><div class="line">```  </div><div class="line"># **union**  </div><div class="line">两个<span class="type">RDD</span>进行合并</div><div class="line">**scala版本**</div></pre></td></tr></table></figure></p>
<pre><code>scala&gt; var RDD1 = sc.parallelize(List(&quot;aa&quot;,&quot;aa&quot;,&quot;bb&quot;,&quot;cc&quot;,&quot;dd&quot;))
scala&gt; var RDD2 = sc.parallelize(List(&quot;aa&quot;,&quot;dd&quot;,&quot;ff&quot;))

scala&gt; RDD1.collect
res6: Array[String] = Array(aa, aa, bb, cc, dd)

scala&gt; RDD2.collect
res7: Array[String] = Array(aa, dd, ff)

scala&gt; RDD1.union(RDD2).collect
res8: Array[String] = Array(aa, aa, bb, cc, dd, aa, dd, ff)
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">**java版本**</div><div class="line">```java</div><div class="line">    JavaRDD&lt;String&gt; RDD1 = sc.parallelize(Arrays.asList(&quot;aa&quot;, &quot;aa&quot;, &quot;bb&quot;, &quot;cc&quot;, &quot;dd&quot;));</div><div class="line">    JavaRDD&lt;String&gt; RDD2 = sc.parallelize(Arrays.asList(&quot;aa&quot;,&quot;dd&quot;,&quot;ff&quot;));</div><div class="line">    JavaRDD&lt;String&gt; unionRDD = RDD1.union(RDD2);</div><div class="line">    List&lt;String&gt; collect = unionRDD.collect();</div><div class="line">    for (String str:collect) &#123;</div><div class="line">        System.out.print(str+&quot;, &quot;);</div><div class="line">    &#125;</div><div class="line">-----------输出---------</div><div class="line">aa, aa, bb, cc, dd, aa, dd, ff,</div><div class="line">``` </div><div class="line"># **intersection**</div><div class="line">RDD1.intersection(RDD2)  返回两个RDD的交集，并且去重  </div><div class="line">intersection 需要混洗数据，比较浪费性能  </div><div class="line">**scala版本**  </div><div class="line">```scala</div><div class="line">    scala&gt; var RDD1 = sc.parallelize(List(&quot;aa&quot;,&quot;aa&quot;,&quot;bb&quot;,&quot;cc&quot;,&quot;dd&quot;))</div><div class="line">    scala&gt; var RDD2 = sc.parallelize(List(&quot;aa&quot;,&quot;dd&quot;,&quot;ff&quot;))</div><div class="line">    </div><div class="line">    scala&gt; RDD1.collect</div><div class="line">    res6: Array[String] = Array(aa, aa, bb, cc, dd)</div><div class="line">    </div><div class="line">    scala&gt; RDD2.collect</div><div class="line">    res7: Array[String] = Array(aa, dd, ff)</div><div class="line">    </div><div class="line">    scala&gt; var insertsectionRDD = RDD1.intersection(RDD2)</div><div class="line">    scala&gt; insertsectionRDD.collect</div><div class="line">    </div><div class="line">    res9: Array[String] = Array(aa, dd)</div><div class="line">```  </div><div class="line">**java版本**  </div><div class="line">```java</div><div class="line">    JavaRDD&lt;String&gt; RDD1 = sc.parallelize(Arrays.asList(&quot;aa&quot;, &quot;aa&quot;, &quot;bb&quot;, &quot;cc&quot;, &quot;dd&quot;));</div><div class="line">    JavaRDD&lt;String&gt; RDD2 = sc.parallelize(Arrays.asList(&quot;aa&quot;,&quot;dd&quot;,&quot;ff&quot;));</div><div class="line">    JavaRDD&lt;String&gt; intersectionRDD = RDD1.intersection(RDD2);</div><div class="line">    List&lt;String&gt; collect = intersectionRDD.collect();</div><div class="line">    for (String str:collect) &#123;</div><div class="line">        System.out.print(str+&quot; &quot;);</div><div class="line">    &#125;</div><div class="line">-------------输出-----------</div><div class="line">aa dd</div><div class="line">```  </div><div class="line"># **subtract**</div><div class="line">RDD1.subtract(RDD2),返回在RDD1中出现，但是不在RDD2中出现的元素，不去重  </div><div class="line">**scala版本**</div><div class="line">```scala</div><div class="line">    JavaRDD&lt;String&gt; RDD1 = sc.parallelize(Arrays.asList(&quot;aa&quot;, &quot;aa&quot;,&quot;bb&quot;, &quot;cc&quot;, &quot;dd&quot;));</div><div class="line">    </div><div class="line">    JavaRDD&lt;String&gt; RDD2 = sc.parallelize(Arrays.asList(&quot;aa&quot;,&quot;dd&quot;,&quot;ff&quot;));</div><div class="line">    </div><div class="line">    scala&gt; var substractRDD =RDD1.subtract(RDD2)</div><div class="line">    </div><div class="line">    scala&gt;  substractRDD.collect</div><div class="line">    res10: Array[String] = Array(bb, cc)</div></pre></td></tr></table></figure>
<p><strong>java版本</strong></p>
<pre><code class="java">    JavaRDD&lt;String&gt; RDD1 = sc.parallelize(Arrays.asList(<span class="string">"aa"</span>, <span class="string">"aa"</span>, <span class="string">"bb"</span>,<span class="string">"cc"</span>, <span class="string">"dd"</span>));
    JavaRDD&lt;String&gt; RDD2 = sc.parallelize(Arrays.asList(<span class="string">"aa"</span>,<span class="string">"dd"</span>,<span class="string">"ff"</span>));
    JavaRDD&lt;String&gt; subtractRDD = RDD1.subtract(RDD2);
    List&lt;String&gt; collect = subtractRDD.collect();
    <span class="keyword">for</span> (String str:collect) {
        System.out.print(str+<span class="string">" "</span>);
    }
------------输出-----------------
bb  cc
</code></pre>
<h1 id="cartesian"><a href="#cartesian" class="headerlink" title="cartesian"></a><strong>cartesian</strong></h1><p>RDD1.cartesian(RDD2)  返回RDD1和RDD2的笛卡儿积，这个开销非常大</p>
<p><strong>scala版本</strong></p>
<pre><code class="scala">scala&gt;  <span class="keyword">var</span> <span class="type">RDD1</span> = sc.parallelize(<span class="type">List</span>(<span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>))

scala&gt; <span class="keyword">var</span> <span class="type">RDD2</span> = sc.parallelize(<span class="type">List</span>(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>))

scala&gt; <span class="keyword">var</span> cartesianRDD = <span class="type">RDD1</span>.cartesian(<span class="type">RDD2</span>)

scala&gt; cartesianRDD.collect
res11: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">String</span>)] = <span class="type">Array</span>((<span class="number">1</span>,a), (<span class="number">1</span>,b), (<span class="number">1</span>,c), (<span class="number">2</span>,a), (<span class="number">2</span>,b), (<span class="number">2</span>,c), (<span class="number">3</span>,a), (<span class="number">3</span>,b), (<span class="number">3</span>,c))
</code></pre>
<p><strong>java版本</strong></p>
<pre><code class="java">    JavaRDD&lt;String&gt; RDD1 = sc.parallelize(Arrays.asList(<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>));
    JavaRDD&lt;String&gt; RDD2 = sc.parallelize(Arrays.asList(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>));
    JavaPairRDD&lt;String, String&gt; cartesian = RDD1.cartesian(RDD2);

    List&lt;Tuple2&lt;String, String&gt;&gt; collect1 = cartesian.collect();
    <span class="keyword">for</span> (Tuple2&lt;String, String&gt; tp:collect1) {
        System.out.println(<span class="string">"("</span>+tp._1+<span class="string">" "</span>+tp._2+<span class="string">")"</span>);
    }
------------输出-----------------
(<span class="number">1</span> a)
(<span class="number">1</span> b)
(<span class="number">1</span> c)
(<span class="number">2</span> a)
(<span class="number">2</span> b)
(<span class="number">2</span> c)
(<span class="number">3</span> a)
(<span class="number">3</span> b)
(<span class="number">3</span> c)
</code></pre>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-3.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-3.html" title="spark RDD算子（三） distinct，union，intersection，subtract，cartesian">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/3.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-2.html">
    		spark RDD算子（二） filter,map ,flatMap
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-02T13:25:21.000Z">2017-03-02</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>先来一张spark快速大数据中的图片进行快速入门，后面有更详细的例子<br><img src="http://i4.buimg.com/567571/9bf09aff04368678.png" alt=""></p>
<h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a><strong>filter</strong></h2><p>举例，在F:\sparktest\sample.txt 文件的内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">aa bb cc aa aa aa dd dd ee ee ee ee </div><div class="line">ff aa bb zks</div><div class="line">ee kks</div><div class="line">ee  zz zks</div><div class="line">```  </div><div class="line">我要将包含zks的行的内容给找出来</div><div class="line">**scala版本**</div><div class="line">```scala</div><div class="line">    val lines = sc.textFile(&quot;F:\\sparktest\\sample.txt&quot;).filter(line=&gt;line.contains(&quot;zks&quot;))</div><div class="line">    //打印内容</div><div class="line">    lines.collect().foreach(println(_));</div><div class="line">-------------输出------------------</div><div class="line">ff aa bb zks</div><div class="line">ee  zz zks</div><div class="line"></div><div class="line">```  </div><div class="line">**java版本**</div><div class="line">```java</div><div class="line">        JavaRDD&lt;String&gt; lines = sc.textFile(&quot;F:\\sparktest\\sample.txt&quot;);</div><div class="line">        JavaRDD&lt;String&gt; zksRDD = lines.filter(new Function&lt;String, Boolean&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public Boolean call(String s) throws Exception &#123;</div><div class="line">                return s.contains(&quot;zks&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        //打印内容</div><div class="line">        List&lt;String&gt; zksCollect = zksRDD.collect();</div><div class="line">        for (String str:zksCollect) &#123;</div><div class="line">            System.out.println(str);</div><div class="line">        &#125;</div><div class="line">----------------输出-------------------</div><div class="line">ff aa bb zks</div><div class="line">ee  zz zks</div><div class="line">```  </div><div class="line"></div><div class="line">## **map**  </div><div class="line">map() 接收一个函数，把这个函数用于 RDD 中的每个元素，将函数的返回结果作为结果RDD编程 ｜ 31</div><div class="line">RDD 中对应元素的值 map是一对一的关系</div><div class="line">举例，在F:\sparktest\sample.txt 文件的内容如下</div></pre></td></tr></table></figure></p>
<p>aa bb cc aa aa aa dd dd ee ee ee ee<br>ff aa bb zks<br>ee kks<br>ee  zz zks<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">把每一行变成一个数组</div><div class="line">**scala版本**</div><div class="line">```scala</div><div class="line">//读取数据</div><div class="line">scala&gt; val lines = sc.textFile(&quot;F:\\sparktest\\sample.txt&quot;)</div><div class="line">//用map，对于每一行数据，按照空格分割成一个一个数组，然后返回的是一对一的关系</div><div class="line">scala&gt; var mapRDD = lines.map(line =&gt; line.split(&quot;\\s+&quot;))</div><div class="line">---------------输出-----------</div><div class="line">res0: Array[Array[String]] = Array(Array(aa, bb, cc, aa, aa, aa, dd, dd, ee, ee, ee, ee), Array(ff, aa, bb, zks), Array(ee, kks), Array(ee, zz, zks))</div><div class="line"></div><div class="line">//读取第一个元素</div><div class="line">scala&gt; mapRDD.first</div><div class="line">---输出----</div><div class="line">res1: Array[String] = Array(aa, bb, cc, aa, aa, aa, dd, dd, ee, ee, ee, ee)</div><div class="line">```  </div><div class="line">**java版本**</div><div class="line">```java</div><div class="line">        JavaRDD&lt;Iterable&lt;String&gt;&gt; mapRDD = lines.map(new Function&lt;String, Iterable&lt;String&gt;&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public Iterable&lt;String&gt; call(String s) throws Exception &#123;</div><div class="line">                String[] split = s.split(&quot;\\s+&quot;);</div><div class="line">                return Arrays.asList(split);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        //读取第一个元素</div><div class="line">        System.out.println(mapRDD.first());</div><div class="line">    ---------------输出-------------</div><div class="line">    [aa, bb, cc, aa, aa, aa, dd, dd, ee, ee, ee, ee]</div></pre></td></tr></table></figure></p>
<h2 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a><strong>flatMap</strong></h2><p>有时候，我们希望对某个元素生成多个元素，实现该功能的操作叫作 flatMap()<br>faltMap的函数应用于每一个元素，对于每一个元素返回的是多个元素组成的迭代器(想要了解更多，请参考<a href="http://blog.csdn.net/t1dmzks/article/details/69858060#t23" target="_blank" rel="external">scala的flatMap和map用法</a>)<br>例如我们将数据切分为单词<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    scala&gt;  <span class="keyword">val</span> lines = sc.textFile(<span class="string">"F:\\sparktest\\sample.txt"</span>)</div><div class="line">    scala&gt; <span class="keyword">val</span> flatMapRDD = lines.flatMap(line=&gt;line.split(<span class="string">"\\s"</span>))</div><div class="line">    scala&gt; flatMapRDD.first() </div><div class="line">---输出----</div><div class="line">res0: <span class="type">String</span> = aa</div></pre></td></tr></table></figure></p>
<p><strong>java版本，spark2.0以下</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">    JavaRDD&lt;String&gt; lines = sc.textFile(<span class="string">"F:\\sparktest\\sample.txt"</span>);</div><div class="line">    JavaRDD&lt;String&gt; flatMapRDD = lines.flatMap(<span class="keyword">new</span> FlatMapFunction&lt;String, String&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Iterable&lt;String&gt; <span class="title">call</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">            String[] split = s.split(<span class="string">"\\s+"</span>);</div><div class="line">            <span class="keyword">return</span> Arrays.asList(split);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="comment">//输出第一个</span></div><div class="line">    System.out.println(flatMapRDD.first());</div><div class="line">------------输出----------</div><div class="line">aa</div></pre></td></tr></table></figure></p>
<p><strong>java版本，spark2.0以上</strong><br>spark2.0以上，对flatMap的方法有所修改，就是flatMap中的Iterator和Iteratable的小区别<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;String&gt; flatMapRDD = lines.flatMap(<span class="keyword">new</span> FlatMapFunction&lt;String, String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;String&gt; <span class="title">call</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        String[] split = s.split(<span class="string">"\\s+"</span>);</div><div class="line">        <span class="keyword">return</span> Arrays.asList(split).iterator();</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-2.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-2.html" title="spark RDD算子（二） filter,map ,flatMap">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/2.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-1.html">
    		spark RDD算子（一）  parallelize，makeRDD，textFile
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-01T13:25:21.000Z">2017-03-01</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h2 id="parallelize"><a href="#parallelize" class="headerlink" title="parallelize"></a>parallelize</h2><p>调用SparkContext 的 parallelize()，将一个存在的集合，变成一个RDD，这种方式试用于学习spark和做一些spark的测试<br><strong>scala版本</strong><br>def parallelize<a href="seq: Seq[T], numSlices: Int = defaultParallelism" target="_blank" rel="external">T</a>(implicit arg0: ClassTag[T]): RDD[T]  </p>
<ul>
<li>第一个参数一是一个 Seq集合</li>
<li>第二个参数是分区数</li>
<li>返回的是RDD[T]<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">scala&gt; sc.parallelize(<span class="type">List</span>(<span class="string">"shenzhen"</span>, <span class="string">"is a beautiful city"</span>))</div><div class="line">res1: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">String</span>] = <span class="type">ParallelCollectionRDD</span>[<span class="number">1</span>] at parallelize at &lt;console&gt;:<span class="number">22</span></div><div class="line">```  </div><div class="line"></div><div class="line">**java版本**     </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parallelize</span></span>[<span class="type">T</span>](list : java.util.<span class="type">List</span>[<span class="type">T</span>], numSlices : scala.<span class="type">Int</span>) : org.apache.spark.api.java.<span class="type">JavaRDD</span>[<span class="type">T</span>] = &#123; <span class="comment">/* compiled code */</span> &#125; </div><div class="line">- 第一个参数是一个<span class="type">List</span>集合</div><div class="line">- 第二个参数是一个分区，可以默认</div><div class="line">- 返回的是一个<span class="type">JavaRDD</span>[<span class="type">T</span>]</div><div class="line">java版本只能接收<span class="type">List</span>的集合</div><div class="line">```java</div><div class="line"><span class="type">JavaRDD</span>&lt;<span class="type">String</span>&gt; javaStringRDD = sc.parallelize(<span class="type">Arrays</span>.asList(<span class="string">"shenzhen"</span>, <span class="string">"is a beautiful city"</span>));</div><div class="line">```  </div><div class="line"></div><div class="line">## makeRDD</div><div class="line">只有scala版本的才有makeRDD  </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeRDD</span></span>[<span class="type">T</span>](seq : scala.<span class="type">Seq</span>[<span class="type">T</span>], numSlices : scala.<span class="type">Int</span> = &#123; <span class="comment">/* compiled code */</span> &#125;)  </div><div class="line">跟parallelize类似</div><div class="line">```scala</div><div class="line">sc.makeRDD(<span class="type">List</span>(<span class="string">"shenzhen"</span>, <span class="string">"is a beautiful city"</span>))</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="textFile"><a href="#textFile" class="headerlink" title="textFile"></a>textFile</h2><p>调用SparkContext.textFile()方法，从外部存储中读取数据来创建 RDD<br>例如在我本地F:\dataexample\wordcount\input下有个sample.txt文件，文件随便写了点内容，我需要将里面的内容读取出来创建RDD<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> lines = sc.textFile(<span class="string">"F:\\dataexample\\wordcount\\input"</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java版本</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> JavaRDD&lt;String&gt; lines = sc.textFile(<span class="string">"F:\\dataexample\\wordcount\\input"</span>);</div><div class="line">```  </div><div class="line">注: textFile支持分区，支持模式匹配，例如把F:\\dataexample\\wordcount\\目录下inp开头的给转换成RDD</div><div class="line">```scala</div><div class="line">var lines = sc.textFile(<span class="string">"F:\\dataexample\\wordcount\\inp*"</span>)</div></pre></td></tr></table></figure></p>
<p>多个路径可以使用逗号分隔，例如<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> lines = sc.textFile(<span class="string">"dir1,dir2"</span>,<span class="number">3</span>)</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-1.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-1.html" title="spark RDD算子（一）  parallelize，makeRDD，textFile">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/1.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    

    
    <nav class="page-navigator">
        <span class="page-number current">1</span>
    </nav>
    


            </div>

        </section>
        <!-- 侧栏部分 -->
<aside class="sidebar">
    <section class="widget">
        <h3 class="widget-hd"><strong>文章分类</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
    <li>
        <a href="/categories/hadoop/">大数据</a>
        <span class="badge">(33)</span>
    </li>
    
    <li>
        <a href="/categories/hadoop/hdfs/">hdfs</a>
        <span class="badge">(8)</span>
    </li>
    
    <li>
        <a href="/categories/hadoop/hadoop/">hadoop</a>
        <span class="badge">(9)</span>
    </li>
    
    <li>
        <a href="/categories/Linux/">Linux</a>
        <span class="badge">(2)</span>
    </li>
    
    <li>
        <a href="/categories/programme/">programme</a>
        <span class="badge">(6)</span>
    </li>
    
    <li>
        <a href="/categories/hadoop/spark/">spark</a>
        <span class="badge">(16)</span>
    </li>
    
    <li>
        <a href="/categories/再测试sss/">再测试sss</a>
        <span class="badge">(0)</span>
    </li>
    
    <li>
        <a href="/categories/随笔/">随笔</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="/categories/测试一下目录/">测试一下目录</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="/categories/测试一下目录/hadoop/">大数据</a>
        <span class="badge">(1)</span>
    </li>
    
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-hd"><strong>热门标签</strong></h3>
        <!-- 文章标签 -->
<div class="widget-bd tag-wrap">
  
    <a class="tag-item" href="/tags/hdfs/" title="hdfs">hdfs (8)</a>
  
    <a class="tag-item" href="/tags/hadoop/" title="hadoop">hadoop (9)</a>
  
    <a class="tag-item" href="/tags/linux/" title="linux">linux (2)</a>
  
    <a class="tag-item" href="/tags/crontab/" title="crontab">crontab (1)</a>
  
    <a class="tag-item" href="/tags/java/" title="java">java (3)</a>
  
    <a class="tag-item" href="/tags/JDBC/" title="JDBC">JDBC (1)</a>
  
    <a class="tag-item" href="/tags/工具类/" title="工具类">工具类 (1)</a>
  
    <a class="tag-item" href="/tags/spark/" title="spark">spark (16)</a>
  
    <a class="tag-item" href="/tags/npm/" title="npm">npm (0)</a>
  
    <a class="tag-item" href="/tags/hexo/" title="hexo">hexo (0)</a>
  
    <a class="tag-item" href="/tags/github/" title="github">github (0)</a>
  
    <a class="tag-item" href="/tags/tags1/" title="tags1">tags1 (0)</a>
  
    <a class="tag-item" href="/tags/tags2/" title="tags2">tags2 (0)</a>
  
    <a class="tag-item" href="/tags/scala/" title="scala">scala (3)</a>
  
    <a class="tag-item" href="/tags/曲线拟合/" title="曲线拟合">曲线拟合 (1)</a>
  
    <a class="tag-item" href="/tags/随笔/" title="随笔">随笔 (1)</a>
  
    <a class="tag-item" href="/tags/标签1/" title="标签1">标签1 (1)</a>
  
    <a class="tag-item" href="/tags/标签2/" title="标签2">标签2 (1)</a>
  
    <a class="tag-item" href="/tags/Exception/" title="Exception">Exception (1)</a>
  
</div>
    </section>
    

    

    
    <!-- 友情链接 -->
    <section class="widget">
        <h3 class="widget-hd"><strong>友情链接</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
        <li>
            <a href="http://blog.sina.com.cn/u/1825875765" target="_blank" title="网络安全博客">Haoren博客</a>
        </li>
    
        <li>
            <a href="http://blog.csdn.net/yeweiouyang" target="_blank" title="技术博客">Maxwell博客</a>
        </li>
    
        <li>
            <a href="http://xuanzh.cc/" target="_blank" title="技术博客">朱旋个人博客</a>
        </li>
    
</ul>
    </section>
    
</aside>
<!-- / 侧栏部分 -->
    </div>

    <!-- 博客底部 -->
    <footer class="footer">
    &copy;
    
        2016-2018
    

    <a href="/">Jelon Loves You</a>
</footer>
<div class="back-to-top" id="JELON__backToTop" title="返回顶部">返回顶部</div>

    <!--博客js脚本 -->
    <!-- 这里放网站js脚本 -->
<script src="/js/main.js"></script>
</body>
</html>