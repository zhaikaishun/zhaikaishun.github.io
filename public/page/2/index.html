<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8" >
    <meta name="baidu-site-verification" content="dIcXMeY8Ya" />
    
    <title>挡路人</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" >
    <meta name="keywords" content="Jelon, 前端, Web, 张德龙, 前端开发" >
    <meta name="description" content="Jelon个人前端小站" >

    
    <link rel="alternative" href="/atom.xml" title="挡路人" type="application/atom+xml" >
    
    
    <link rel="shortcut icon" href="/favicon.ico" >
    
    <link rel="stylesheet" href="/css/style.css">
    <!--[if lt IE 9]>
    <script src="/js/html5.js"></script>
    <![endif]-->
    
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?fd459238242776d173cdc64918fb32f2";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</head>

<body class="home">
    <!--[if lt IE 9]>
    <div class="browsehappy">
        当前网页 <strong>不支持</strong>
        你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <!-- 博客头部 -->
    <header class="header">
    <section class="container header-main">
        <div class="logo">
            <a href="/">
                <div class="cover">
                    <span class="name">挡路人</span>
                    <span class="description">学有所思，思有所感</span>
                </div>
            </a>
        </div>
        <div class="dropnav icon-paragraph-justify" id="JELON__btnDropNav"></div>
        <ul class="menu hidden" id="JELON__menu">
            
            <li rel="/page/2/index.html" class="item ">
                <a href="/" title="首页" class="icon-home">&nbsp;首页</a>
            </li>
            
            <li rel="/page/2/index.html" class="item ">
                <a href="/lab/" title="实验室" class="icon-lab">&nbsp;实验室</a>
            </li>
            
            <li rel="/page/2/index.html" class="item ">
                <a href="/about/" title="关于" class="icon-about">&nbsp;关于</a>
            </li>
            
            <li rel="/page/2/index.html" class="item ">
                <a href="/comment/" title="留言" class="icon-comment">&nbsp;留言</a>
            </li>
            
        </ul>
        <div class="profile clearfix">
            <div class="feeds fl">
                
                
                <p class="links">
                    
                        <a href="https://github.com/jangdelong" target="_blank">Github</a>
                        |
                    
                        <a href="https://pages.coding.me" target="_blank">Hosted by Coding Pages</a>
                        
                    
                </p>
                <p class="sns">
                    
                        <a href="http://weibo.com/jangdelong" class="sinaweibo" target="_blank"><b>■</b> 新浪微博</a>
                    
                        <a href="https://www.facebook.com/profile.php?id=100011855760219&amp;ref=bookmarks" class="qqweibo" target="_blank"><b>■</b> Facebook</a>
                    
                    <a href="javascript: void(0);" class="wechat">
                        <b>■</b>
                        公众号
                        <span class="popover">
                            <img src="/img/wechat_mp.jpg" width="120" height="120" alt="我的微信订阅号">
                            <i class="arrow"></i>
                        </span>
                    </a>
                </p>
                
            </div>
            <div class="avatar fr">
                <img src="/img/jelon.jpg" alt="avatar" title="Jelon" >
            </div>
        </div>
    </section>
</header>


    <!-- 博客正文 -->
    <div class="container body clearfix">
        <section class="content">
            <div class="content-main widget">
                <!-- 首页 -->

    
    <h3 class="widget-hd">
        <strong>
            
                最近动态
            
        </strong>
    </h3>
    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-13.html">
    		spark RDD算子（十三）之RDD 分区 HashPartitioner，RangePartitioner，自定义分区
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-04-22T13:25:21.000Z">2017-04-22</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p><strong>关键字</strong>: spark分区方式，java HashPartitioner分区，scala HashPartitioner分区， java RangePartitioner 分区，scala RangePartitioner分区， java 自定义分区，scala自定义分区 </p>
<h1 id="默认分区和HashPartitioner分区"><a href="#默认分区和HashPartitioner分区" class="headerlink" title="默认分区和HashPartitioner分区"></a><strong>默认分区和HashPartitioner分区</strong></h1><p>默认的分区就是HashPartition分区,默认分区不再介绍，下面介绍HashPartition的使用</p>
<p>通过上一章 <a href="http://blog.csdn.net/t1dmzks/article/details/71336119#t1" target="_blank" rel="external">mapPartitionsWithIndex的例子</a>，我们可以构建一个方法，用来查看RDD的分区<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapPartIndexFunc</span></span>(i1:<span class="type">Int</span>,iter: <span class="type">Iterator</span>[(<span class="type">Int</span>,<span class="type">Int</span>)]):<span class="type">Iterator</span>[(<span class="type">Int</span>,(<span class="type">Int</span>,<span class="type">Int</span>))]=&#123;</div><div class="line">      <span class="keyword">var</span> res = <span class="type">List</span>[(<span class="type">Int</span>,(<span class="type">Int</span>,<span class="type">Int</span>))]()</div><div class="line">      <span class="keyword">while</span>(iter.hasNext)&#123;</div><div class="line">        <span class="keyword">var</span> next = iter.next()</div><div class="line">        res=res.::(i1,next)</div><div class="line">      &#125;</div><div class="line">      res.iterator</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printRDDPart</span></span>(rdd:<span class="type">RDD</span>[(<span class="type">Int</span>,<span class="type">Int</span>)]): <span class="type">Unit</span> =&#123;</div><div class="line">      <span class="keyword">var</span> mapPartIndexRDDs = rdd.mapPartitionsWithIndex(mapPartIndexFunc)</div><div class="line">      mapPartIndexRDDs.foreach(println( _))</div><div class="line">    &#125;</div><div class="line">```  </div><div class="line">**<span class="type">HashPartitioner</span>分区  scala**  </div><div class="line">使用pairRdd.partitionBy(<span class="keyword">new</span> spark.<span class="type">HashPartitioner</span>(n)), 可以分为n个区</div><div class="line">```scala</div><div class="line">    <span class="keyword">var</span> pairRdd = sc.parallelize(<span class="type">List</span>((<span class="number">1</span>,<span class="number">1</span>), (<span class="number">1</span>,<span class="number">2</span>), (<span class="number">2</span>,<span class="number">3</span>), (<span class="number">2</span>,<span class="number">4</span>), (<span class="number">3</span>,<span class="number">5</span>), (<span class="number">3</span>,<span class="number">6</span>),(<span class="number">4</span>,<span class="number">7</span>), (<span class="number">4</span>,<span class="number">8</span>),(<span class="number">5</span>,<span class="number">9</span>), (<span class="number">5</span>,<span class="number">10</span>)))</div><div class="line">    <span class="comment">//未分区的输出</span></div><div class="line">    printRDDPart(pairRdd)</div><div class="line">    println(<span class="string">"========================="</span>)</div><div class="line">    <span class="keyword">val</span> partitioned = pairRdd.partitionBy(<span class="keyword">new</span> spark.<span class="type">HashPartitioner</span>(<span class="number">3</span>))</div><div class="line">    <span class="comment">//分区后的输出</span></div><div class="line">    printRDDPart(partitioned)</div><div class="line">-----------输出------------</div><div class="line">(<span class="number">0</span>,(<span class="number">5</span>,<span class="number">10</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">5</span>,<span class="number">9</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">4</span>,<span class="number">8</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">4</span>,<span class="number">7</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">3</span>,<span class="number">6</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">3</span>,<span class="number">5</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">2</span>,<span class="number">4</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">2</span>,<span class="number">3</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">1</span>,<span class="number">1</span>))</div><div class="line">=========================</div><div class="line">(<span class="number">0</span>,(<span class="number">3</span>,<span class="number">6</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">3</span>,<span class="number">5</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">4</span>,<span class="number">8</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">4</span>,<span class="number">7</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">1</span>,<span class="number">1</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">5</span>,<span class="number">10</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">5</span>,<span class="number">9</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">2</span>,<span class="number">4</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">2</span>,<span class="number">3</span>))</div><div class="line">```  </div><div class="line">**<span class="type">HashPartitioner</span>是如何分区的**： 国内很多说法都是有问题的，参考国外的一个说法 <span class="type">Uses</span> <span class="type">Java</span>’s <span class="type">Object</span>.hashCodemethod to determine the partition as partition = key.hashCode() % numPartitions.  翻译过来就是使用java对象的hashCode来决定是哪个分区，对于piarRDD, 分区就是key.hashCode() % numPartitions, <span class="number">3</span>%<span class="number">3</span>=<span class="number">0</span>，所以 (<span class="number">3</span>,<span class="number">6</span>) 这个元素在<span class="number">0</span> 分区， <span class="number">4</span>%<span class="number">3</span>=<span class="number">1</span>，所以元素(<span class="number">4</span>,<span class="number">8</span>) 在<span class="number">1</span> 分区。 下面参考一张图  </div><div class="line">![spark分区](https:<span class="comment">//cdn.edureka.co/blog/wp-content/uploads/2016/03/11.png)  </span></div><div class="line"></div><div class="line"></div><div class="line"># **<span class="type">RangePartitioner</span>**  </div><div class="line">我理解成范围分区器</div><div class="line">使用一个范围，将范围内的键分配给相应的分区。这种方法适用于键中有自然排序，键不为负。本文主要介绍如何使用，原理以后再仔细研究,以下代码片段显示了<span class="type">RangePartitioner</span>的用法</div><div class="line"></div><div class="line">**<span class="type">RangePartitioner</span> 分区 scala **</div><div class="line">```scala</div><div class="line">    <span class="keyword">var</span> pairRdd = sc.parallelize(<span class="type">List</span>((<span class="number">1</span>,<span class="number">1</span>), (<span class="number">5</span>,<span class="number">10</span>), (<span class="number">5</span>,<span class="number">9</span>), (<span class="number">2</span>,<span class="number">4</span>), (<span class="number">3</span>,<span class="number">5</span>), (<span class="number">3</span>,<span class="number">6</span>),(<span class="number">4</span>,<span class="number">7</span>), (<span class="number">4</span>,<span class="number">8</span>),(<span class="number">2</span>,<span class="number">3</span>), (<span class="number">1</span>,<span class="number">2</span>)))</div><div class="line">    printRDDPart(pairRdd)</div><div class="line">    println(<span class="string">"========================="</span>)</div><div class="line">    <span class="keyword">val</span> partitioned = pairRdd.partitionBy(<span class="keyword">new</span> <span class="type">RangePartitioner</span>(<span class="number">3</span>,pairRdd))</div><div class="line">    printRDDPart(partitioned)</div><div class="line">  &#125;</div><div class="line">-------------------输出------------------</div><div class="line">(<span class="number">0</span>,(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">2</span>,<span class="number">3</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">4</span>,<span class="number">8</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">4</span>,<span class="number">7</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">3</span>,<span class="number">6</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">3</span>,<span class="number">5</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">2</span>,<span class="number">4</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">5</span>,<span class="number">9</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">5</span>,<span class="number">10</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">1</span>,<span class="number">1</span>))</div><div class="line">=========================</div><div class="line">(<span class="number">0</span>,(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">2</span>,<span class="number">3</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">2</span>,<span class="number">4</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">1</span>,<span class="number">1</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">4</span>,<span class="number">8</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">4</span>,<span class="number">7</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">3</span>,<span class="number">6</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">3</span>,<span class="number">5</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">5</span>,<span class="number">9</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">5</span>,<span class="number">10</span>))</div><div class="line"></div><div class="line">```  </div><div class="line">上面的<span class="type">RDD</span>生成的时候是乱的，但是我们让他分成三个范围，按照范围，key值为<span class="number">1</span>,<span class="number">2</span>的划分到第一个分区，key值为<span class="number">3</span>，<span class="number">4</span>的划分到第二个分区，key值为<span class="number">5</span>的划分到第三个分区  </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># **自定义分区**  </div><div class="line">要实现自定义的分区器，你需要继承 org.apache.spark.<span class="type">Partitioner</span> 类并实现下面三个方法  </div><div class="line">- **numPartitions: <span class="type">Int</span>**：返回创建出来的分区数。  </div><div class="line">- **getPartition(key: <span class="type">Any</span>): <span class="type">Int</span>**：返回给定键的分区编号（ <span class="number">0</span> 到 numPartitions<span class="number">-1</span>）。</div><div class="line">下面我自定义一个分区，让key大于等于<span class="number">4</span>的落在第一个分区，key&gt;=<span class="number">2</span>并且key&lt;<span class="number">4</span>的落在第二个分区，其余的落在第一个分区。  </div><div class="line">**scala版本**</div><div class="line">自定义分区器</div><div class="line">```scala</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomPartitioner</span>(<span class="params">numParts: <span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Partitioner</span></span>&#123;</div><div class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">numPartitions</span></span>: <span class="type">Int</span> = numParts</div><div class="line"></div><div class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">getPartition</span></span>(key: <span class="type">Any</span>): <span class="type">Int</span> = &#123;</div><div class="line">    <span class="keyword">if</span>(key.toString.toInt&gt;=<span class="number">4</span>)&#123;</div><div class="line">       <span class="number">0</span></div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(key.toString.toInt&gt;=<span class="number">2</span>&amp;&amp;key.toString.toInt&lt;<span class="number">4</span>)&#123;</div><div class="line">      <span class="number">1</span></div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      <span class="number">2</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>分区, 然后调用前面我们写的printRDDPart方法把各个分区中的RDD打印出来<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">var</span> pairRdd = sc.parallelize(<span class="type">List</span>((<span class="number">1</span>,<span class="number">1</span>), (<span class="number">5</span>,<span class="number">10</span>), (<span class="number">5</span>,<span class="number">9</span>), (<span class="number">2</span>,<span class="number">4</span>), (<span class="number">3</span>,<span class="number">5</span>), (<span class="number">3</span>,<span class="number">6</span>),(<span class="number">4</span>,<span class="number">7</span>), (<span class="number">4</span>,<span class="number">8</span>),(<span class="number">2</span>,<span class="number">3</span>), (<span class="number">1</span>,<span class="number">2</span>)))</div><div class="line">    <span class="keyword">val</span> partitionedRdd = pairRdd.partitionBy(<span class="keyword">new</span> <span class="type">CustomPartitioner</span>(<span class="number">3</span>))</div><div class="line">    printRDDPart(partitionedRdd)</div><div class="line">----------输出-----------------</div><div class="line">(<span class="number">0</span>,(<span class="number">4</span>,<span class="number">8</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">4</span>,<span class="number">7</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">5</span>,<span class="number">9</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">5</span>,<span class="number">10</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">2</span>,<span class="number">3</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">3</span>,<span class="number">6</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">3</span>,<span class="number">5</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">2</span>,<span class="number">4</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">1</span>,<span class="number">1</span>))</div></pre></td></tr></table></figure></p>
<h1 id="java-分区的用法"><a href="#java-分区的用法" class="headerlink" title="==java 分区的用法=="></a>==<strong>java 分区的用法</strong>==</h1><p>同样，写个方法，该方法能打印RDD下的每个分区下的各个元素</p>
<p><strong>打印每个分区下的各个元素的printPartRDD函数</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printPartRDD</span><span class="params">(JavaPairRDD&lt;Integer, Integer&gt; pairRDD)</span> </span>&#123;</div><div class="line">        JavaRDD&lt;Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;&gt; mapPartitionIndexRDD = pairRDD.mapPartitionsWithIndex(<span class="keyword">new</span> Function2&lt;Integer, Iterator&lt;Tuple2&lt;Integer, Integer&gt;&gt;, Iterator&lt;Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> Iterator&lt;Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;&gt; call(Integer partIndex, Iterator&lt;Tuple2&lt;Integer, Integer&gt;&gt; tuple2Iterator) &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;&gt; tuple2s = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">                <span class="keyword">while</span> (tuple2Iterator.hasNext()) &#123;</div><div class="line">                    Tuple2&lt;Integer, Integer&gt; next = tuple2Iterator.next();</div><div class="line">                    tuple2s.add(<span class="keyword">new</span> Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;(partIndex, next));</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> tuple2s.iterator();</div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">        mapPartitionIndexRDD.foreach(<span class="keyword">new</span> VoidFunction&lt;Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt; integerTuple2Tuple2)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                System.out.println(integerTuple2Tuple2);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">```  </div><div class="line">**java HashPartitioner 分区**  </div><div class="line"></div><div class="line">```java</div><div class="line"></div><div class="line">		JavaRDD&lt;Tuple2&lt;Integer, Integer&gt;&gt; tupRdd = sc.parallelize(Arrays.asList(<span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">1</span>, <span class="number">1</span>), <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">1</span>, <span class="number">2</span>)</div><div class="line">                , <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">2</span>, <span class="number">3</span>), <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">2</span>, <span class="number">4</span>)</div><div class="line">                , <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">3</span>, <span class="number">5</span>), <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">3</span>, <span class="number">6</span>)</div><div class="line">                , <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">4</span>, <span class="number">7</span>), <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">4</span>, <span class="number">8</span>)</div><div class="line">                , <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">5</span>, <span class="number">9</span>), <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">5</span>, <span class="number">10</span>)</div><div class="line">        ), <span class="number">3</span>);</div><div class="line">        JavaPairRDD&lt;Integer, Integer&gt; pairRDD = JavaPairRDD.fromJavaRDD(tupRdd);</div><div class="line"></div><div class="line">        JavaPairRDD&lt;Integer, Integer&gt; partitioned = pairRDD.partitionBy(<span class="keyword">new</span> HashPartitioner(<span class="number">3</span>));</div><div class="line">        System.out.println(<span class="string">"============HashPartitioner=================="</span>);</div><div class="line">        printPartRDD(partitioned);</div><div class="line">--------------打印--------------------</div><div class="line">============HashPartitioner==================</div><div class="line">(<span class="number">0</span>,(<span class="number">3</span>,<span class="number">5</span>))</div><div class="line">(<span class="number">0</span>,(<span class="number">3</span>,<span class="number">6</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">4</span>,<span class="number">8</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">4</span>,<span class="number">7</span>))</div><div class="line">(<span class="number">1</span>,(<span class="number">1</span>,<span class="number">1</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">5</span>,<span class="number">10</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">2</span>,<span class="number">4</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">2</span>,<span class="number">3</span>))</div><div class="line">(<span class="number">2</span>,(<span class="number">5</span>,<span class="number">9</span>))</div></pre></td></tr></table></figure></p>
<p><strong>java 自定义分区</strong><br><strong>自定义分区器</strong> ，key大于4的落在第一个分区，[2,4)之间的落在第二个分区，其余的落在第三个分区<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public class JavaCustomPart  extends Partitioner &#123;</div><div class="line">    int i = 1;</div><div class="line">    public JavaCustomPart(int i)&#123;</div><div class="line">        this.i=i;</div><div class="line">    &#125;</div><div class="line">    public JavaCustomPart()&#123;&#125;</div><div class="line">    @Override</div><div class="line">    public int numPartitions() &#123;</div><div class="line">        return i;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getPartition(Object key) &#123;</div><div class="line">        int keyCode = Integer.parseInt(key.toString());</div><div class="line">        if(keyCode&gt;=4)&#123;</div><div class="line">            return 0;</div><div class="line">        &#125;else if(keyCode&gt;=2&amp;&amp;keyCode&lt;4)&#123;</div><div class="line">            return 1;</div><div class="line">        &#125;else &#123;</div><div class="line">            return 2;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>分区并打印</strong>  </p>
<pre><code class="java">        System.out.println(<span class="string">"============CustomPartition=================="</span>);
        JavaPairRDD&lt;Integer, Integer&gt; customPart = pairRDD.partitionBy(<span class="keyword">new</span> JavaCustomPart(<span class="number">3</span>));
        printPartRDD(customPart);
--------------打印---------------
============CustomPartition==================
(<span class="number">0</span>,(<span class="number">5</span>,<span class="number">10</span>))
(<span class="number">0</span>,(<span class="number">4</span>,<span class="number">8</span>))
(<span class="number">0</span>,(<span class="number">4</span>,<span class="number">7</span>))
(<span class="number">0</span>,(<span class="number">5</span>,<span class="number">9</span>))
(<span class="number">1</span>,(<span class="number">2</span>,<span class="number">4</span>))
(<span class="number">1</span>,(<span class="number">3</span>,<span class="number">5</span>))
(<span class="number">1</span>,(<span class="number">3</span>,<span class="number">6</span>))
(<span class="number">1</span>,(<span class="number">2</span>,<span class="number">3</span>))
(<span class="number">2</span>,(<span class="number">1</span>,<span class="number">2</span>))
(<span class="number">2</span>,(<span class="number">1</span>,<span class="number">1</span>))
</code></pre>
<p><strong>java RangePartitioner</strong><br>TODO</p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-13.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-13.html" title="spark RDD算子（十三）之RDD 分区 HashPartitioner，RangePartitioner，自定义分区">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/2.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-12.html">
    		spark RDD算子（十二）之RDD 分区操作上mapPartitions, mapPartitionsWithIndex保存操作saveAsTextFile,saveAsSequenceFile,saveAsObjectFile,saveAsHadoopFile 等
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-04-18T13:25:21.000Z">2017-04-18</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="mapPartitions"><a href="#mapPartitions" class="headerlink" title="mapPartitions"></a><strong>mapPartitions</strong></h1><p>mapPartition可以倒过来理解，先partition，再把每个partition进行map函数，<br><strong>适用场景</strong><br>如果在映射的过程中需要频繁创建额外的对象，使用mapPartitions要比map高效的过。</p>
<p>比如，将RDD中的所有数据通过JDBC连接写入数据库，如果使用map函数，可能要为每一个元素都创建一个connection，这样开销很大，如果使用mapPartitions，那么只需要针对每一个分区建立一个connection。<br>下面的例子，<strong>把每一个元素平方</strong><br><strong>java 每一个元素平方</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">        JavaRDD&lt;Integer&gt; rdd = sc.parallelize(</div><div class="line">                Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>));</div><div class="line">        JavaRDD&lt;Integer&gt; mapPartitionRDD = rdd.mapPartitions(<span class="keyword">new</span> FlatMapFunction&lt;Iterator&lt;Integer&gt;, Integer&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Iterable&lt;Integer&gt; <span class="title">call</span><span class="params">(Iterator&lt;Integer&gt; it)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                ArrayList&lt;Integer&gt; results = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                <span class="keyword">while</span> (it.hasNext()) &#123;</div><div class="line">                    <span class="keyword">int</span> i = it.next();</div><div class="line">                    results.add(i*i);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> results;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        mapPartitionRDD.foreach(<span class="keyword">new</span> VoidFunction&lt;Integer&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                System.out.println(integer);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">----------输出-------------</div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">9</span></div><div class="line"><span class="number">16</span></div><div class="line"><span class="number">25</span></div><div class="line"><span class="number">36</span></div><div class="line"><span class="number">49</span></div><div class="line"><span class="number">64</span></div><div class="line"><span class="number">81</span></div><div class="line"><span class="number">100</span></div><div class="line">```  </div><div class="line">**把每一个数字i变成一个map(i,i*i)的形式**</div><div class="line"></div><div class="line">**java，把每一个元素变成map(i,i*i)**</div><div class="line">```java</div><div class="line">        JavaRDD&lt;Tuple2&lt;Integer, Integer&gt;&gt; tuple2JavaRDD = rdd.mapPartitions(<span class="keyword">new</span> FlatMapFunction&lt;Iterator&lt;Integer&gt;, Tuple2&lt;Integer, Integer&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> Iterable&lt;Tuple2&lt;Integer, Integer&gt;&gt; call(Iterator&lt;Integer&gt; it) <span class="keyword">throws</span> Exception &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;Integer, Integer&gt;&gt; tuple2s = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                <span class="keyword">while</span> (it.hasNext()) &#123;</div><div class="line">                    Integer next = it.next();</div><div class="line">                    tuple2s.add(<span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(next, next * next));</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> tuple2s;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        tuple2JavaRDD.foreach(<span class="keyword">new</span> VoidFunction&lt;Tuple2&lt;Integer, Integer&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Tuple2&lt;Integer, Integer&gt; tp2)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                System.out.println(tp2);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">---------输出---------------</div><div class="line">(<span class="number">1</span>,<span class="number">1</span>)</div><div class="line">(<span class="number">2</span>,<span class="number">4</span>)</div><div class="line">(<span class="number">3</span>,<span class="number">9</span>)</div><div class="line">(<span class="number">4</span>,<span class="number">16</span>)</div><div class="line">(<span class="number">5</span>,<span class="number">25</span>)</div><div class="line">(<span class="number">6</span>,<span class="number">36</span>)</div><div class="line">(<span class="number">7</span>,<span class="number">49</span>)</div><div class="line">(<span class="number">8</span>,<span class="number">64</span>)</div><div class="line">(<span class="number">9</span>,<span class="number">81</span>)</div><div class="line">(<span class="number">10</span>,<span class="number">100</span>)</div></pre></td></tr></table></figure></p>
<p><strong>scala 把每一个元素变成map(i,i*i)</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line">    val rdd = sc.parallelize(List(1,2,3,4,5,6,7,8,9,10),3)</div><div class="line">    def mapPartFunc(iter: Iterator[Int]):Iterator[(Int,Int)]=&#123;</div><div class="line">      var res = List[(Int,Int)]()</div><div class="line">      while (iter.hasNext)&#123;</div><div class="line">        val cur = iter.next</div><div class="line">        res=res.::(cur,cur*cur)</div><div class="line">      &#125;</div><div class="line">       res.iterator</div><div class="line">    &#125;</div><div class="line">    val mapPartRDD = rdd.mapPartitions(mapPartFunc)</div><div class="line">    mapPartRDD.foreach(maps=&gt;println(maps))</div><div class="line">----------输出-----------</div><div class="line">(3,9)</div><div class="line">(2,4)</div><div class="line">(1,1)</div><div class="line">(6,36)</div><div class="line">(5,25)</div><div class="line">(4,16)</div><div class="line">(10,100)</div><div class="line">(9,81)</div><div class="line">(8,64)</div><div class="line">(7,49)</div><div class="line">``` </div><div class="line">**mapPartitions操作键值对 把(i,j) 变成(i,j*j)**</div><div class="line">**scala版本**</div><div class="line">```scala</div><div class="line">    var rdd = sc.parallelize(List((1,1), (1,2), (1,3), (2,1), (2,2), (2,3)))</div><div class="line"></div><div class="line">    def mapPartFunc(iter: Iterator[(Int,Int)]):Iterator[(Int,Int)]=&#123;</div><div class="line">      var res = List[(Int,Int)]()</div><div class="line">      while (iter.hasNext)&#123;</div><div class="line">        val cur = iter.next</div><div class="line">        res=res.::(cur._1,cur._2*cur._2)</div><div class="line">      &#125;</div><div class="line">      res.iterator</div><div class="line">    &#125;</div><div class="line">    val mapPartionsRDD = rdd.mapPartitions(mapPartFunc)</div><div class="line">    mapPartionsRDD.foreach(println( _))</div><div class="line">```  </div><div class="line">**java版本**</div><div class="line">```java</div><div class="line">        JavaRDD&lt;Tuple2&lt;Integer, Integer&gt;&gt; rdd = sc.parallelize(Arrays.asList(new Tuple2&lt;Integer, Integer&gt;(1, 1), new Tuple2&lt;Integer, Integer&gt;(1, 2)</div><div class="line">                , new Tuple2&lt;Integer, Integer&gt;(1, 3), new Tuple2&lt;Integer, Integer&gt;(2, 1)</div><div class="line">                , new Tuple2&lt;Integer, Integer&gt;(2, 2), new Tuple2&lt;Integer, Integer&gt;(2, 3)), 3);</div><div class="line">        JavaPairRDD&lt;Integer, Integer&gt; pairRDD = JavaPairRDD.fromJavaRDD(rdd);</div><div class="line">        JavaRDD&lt;Tuple2&lt;Integer, Integer&gt;&gt; tuple2JavaRDD = pairRDD.mapPartitions(new FlatMapFunction&lt;Iterator&lt;Tuple2&lt;Integer, Integer&gt;&gt;, Tuple2&lt;Integer, Integer&gt;&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public Iterable&lt;Tuple2&lt;Integer, Integer&gt;&gt; call(Iterator&lt;Tuple2&lt;Integer, Integer&gt;&gt; tp2It) throws Exception &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;Integer, Integer&gt;&gt; tuple2s = new ArrayList&lt;&gt;();</div><div class="line">                while (tp2It.hasNext())&#123;</div><div class="line">                    Tuple2&lt;Integer, Integer&gt; next = tp2It.next();</div><div class="line">                    tuple2s.add(new Tuple2&lt;Integer, Integer&gt;(next._1,next._2*next._2));</div><div class="line">                &#125;</div><div class="line">                return tuple2s;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        tuple2JavaRDD.foreach(new VoidFunction&lt;Tuple2&lt;Integer, Integer&gt;&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public void call(Tuple2&lt;Integer, Integer&gt; tp2) throws Exception &#123;</div><div class="line">                System.out.println(tp2);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">-----------------输出---------------</div><div class="line">(1,1)</div><div class="line">(1,4)</div><div class="line">(1,9)</div><div class="line">(2,1)</div><div class="line">(2,4)</div><div class="line">(2,9)</div><div class="line">```  </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># **mapPartitionsWithIndex**  </div><div class="line">与mapPartitionWithIndex类似，也是按照分区进行的map操作，不过mapPartitionsWithIndex传入的参数多了一个分区的值，下面举个例子,为统计各个分区中的元素 (稍加修改可以做统计各个分区的数量)</div><div class="line"></div><div class="line">**java**</div><div class="line">```java</div><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9, 10), 3);</div><div class="line">        JavaRDD&lt;Tuple2&lt;Integer, Integer&gt;&gt; tuple2JavaRDD = rdd.mapPartitionsWithIndex(new Function2&lt;Integer, Iterator&lt;Integer&gt;, Iterator&lt;Tuple2&lt;Integer, Integer&gt;&gt;&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public Iterator&lt;Tuple2&lt;Integer, Integer&gt;&gt; call(Integer partIndex, Iterator&lt;Integer&gt; it) throws Exception &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;Integer, Integer&gt;&gt; tuple2s = new ArrayList&lt;&gt;();</div><div class="line">                while (it.hasNext()) &#123;</div><div class="line">                    int next = it.next();</div><div class="line">                    tuple2s.add(new Tuple2&lt;&gt;(partIndex, next));</div><div class="line">                &#125;</div><div class="line">                return tuple2s.iterator();</div><div class="line">            &#125;</div><div class="line">        &#125;, false);</div><div class="line"></div><div class="line">        tuple2JavaRDD.foreach(new VoidFunction&lt;Tuple2&lt;Integer, Integer&gt;&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public void call(Tuple2&lt;Integer, Integer&gt; tp2) throws Exception &#123;</div><div class="line">                System.out.println(tp2);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">-------输出-------------</div><div class="line">(0,1)</div><div class="line">(0,2)</div><div class="line">(0,3)</div><div class="line">(1,4)</div><div class="line">(1,5)</div><div class="line">(1,6)</div><div class="line">(2,7)</div><div class="line">(2,8)</div><div class="line">(2,9)</div><div class="line">(2,10)</div><div class="line">``` </div><div class="line">**scala**</div></pre></td></tr></table></figure></p>
<pre><code>val rdd = sc.parallelize(List(1,2,3,4,5,6,7,8,9,10),3)

def mapPartIndexFunc(i1:Int,iter: Iterator[Int]):Iterator[(Int,Int)]={
  var res = List[(Int,Int)]()
  while(iter.hasNext){
    var next = iter.next()
    res=res.::(i1,next)
  }
  res.iterator
}
var mapPartIndexRDDs = rdd.mapPartitionsWithIndex(mapPartIndexFunc)

mapPartIndexRDDs.foreach(println( _))
</code></pre><p>————输出——-<br>(0,3)<br>(0,2)<br>(0,1)<br>(1,6)<br>(1,5)<br>(1,4)<br>(2,10)<br>(2,9)<br>(2,8)<br>(2,7)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">**mapPartitionsWithIndex 统计键值对中的各个分区的元素**  </div><div class="line">**scala版本**</div><div class="line">```scala</div><div class="line">var rdd = sc.parallelize(List((1,1), (1,2), (2,3), (2,4), (3,5), (3,6),(4,7), (4,8),(5,9), (5,10)),3)</div><div class="line"></div><div class="line">    def mapPartIndexFunc(i1:Int,iter: Iterator[(Int,Int)]):Iterator[(Int,(Int,Int))]=&#123;</div><div class="line">      var res = List[(Int,(Int,Int))]()</div><div class="line">      while(iter.hasNext)&#123;</div><div class="line">        var next = iter.next()</div><div class="line">        res=res.::(i1,next)</div><div class="line">      &#125;</div><div class="line">      res.iterator</div><div class="line">    &#125;</div><div class="line">    val mapPartIndexRDD = rdd.mapPartitionsWithIndex(mapPartIndexFunc)</div><div class="line"></div><div class="line">    mapPartIndexRDD.foreach(println( _))</div><div class="line">-----------输出---------</div><div class="line">(0,(1,1))</div><div class="line">(0,(1,2))</div><div class="line">(0,(2,3))</div><div class="line">(1,(2,4))</div><div class="line">(1,(3,5))</div><div class="line">(1,(3,6))</div><div class="line">(2,(4,7))</div><div class="line">(2,(4,8))</div><div class="line">(2,(5,9))</div><div class="line">(2,(5,10))</div></pre></td></tr></table></figure></p>
<p><strong>java版本</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">        JavaRDD&lt;Tuple2&lt;Integer, Integer&gt;&gt; rdd = sc.parallelize(Arrays.asList(new Tuple2&lt;Integer, Integer&gt;(1, 1), new Tuple2&lt;Integer, Integer&gt;(1, 2)</div><div class="line">                , new Tuple2&lt;Integer, Integer&gt;(2, 3), new Tuple2&lt;Integer, Integer&gt;(2, 4)</div><div class="line">                , new Tuple2&lt;Integer, Integer&gt;(3, 5), new Tuple2&lt;Integer, Integer&gt;(3, 6)</div><div class="line">                , new Tuple2&lt;Integer, Integer&gt;(4, 7), new Tuple2&lt;Integer, Integer&gt;(4, 8)</div><div class="line">                , new Tuple2&lt;Integer, Integer&gt;(5, 9), new Tuple2&lt;Integer, Integer&gt;(5, 10)</div><div class="line">                ), 3);</div><div class="line">        JavaPairRDD&lt;Integer, Integer&gt; pairRDD = JavaPairRDD.fromJavaRDD(rdd);</div><div class="line"></div><div class="line">        JavaRDD&lt;Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;&gt; mapPartitionIndexRDD = pairRDD.mapPartitionsWithIndex(new Function2&lt;Integer, Iterator&lt;Tuple2&lt;Integer, Integer&gt;&gt;, Iterator&lt;Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;&gt;&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public Iterator&lt;Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;&gt; call(Integer partIndex, Iterator&lt;Tuple2&lt;Integer, Integer&gt;&gt; tuple2Iterator) &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;&gt; tuple2s = new ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">                while (tuple2Iterator.hasNext()) &#123;</div><div class="line">                    Tuple2&lt;Integer, Integer&gt; next = tuple2Iterator.next();</div><div class="line">                    tuple2s.add(new Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;(partIndex, next));</div><div class="line">                &#125;</div><div class="line">                return tuple2s.iterator();</div><div class="line">            &#125;</div><div class="line">        &#125;, false);</div><div class="line"></div><div class="line">        mapPartitionIndexRDD.foreach(new VoidFunction&lt;Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt;&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public void call(Tuple2&lt;Integer, Tuple2&lt;Integer, Integer&gt;&gt; integerTuple2Tuple2) throws Exception &#123;</div><div class="line">                System.out.println(integerTuple2Tuple2);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">--------------输出---------</div><div class="line">(0,(1,1))</div><div class="line">(0,(1,2))</div><div class="line">(0,(2,3))</div><div class="line">(1,(2,4))</div><div class="line">(1,(3,5))</div><div class="line">(1,(3,6))</div><div class="line">(2,(4,7))</div><div class="line">(2,(4,8))</div><div class="line">(2,(5,9))</div><div class="line">(2,(5,10))</div></pre></td></tr></table></figure></p>
<p>mapPartitionsWithIndex 中 第二个参数，true还是false<br>这篇文章有些探讨,<a href="http://stackoverflow.com/questions/38048904/how-to-use-function-mappartitionswithindex-in-spark/38049239，个人还未理解" target="_blank" rel="external">http://stackoverflow.com/questions/38048904/how-to-use-function-mappartitionswithindex-in-spark/38049239，个人还未理解</a> TODO  </p>
<p>补充： 打印各个分区的操作，可以使用 glom 的方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Tuple2&lt;Integer, Integer&gt;&gt; rdd1 = sc.parallelize(Arrays.asList(<span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">1</span>, <span class="number">1</span>), <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">1</span>, <span class="number">2</span>)</div><div class="line">                , <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">2</span>, <span class="number">3</span>), <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">2</span>, <span class="number">4</span>)</div><div class="line">                , <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">3</span>, <span class="number">5</span>), <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">3</span>, <span class="number">6</span>)</div><div class="line">                , <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">4</span>, <span class="number">7</span>), <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">4</span>, <span class="number">8</span>)</div><div class="line">                , <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">5</span>, <span class="number">9</span>), <span class="keyword">new</span> Tuple2&lt;Integer, Integer&gt;(<span class="number">5</span>, <span class="number">10</span>)</div><div class="line">        ), <span class="number">3</span>);</div><div class="line">        JavaPairRDD&lt;Integer, Integer&gt; pairRDD = JavaPairRDD.fromJavaRDD(rdd1);</div><div class="line">        <span class="comment">/*补充：打印各个分区的操作，可以使用 glom 的方法*/</span></div><div class="line">        System.out.println(<span class="string">"打印各个分区的操作，可以使用 glom 的方法"</span>);</div><div class="line">        JavaRDD&lt;List&lt;Tuple2&lt;Integer, Integer&gt;&gt;&gt; glom = pairRDD.glom();</div><div class="line">        glom.foreach(<span class="keyword">new</span> VoidFunction&lt;List&lt;Tuple2&lt;Integer, Integer&gt;&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(List&lt;Tuple2&lt;Integer, Integer&gt;&gt; tuple2s)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                System.out.println(tuple2s);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line"><span class="comment">//************************* 输出 </span></div><div class="line">打印各个分区的操作，可以使用 glom 的方法</div><div class="line">[(<span class="number">1</span>,<span class="number">1</span>), (<span class="number">1</span>,<span class="number">2</span>), (<span class="number">2</span>,<span class="number">3</span>)]</div><div class="line">[(<span class="number">2</span>,<span class="number">4</span>), (<span class="number">3</span>,<span class="number">5</span>), (<span class="number">3</span>,<span class="number">6</span>)]</div><div class="line">[(<span class="number">4</span>,<span class="number">7</span>), (<span class="number">4</span>,<span class="number">8</span>), (<span class="number">5</span>,<span class="number">9</span>), (<span class="number">5</span>,<span class="number">10</span>)]</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-12.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-12.html" title="spark RDD算子（十二）之RDD 分区操作上mapPartitions, mapPartitionsWithIndex保存操作saveAsTextFile,saveAsSequenceFile,saveAsObjectFile,saveAsHadoopFile 等">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/8.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-11.html">
    		spark RDD算子（十一）之RDD Action 保存操作saveAsTextFile,saveAsSequenceFile,saveAsObjectFile,saveAsHadoopFile 等
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-04-11T13:25:21.000Z">2017-04-11</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <hr>
<p>关键字:Spark算子、Spark函数、Spark RDD行动Action、Spark RDD存储操作、saveAsTextFile、saveAsSequenceFile、saveAsObjectFile,saveAsHadoopFile、saveAsHadoopDataset,saveAsNewAPIHadoopFile、saveAsNewAPIHadoopDataset </p>
<hr>
<h1 id="saveAsTextFile"><a href="#saveAsTextFile" class="headerlink" title="saveAsTextFile"></a><strong>saveAsTextFile</strong></h1><p>def saveAsTextFile(path: String): Unit</p>
<p>def saveAsTextFile(path: String, codec: Class[_ &lt;: CompressionCodec]): Unit</p>
<p>saveAsTextFile用于将RDD以文本文件的格式存储到文件系统中。</p>
<p>codec参数可以指定压缩的类名。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> rdd1 = sc.makeRDD(<span class="number">1</span> to <span class="number">10</span>,<span class="number">2</span>)</div><div class="line">scala&gt; rdd1.saveAsTextFile(<span class="string">"hdfs://cdh5/tmp/lxw1234.com/"</span>) <span class="comment">//保存到HDFS</span></div><div class="line">hadoop fs -ls /tmp/lxw1234.com</div><div class="line"><span class="type">Found</span> <span class="number">2</span> items</div><div class="line">-rw-r--r--   <span class="number">2</span> lxw1234 supergroup        <span class="number">0</span> <span class="number">2015</span><span class="number">-07</span><span class="number">-10</span> <span class="number">09</span>:<span class="number">15</span> /tmp/lxw1234.com/_SUCCESS</div><div class="line">-rw-r--r--   <span class="number">2</span> lxw1234 supergroup        <span class="number">21</span> <span class="number">2015</span><span class="number">-07</span><span class="number">-10</span> <span class="number">09</span>:<span class="number">15</span> /tmp/lxw1234.com/part<span class="number">-00000</span></div><div class="line"> </div><div class="line">hadoop fs -cat /tmp/lxw1234.com/part<span class="number">-00000</span></div></pre></td></tr></table></figure></p>
<p>注意：如果使用rdd1.saveAsTextFile(“file:///tmp/lxw1234.com”)将文件保存到本地文件系统，那么只会保存在Executor所在机器的本地目录。<br><strong>指定压缩格式保存</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">rdd1.saveAsTextFile(<span class="string">"hdfs://cdh5/tmp/lxw1234.com/"</span>,classOf[com.hadoop.compression.lzo.<span class="type">LzopCodec</span>])</div><div class="line"> </div><div class="line">hadoop fs -ls /tmp/lxw1234.com</div><div class="line">-rw-r--r--   <span class="number">2</span> lxw1234 supergroup    <span class="number">0</span> <span class="number">2015</span><span class="number">-07</span><span class="number">-10</span> <span class="number">09</span>:<span class="number">20</span> /tmp/lxw1234.com/_SUCCESS</div><div class="line">-rw-r--r--   <span class="number">2</span> lxw1234 supergroup    <span class="number">71</span> <span class="number">2015</span><span class="number">-07</span><span class="number">-10</span> <span class="number">09</span>:<span class="number">20</span> /tmp/lxw1234.com/part<span class="number">-00000.</span>lzo</div><div class="line"> </div><div class="line">hadoop fs -text /tmp/lxw1234.com/part<span class="number">-00000.</span>lzo</div></pre></td></tr></table></figure></p>
<h1 id="saveAsSequenceFile"><a href="#saveAsSequenceFile" class="headerlink" title="saveAsSequenceFile"></a><strong>saveAsSequenceFile</strong></h1><p>saveAsSequenceFile用于将RDD以SequenceFile的文件格式保存到HDFS上。</p>
<p>用法同saveAsTextFile。</p>
<h1 id="saveAsObjectFile"><a href="#saveAsObjectFile" class="headerlink" title="saveAsObjectFile"></a><strong>saveAsObjectFile</strong></h1><p>def saveAsObjectFile(path: String): Unit</p>
<p>saveAsObjectFile用于将RDD中的元素序列化成对象，存储到文件中。</p>
<p>对于HDFS，默认采用SequenceFile保存。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> rdd1 = sc.makeRDD(<span class="number">1</span> to <span class="number">10</span>,<span class="number">2</span>)</div><div class="line">rdd1.saveAsObjectFile(<span class="string">"hdfs://cdh5/tmp/lxw1234.com/"</span>)</div><div class="line"> </div><div class="line">hadoop fs -cat /tmp/lxw1234.com/part<span class="number">-00000</span></div><div class="line"><span class="type">SEQ</span> !org.apache.hadoop.io.<span class="type">NullWritable</span><span class="string">"org.apache.hadoop.io.BytesWritableT</span></div></pre></td></tr></table></figure></p>
<h1 id="saveAsHadoopFile"><a href="#saveAsHadoopFile" class="headerlink" title="saveAsHadoopFile"></a><strong>saveAsHadoopFile</strong></h1><p>def saveAsHadoopFile(path: String, keyClass: Class[<em>], valueClass: Class[</em>], outputFormatClass: Class[<em> &lt;: OutputFormat[</em>, <em>]], codec: Class[</em> &lt;: CompressionCodec]): Unit</p>
<p>def saveAsHadoopFile(path: String, keyClass: Class[<em>], valueClass: Class[</em>], outputFormatClass: Class[<em> &lt;: OutputFormat[</em>, <em>]], conf: JobConf = …, codec: Option[Class[</em> &lt;: CompressionCodec]] = None): Unit</p>
<p>saveAsHadoopFile是将RDD存储在HDFS上的文件中，支持老版本Hadoop API。</p>
<p>可以指定outputKeyClass、outputValueClass以及压缩格式。</p>
<p>每个分区输出一个文件。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> rdd1 = sc.makeRDD(<span class="type">Array</span>((<span class="string">"A"</span>,<span class="number">2</span>),(<span class="string">"A"</span>,<span class="number">1</span>),(<span class="string">"B"</span>,<span class="number">6</span>),(<span class="string">"B"</span>,<span class="number">3</span>),(<span class="string">"B"</span>,<span class="number">7</span>)))</div><div class="line"> </div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapred.<span class="type">TextOutputFormat</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">Text</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">IntWritable</span></div><div class="line"> </div><div class="line">rdd1.saveAsHadoopFile(<span class="string">"/tmp/lxw1234.com/"</span>,classOf[<span class="type">Text</span>],classOf[<span class="type">IntWritable</span>],classOf[<span class="type">TextOutputFormat</span>[<span class="type">Text</span>,<span class="type">IntWritable</span>]])</div><div class="line"> </div><div class="line">rdd1.saveAsHadoopFile(<span class="string">"/tmp/lxw1234.com/"</span>,classOf[<span class="type">Text</span>],classOf[<span class="type">IntWritable</span>],classOf[<span class="type">TextOutputFormat</span>[<span class="type">Text</span>,<span class="type">IntWritable</span>]],</div><div class="line">                      classOf[com.hadoop.compression.lzo.<span class="type">LzopCodec</span>])</div><div class="line">```  </div><div class="line"># **saveAsHadoopDataset**  </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">saveAsHadoopDataset</span></span>(conf: <span class="type">JobConf</span>): <span class="type">Unit</span></div><div class="line"></div><div class="line">saveAsHadoopDataset用于将<span class="type">RDD</span>保存到除了<span class="type">HDFS</span>的其他存储中，比如<span class="type">HBase</span>。</div><div class="line"></div><div class="line">在<span class="type">JobConf</span>中，通常需要关注或者设置五个参数：</div><div class="line"></div><div class="line">文件的保存路径、key值的<span class="class"><span class="keyword">class</span><span class="title">类型、value值的class类型、RDD的输出格式</span>(<span class="params"><span class="type">OutputFormat</span></span>)<span class="title">、以及压缩相关的参数。</span>  </span></div><div class="line"><span class="class"><span class="title">**##使用saveAsHadoopDataset将RDD保存到HDFS中**</span>  </span></div><div class="line"><span class="class">```<span class="title">scala</span></span></div><div class="line"><span class="class"><span class="title">import</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">spark</span>.<span class="title">SparkConf</span></span></div><div class="line"><span class="class"><span class="title">import</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">spark</span>.<span class="title">SparkContext</span></span></div><div class="line"><span class="class"><span class="title">import</span> <span class="title">SparkContext</span>.<span class="title">_</span></span></div><div class="line"><span class="class"><span class="title">import</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">hadoop</span>.<span class="title">mapred</span>.<span class="title">TextOutputFormat</span></span></div><div class="line"><span class="class"><span class="title">import</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">hadoop</span>.<span class="title">io</span>.<span class="title">Text</span></span></div><div class="line"><span class="class"><span class="title">import</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">hadoop</span>.<span class="title">io</span>.<span class="title">IntWritable</span></span></div><div class="line"><span class="class"><span class="title">import</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">hadoop</span>.<span class="title">mapred</span>.<span class="title">JobConf</span></span></div><div class="line"><span class="class"> </span></div><div class="line"><span class="class"> </span></div><div class="line"><span class="class"> </span></div><div class="line"><span class="class"><span class="title">var</span> <span class="title">rdd1</span> </span>= sc.makeRDD(<span class="type">Array</span>((<span class="string">"A"</span>,<span class="number">2</span>),(<span class="string">"A"</span>,<span class="number">1</span>),(<span class="string">"B"</span>,<span class="number">6</span>),(<span class="string">"B"</span>,<span class="number">3</span>),(<span class="string">"B"</span>,<span class="number">7</span>)))</div><div class="line"><span class="keyword">var</span> jobConf = <span class="keyword">new</span> <span class="type">JobConf</span>()</div><div class="line">jobConf.setOutputFormat(classOf[<span class="type">TextOutputFormat</span>[<span class="type">Text</span>,<span class="type">IntWritable</span>]])</div><div class="line">jobConf.setOutputKeyClass(classOf[<span class="type">Text</span>])</div><div class="line">jobConf.setOutputValueClass(classOf[<span class="type">IntWritable</span>])</div><div class="line">jobConf.set(<span class="string">"mapred.output.dir"</span>,<span class="string">"/tmp/lxw1234/"</span>)</div><div class="line">rdd1.saveAsHadoopDataset(jobConf)</div><div class="line"> </div><div class="line">结果：</div><div class="line">hadoop fs -cat /tmp/lxw1234/part<span class="number">-00000</span></div><div class="line"><span class="type">A</span>       <span class="number">2</span></div><div class="line"><span class="type">A</span>       <span class="number">1</span></div><div class="line">hadoop fs -cat /tmp/lxw1234/part<span class="number">-00001</span></div><div class="line"><span class="type">B</span>       <span class="number">6</span></div><div class="line"><span class="type">B</span>       <span class="number">3</span></div><div class="line"><span class="type">B</span>       <span class="number">7</span></div><div class="line">```  </div><div class="line">**##保存数据到<span class="type">HBASE</span>**  </div><div class="line"><span class="type">HBase</span>建表：</div><div class="line"></div><div class="line">create ‘lxw1234′,&#123;<span class="type">NAME</span> =&gt; ‘f1′,<span class="type">VERSIONS</span> =&gt; <span class="number">1</span>&#125;,&#123;<span class="type">NAME</span> =&gt; ‘f2′,<span class="type">VERSIONS</span> =&gt; <span class="number">1</span>&#125;,&#123;<span class="type">NAME</span> =&gt; ‘f3′,<span class="type">VERSIONS</span> =&gt; <span class="number">1</span>&#125;  </div><div class="line">```scala</div><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span></div><div class="line"><span class="keyword">import</span> <span class="type">SparkContext</span>._</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapred.<span class="type">TextOutputFormat</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">Text</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">IntWritable</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapred.<span class="type">JobConf</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.<span class="type">HBaseConfiguration</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapred.<span class="type">TableOutputFormat</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.<span class="type">Put</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.<span class="type">Bytes</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.<span class="type">ImmutableBytesWritable</span></div><div class="line"> </div><div class="line"><span class="keyword">var</span> conf = <span class="type">HBaseConfiguration</span>.create()</div><div class="line">    <span class="keyword">var</span> jobConf = <span class="keyword">new</span> <span class="type">JobConf</span>(conf)</div><div class="line">    jobConf.set(<span class="string">"hbase.zookeeper.quorum"</span>,<span class="string">"zkNode1,zkNode2,zkNode3"</span>)</div><div class="line">    jobConf.set(<span class="string">"zookeeper.znode.parent"</span>,<span class="string">"/hbase"</span>)</div><div class="line">    jobConf.set(<span class="type">TableOutputFormat</span>.<span class="type">OUTPUT_TABLE</span>,<span class="string">"lxw1234"</span>)</div><div class="line">    jobConf.setOutputFormat(classOf[<span class="type">TableOutputFormat</span>])</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> rdd1 = sc.makeRDD(<span class="type">Array</span>((<span class="string">"A"</span>,<span class="number">2</span>),(<span class="string">"B"</span>,<span class="number">6</span>),(<span class="string">"C"</span>,<span class="number">7</span>)))</div><div class="line">    rdd1.map(x =&gt; </div><div class="line">      &#123;</div><div class="line">        <span class="keyword">var</span> put = <span class="keyword">new</span> <span class="type">Put</span>(<span class="type">Bytes</span>.toBytes(x._1))</div><div class="line">        put.add(<span class="type">Bytes</span>.toBytes(<span class="string">"f1"</span>), <span class="type">Bytes</span>.toBytes(<span class="string">"c1"</span>), <span class="type">Bytes</span>.toBytes(x._2))</div><div class="line">        (<span class="keyword">new</span> <span class="type">ImmutableBytesWritable</span>,put)</div><div class="line">      &#125;</div><div class="line">    ).saveAsHadoopDataset(jobConf)</div><div class="line"> </div><div class="line">##结果：</div><div class="line">hbase(main):<span class="number">005</span>:<span class="number">0</span>&gt; scan <span class="symbol">'lxw123</span>4'</div><div class="line"><span class="type">ROW</span>     <span class="type">COLUMN</span>+<span class="type">CELL</span>                                                                                                </div><div class="line"> <span class="type">A</span>       column=f1:c1, timestamp=<span class="number">1436504941187</span>, value=\x00\x00\x00\x02                                              </div><div class="line"> <span class="type">B</span>       column=f1:c1, timestamp=<span class="number">1436504941187</span>, value=\x00\x00\x00\x06                                              </div><div class="line"> <span class="type">C</span>       column=f1:c1, timestamp=<span class="number">1436504941187</span>, value=\x00\x00\x00\x07                                              </div><div class="line"><span class="number">3</span> row(s) in <span class="number">0.0550</span> seconds</div><div class="line">```  </div><div class="line">注意：保存到<span class="type">HBase</span>，运行时候需要在<span class="type">SPARK_CLASSPATH</span>中加入<span class="type">HBase</span>相关的jar包。</div><div class="line"></div><div class="line">可参考：http:<span class="comment">//lxw1234.com/archives/2015/07/332.htm  </span></div><div class="line"># **saveAsNewAPIHadoopFile**  </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">saveAsNewAPIHadoopFile</span></span>[<span class="type">F</span> &lt;: <span class="type">OutputFormat</span>[<span class="type">K</span>, <span class="type">V</span>]](path: <span class="type">String</span>)(<span class="keyword">implicit</span> fm: <span class="type">ClassTag</span>[<span class="type">F</span>]): <span class="type">Unit</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">saveAsNewAPIHadoopFile</span></span>(path: <span class="type">String</span>, keyClass: <span class="type">Class</span>[_], valueClass: <span class="type">Class</span>[_], outputFormatClass: <span class="type">Class</span>[_ &lt;: <span class="type">OutputFormat</span>[_, _]], conf: <span class="type">Configuration</span> = self.context.hadoopConfiguration): <span class="type">Unit</span></div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">saveAsNewAPIHadoopFile用于将<span class="type">RDD</span>数据保存到<span class="type">HDFS</span>上，使用新版本<span class="type">Hadoop</span> <span class="type">API</span>。</div><div class="line"></div><div class="line">用法基本同saveAsHadoopFile。</div><div class="line">```scala</div><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span></div><div class="line"><span class="keyword">import</span> <span class="type">SparkContext</span>._</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.<span class="type">TextOutputFormat</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">Text</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">IntWritable</span></div><div class="line"> </div><div class="line"><span class="keyword">var</span> rdd1 = sc.makeRDD(<span class="type">Array</span>((<span class="string">"A"</span>,<span class="number">2</span>),(<span class="string">"A"</span>,<span class="number">1</span>),(<span class="string">"B"</span>,<span class="number">6</span>),(<span class="string">"B"</span>,<span class="number">3</span>),(<span class="string">"B"</span>,<span class="number">7</span>)))</div><div class="line">rdd1.saveAsNewAPIHadoopFile(<span class="string">"/tmp/lxw1234/"</span>,classOf[<span class="type">Text</span>],classOf[<span class="type">IntWritable</span>],classOf[<span class="type">TextOutputFormat</span>[<span class="type">Text</span>,<span class="type">IntWritable</span>]])</div><div class="line">```  </div><div class="line"># **saveAsNewAPIHadoopDataset**</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">saveAsNewAPIHadoopDataset</span></span>(conf: <span class="type">Configuration</span>): <span class="type">Unit</span></div><div class="line"></div><div class="line">作用同saveAsHadoopDataset,只不过采用新版本<span class="type">Hadoop</span> <span class="type">API</span>。</div><div class="line"></div><div class="line">以写入<span class="type">HBase</span>为例：</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line"><span class="type">HBase</span>建表：</div><div class="line"></div><div class="line">create ‘lxw1234′,&#123;<span class="type">NAME</span> =&gt; ‘f1′,<span class="type">VERSIONS</span> =&gt; <span class="number">1</span>&#125;,&#123;<span class="type">NAME</span> =&gt; ‘f2′,<span class="type">VERSIONS</span> =&gt; <span class="number">1</span>&#125;,&#123;<span class="type">NAME</span> =&gt; ‘f3′,<span class="type">VERSIONS</span> =&gt; <span class="number">1</span>&#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">完整的<span class="type">Spark</span>应用程序：  </div><div class="line">```scala</div><div class="line"><span class="keyword">package</span> com.lxw1234.test</div><div class="line"> </div><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></div><div class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span></div><div class="line"><span class="keyword">import</span> <span class="type">SparkContext</span>._</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.<span class="type">HBaseConfiguration</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.<span class="type">Job</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.<span class="type">TableOutputFormat</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.<span class="type">ImmutableBytesWritable</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.<span class="type">Result</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.<span class="type">Bytes</span></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.<span class="type">Put</span></div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args : <span class="type">Array</span>[<span class="type">String</span>]) &#123;</div><div class="line">   <span class="keyword">val</span> sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">"spark://lxw1234.com:7077"</span>).setAppName(<span class="string">"lxw1234.com"</span>)</div><div class="line">   <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(sparkConf);</div><div class="line">   <span class="keyword">var</span> rdd1 = sc.makeRDD(<span class="type">Array</span>((<span class="string">"A"</span>,<span class="number">2</span>),(<span class="string">"B"</span>,<span class="number">6</span>),(<span class="string">"C"</span>,<span class="number">7</span>)))</div><div class="line">   </div><div class="line">    sc.hadoopConfiguration.set(<span class="string">"hbase.zookeeper.quorum "</span>,<span class="string">"zkNode1,zkNode2,zkNode3"</span>)</div><div class="line">    sc.hadoopConfiguration.set(<span class="string">"zookeeper.znode.parent"</span>,<span class="string">"/hbase"</span>)</div><div class="line">    sc.hadoopConfiguration.set(<span class="type">TableOutputFormat</span>.<span class="type">OUTPUT_TABLE</span>,<span class="string">"lxw1234"</span>)</div><div class="line">    <span class="keyword">var</span> job = <span class="keyword">new</span> <span class="type">Job</span>(sc.hadoopConfiguration)</div><div class="line">    job.setOutputKeyClass(classOf[<span class="type">ImmutableBytesWritable</span>])</div><div class="line">    job.setOutputValueClass(classOf[<span class="type">Result</span>])</div><div class="line">    job.setOutputFormatClass(classOf[<span class="type">TableOutputFormat</span>[<span class="type">ImmutableBytesWritable</span>]])</div><div class="line">    </div><div class="line">    rdd1.map(</div><div class="line">      x =&gt; &#123;</div><div class="line">        <span class="keyword">var</span> put = <span class="keyword">new</span> <span class="type">Put</span>(<span class="type">Bytes</span>.toBytes(x._1))</div><div class="line">        put.add(<span class="type">Bytes</span>.toBytes(<span class="string">"f1"</span>), <span class="type">Bytes</span>.toBytes(<span class="string">"c1"</span>), <span class="type">Bytes</span>.toBytes(x._2))</div><div class="line">        (<span class="keyword">new</span> <span class="type">ImmutableBytesWritable</span>,put)</div><div class="line">      &#125;    </div><div class="line">    ).saveAsNewAPIHadoopDataset(job.getConfiguration)</div><div class="line">    </div><div class="line">    sc.stop()   </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意：保存到HBase，运行时候需要在SPARK_CLASSPATH中加入HBase相关的jar包。</p>
<p>可参考：<a href="http://lxw1234.com/archives/2015/07/332.htm" target="_blank" rel="external">http://lxw1234.com/archives/2015/07/332.htm</a>  </p>
<p>感谢原作者的总结<br>本文转自: lxw的大数据田地<br><a href="http://lxw1234.com/archives/2015/07/402.htm" target="_blank" rel="external">http://lxw1234.com/archives/2015/07/402.htm</a><br><a href="http://lxw1234.com/archives/2015/07/404.htm" target="_blank" rel="external">http://lxw1234.com/archives/2015/07/404.htm</a><br><a href="http://lxw1234.com/archives/2015/07/406.htm" target="_blank" rel="external">http://lxw1234.com/archives/2015/07/406.htm</a></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-11.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-11.html" title="spark RDD算子（十一）之RDD Action 保存操作saveAsTextFile,saveAsSequenceFile,saveAsObjectFile,saveAsHadoopFile 等">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/1.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-10.html">
    		spark RDD算子（十）之PairRDD的Action操作countByKey, collectAsMap
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-04-05T13:25:21.000Z">2017-04-05</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="countByKey"><a href="#countByKey" class="headerlink" title="countByKey"></a><strong>countByKey</strong></h1><p>def countByKey(): Map[K, Long]<br>以RDD{(1, 2),(2,4),(2,5), (3, 4),(3,5), (3, 6)}为例  rdd.countByKey会返回{(1,1),(2,2),(3,3)}<br><strong>scala例子</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">Array</span>((<span class="number">1</span>, <span class="number">2</span>),(<span class="number">2</span>,<span class="number">4</span>),(<span class="number">2</span>,<span class="number">5</span>), (<span class="number">3</span>, <span class="number">4</span>),(<span class="number">3</span>,<span class="number">5</span>), (<span class="number">3</span>, <span class="number">6</span>)))</div><div class="line"></div><div class="line">scala&gt; <span class="keyword">val</span> countbyKeyRDD = rdd.countByKey()</div><div class="line">countbyKeyRDD: scala.collection.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">Long</span>] = <span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="number">1</span>, <span class="number">2</span> -&gt; <span class="number">2</span>, <span class="number">3</span> -&gt; <span class="number">3</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java例子</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">    JavaRDD&lt;Tuple2&lt;Integer, Integer&gt;&gt; tupleRDD =</div><div class="line">            sc.parallelize(Arrays.asList(<span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">1</span>, <span class="number">2</span>),</div><div class="line">            <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">2</span>, <span class="number">4</span>),</div><div class="line">            <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">2</span>, <span class="number">5</span>),</div><div class="line">            <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">3</span>, <span class="number">4</span>),</div><div class="line">            <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">3</span>, <span class="number">5</span>),</div><div class="line">            <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">3</span>, <span class="number">6</span>)));</div><div class="line">    JavaPairRDD&lt;Integer, Integer&gt; mapRDD = JavaPairRDD.fromJavaRDD(tupleRDD);</div><div class="line">    <span class="comment">//countByKey</span></div><div class="line">    Map&lt;Integer, Object&gt; countByKeyRDD = mapRDD.countByKey();</div><div class="line">    <span class="keyword">for</span> (Integer i:countByKeyRDD.keySet()) &#123;</div><div class="line">        System.out.println(<span class="string">"("</span>+i+<span class="string">", "</span>+countByKeyRDD.get(i)+<span class="string">")"</span>);</div><div class="line">    &#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">输出  </span></div><div class="line"><span class="comment">(1, 1)</span></div><div class="line"><span class="comment">(3, 3)</span></div><div class="line"><span class="comment">(2, 2)</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure></p>
<h1 id="collectAsMap"><a href="#collectAsMap" class="headerlink" title="collectAsMap"></a><strong>collectAsMap</strong></h1><p>将pair类型(键值对类型)的RDD转换成map, 还是上面的例子</p>
<p><strong>scala例子</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">Array</span>((<span class="number">1</span>, <span class="number">2</span>),(<span class="number">2</span>,<span class="number">4</span>),(<span class="number">2</span>,<span class="number">5</span>), (<span class="number">3</span>, <span class="number">4</span>),(<span class="number">3</span>,<span class="number">5</span>), (<span class="number">3</span>, <span class="number">6</span>)))</div><div class="line"></div><div class="line">scala&gt; rdd.collectAsMap()</div><div class="line">res1: scala.collection.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">Int</span>] = <span class="type">Map</span>(<span class="number">2</span> -&gt; <span class="number">5</span>, <span class="number">1</span> -&gt; <span class="number">2</span>, <span class="number">3</span> -&gt; <span class="number">6</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java例子</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Tuple2&lt;Integer, Integer&gt;&gt; tupleRDD =</div><div class="line">        sc.parallelize(Arrays.asList(<span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">1</span>, <span class="number">2</span>),</div><div class="line">        <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">2</span>, <span class="number">4</span>),</div><div class="line">        <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">2</span>, <span class="number">5</span>),</div><div class="line">        <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">3</span>, <span class="number">4</span>),</div><div class="line">        <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">3</span>, <span class="number">5</span>),</div><div class="line">        <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">3</span>, <span class="number">6</span>)));</div><div class="line">JavaPairRDD&lt;Integer, Integer&gt; mapRDD = JavaPairRDD.fromJavaRDD(tupleRDD);</div><div class="line"></div><div class="line">Map&lt;Integer, Integer&gt; collectMap = mapRDD.collectAsMap();</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-10.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-10.html" title="spark RDD算子（十）之PairRDD的Action操作countByKey, collectAsMap">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/5.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-9.html">
    		spark RDD算子（九）之基本的Action操作 first, take, collect, count, countByValue, reduce, aggregate, fold,top
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-28T13:25:21.000Z">2017-03-28</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="first"><a href="#first" class="headerlink" title="first"></a><strong>first</strong></h1><p>返回第一个元素<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.first()</div><div class="line">res1: <span class="type">Int</span> = <span class="number">1</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>));</div><div class="line">Integer first = rdd.first();</div></pre></td></tr></table></figure></p>
<h1 id="take"><a href="#take" class="headerlink" title="take"></a><strong>take</strong></h1><p>rdd.take(n)返回第n个元素<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.take(<span class="number">2</span>)</div><div class="line">res3: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>));</div><div class="line">List&lt;Integer&gt; take = rdd.take(<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<h1 id="collect"><a href="#collect" class="headerlink" title="collect"></a><strong>collect</strong></h1><p>rdd.collect() 返回 RDD 中的所有元素<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.collect()</div><div class="line">res4: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>));</div><div class="line">List&lt;Integer&gt; collect = rdd.collect();</div></pre></td></tr></table></figure></p>
<h1 id="count"><a href="#count" class="headerlink" title="count"></a><strong>count</strong></h1><p>rdd.count() 返回 RDD 中的元素个数<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.count()</div><div class="line">res5: <span class="type">Long</span> = <span class="number">4</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>));</div><div class="line"><span class="keyword">long</span> count = rdd.count();</div></pre></td></tr></table></figure></p>
<h1 id="countByValue"><a href="#countByValue" class="headerlink" title="countByValue"></a><strong>countByValue</strong></h1><p>各元素在 RDD 中出现的次数 返回{(key1,次数),(key2,次数),…(keyn,次数)}<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.countByValue()</div><div class="line">res6: scala.collection.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">Long</span>] = <span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="number">1</span>, <span class="number">2</span> -&gt; <span class="number">1</span>, <span class="number">3</span> -&gt; <span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>));</div><div class="line">Map&lt;Integer, Long&gt; integerLongMap = rdd.countByValue();</div></pre></td></tr></table></figure></p>
<h1 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a><strong>reduce</strong></h1><p>rdd.reduce(func)<br>并行整合RDD中所有数据， 类似于是scala中集合的reduce<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.reduce((x,y)=&gt;x+y)</div><div class="line">res7: <span class="type">Int</span> = <span class="number">9</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Integer reduce = rdd.reduce(<span class="keyword">new</span> Function2&lt;Integer, Integer, Integer&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">(Integer integer, Integer integer2)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">return</span> integer + integer2;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h1 id="aggregate"><a href="#aggregate" class="headerlink" title="aggregate"></a><strong>aggregate</strong></h1><p>和 reduce() 相 似， 但 是 通 常<br>返回不同类型的函数  一般不用这个函数</p>
<p><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"><span class="type">TODO</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h1 id="fold"><a href="#fold" class="headerlink" title="fold"></a><strong>fold</strong></h1><p>rdd.fold(num)(func) 一般不用这个函数<br>和 reduce() 一 样， 但是提供了初始值num,每个元素计算时，先要合这个初始值进行折叠, 注意，这里会按照每个分区进行fold，然后分区之间还会再次进行fold<br>提供初始值<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 解释 TODO </span></div><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>)，<span class="number">2</span>)</div><div class="line"></div><div class="line">scala&gt; rdd.fold(<span class="number">1</span>)((x,y)=&gt;x+y)</div><div class="line">res8: <span class="type">Int</span> = <span class="number">12</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">    JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>),<span class="number">2</span>);</div><div class="line">    Integer fold = rdd.fold(<span class="number">1</span>, <span class="keyword">new</span> Function2&lt;Integer, Integer, Integer&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">(Integer integer, Integer integer2)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">            <span class="keyword">return</span> integer + integer2;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    System.out.println(fold);</div><div class="line">-------输出-----</div><div class="line"><span class="number">12</span></div></pre></td></tr></table></figure></p>
<h1 id="top"><a href="#top" class="headerlink" title="top"></a><strong>top</strong></h1><p>rdd.top(n)<br>按照降序的或者指定的排序规则，返回前n个元素<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.top(<span class="number">2</span>)</div><div class="line">res9: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">3</span>, <span class="number">3</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>),<span class="number">2</span>);</div><div class="line">List&lt;Integer&gt; top = rdd.top(<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<h1 id="takeOrdered"><a href="#takeOrdered" class="headerlink" title="takeOrdered"></a><strong>takeOrdered</strong></h1><p>rdd.take(n)<br>对RDD元素进行升序排序,取出前n个元素并返回，也可以自定义比较器（这里不介绍），类似于top的相反的方法<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line"></div><div class="line">scala&gt; rdd.takeOrdered(<span class="number">2</span>)</div><div class="line">res10: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Integer&gt; rdd = sc.parallelize(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>),<span class="number">2</span>);</div><div class="line">List&lt;Integer&gt; integers = rdd.takeOrdered(<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<h1 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a><strong>foreach</strong></h1><p>对 RDD 中的每个元素使用给<br>定的函数<br><strong>scala</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>))</div><div class="line">    rdd.foreach(print(_))</div><div class="line">-----输出-----------</div><div class="line"><span class="number">1233</span></div></pre></td></tr></table></figure></p>
<p><strong>java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">rdd.foreach(<span class="keyword">new</span> VoidFunction&lt;Integer&gt;() &#123;</div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">       System.out.println(integer);</div><div class="line">   &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-9.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-9.html" title="spark RDD算子（九）之基本的Action操作 first, take, collect, count, countByValue, reduce, aggregate, fold,top">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/8.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-8.html">
    		spark RDD算子（八）之键值对关联操作 subtractByKey, join, rightOuterJoin, leftOuterJoin
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-18T13:25:21.000Z">2017-03-18</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <p>先从spark-learning中的一张图大致了解其功能<br><img src="http://i1.piimg.com/567571/1ccee438414f9c6f.png" alt=""></p>
<h1 id="subtractByKey"><a href="#subtractByKey" class="headerlink" title="subtractByKey"></a><strong>subtractByKey</strong></h1><p><strong>函数定义</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">def subtractByKey[W](other: RDD[(K, W)])(implicit arg0: ClassTag[W]): RDD[(K, V)]</div><div class="line"></div><div class="line">def subtractByKey[W](other: RDD[(K, W)], numPartitions: Int)(implicit arg0: ClassTag[W]): RDD[(K, V)]</div><div class="line"></div><div class="line">def subtractByKey[W](other: RDD[(K, W)], p: Partitioner)(implicit arg0: ClassTag[W]): RDD[(K, V)]</div></pre></td></tr></table></figure></p>
<p>类似于subtrac，删掉 RDD 中键与 other RDD 中的键相同的元素</p>
<h1 id="join"><a href="#join" class="headerlink" title="join"></a><strong>join</strong></h1><p><strong>函数定义</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">def join[W](other: RDD[(K, W)]): RDD[(K, (V, W))]</div><div class="line"></div><div class="line">def join[W](other: RDD[(K, W)], numPartitions: Int): RDD[(K, (V, W))]</div><div class="line"></div><div class="line">def join[W](other: RDD[(K, W)], partitioner: Partitioner): RDD[(K, (V, W))]</div></pre></td></tr></table></figure></p>
<p>RDD1.join(RDD2)<br>可以把RDD1,RDD2中的相同的key给连接起来，类似于sql中的join操作  </p>
<h1 id="leftOuterJoin"><a href="#leftOuterJoin" class="headerlink" title="leftOuterJoin"></a><strong>leftOuterJoin</strong></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">def leftOuterJoin[W](other: RDD[(K, W)]): RDD[(K, (V, Option[W]))]</div><div class="line"></div><div class="line">def leftOuterJoin[W](other: RDD[(K, W)], numPartitions: Int): RDD[(K, (V, Option[W]))]</div><div class="line"></div><div class="line">def leftOuterJoin[W](other: RDD[(K, W)], partitioner: Partitioner): RDD[(K, (V, Option[W]))]</div><div class="line">```  </div><div class="line">直接看图即可 </div><div class="line">对两个 RDD 进行连接操作，类似于sql中的左外连接</div><div class="line"># **rightOuterJoin**</div><div class="line">对两个 RDD 进行连接操作，类似于sql中的右外连接，存在的话，value用的Some, 不存在用的None,具体的看上面的图和下面的代码即可  </div><div class="line"></div><div class="line"># **代码示例**</div><div class="line"></div><div class="line">**scala语言**</div><div class="line">```scala  </div><div class="line">    scala&gt; val rdd = sc.makeRDD(Array((<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">4</span>),(<span class="number">3</span>,<span class="number">6</span>)))</div><div class="line">    scala&gt; val other = sc.makeRDD(Array((<span class="number">3</span>,<span class="number">9</span>)))</div><div class="line">    </div><div class="line">    scala&gt;  rdd.subtractByKey(other).collect()</div><div class="line">    res0: Array[(Int, Int)] = Array((<span class="number">1</span>,<span class="number">2</span>))</div><div class="line">    </div><div class="line">    scala&gt; rdd.join(other).collect()</div><div class="line">    res1: Array[(Int, (Int, Int))] = Array((<span class="number">3</span>,(<span class="number">4</span>,<span class="number">9</span>)), (<span class="number">3</span>,(<span class="number">6</span>,<span class="number">9</span>)))</div><div class="line">    </div><div class="line">    scala&gt; rdd.leftOuterJoin(other).collect()</div><div class="line">    res2: Array[(Int, (Int, Option[Int]))] = Array((<span class="number">1</span>,(<span class="number">2</span>,None)), (<span class="number">3</span>,(<span class="number">4</span>,Some(<span class="number">9</span>))), (<span class="number">3</span>,(<span class="number">6</span>,Some(<span class="number">9</span>))))</div><div class="line">    </div><div class="line">    scala&gt; rdd.rightOuterJoin(other).collect()</div><div class="line">    res3: Array[(Int, (Option[Int], Int))] = Array((<span class="number">3</span>,(Some(<span class="number">4</span>),<span class="number">9</span>)), (<span class="number">3</span>,(Some(<span class="number">6</span>),<span class="number">9</span>)))</div></pre></td></tr></table></figure>
<p><strong>java语言</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">   JavaRDD&lt;Tuple2&lt;Integer,Integer&gt;&gt; rddPre = sc.parallelize(Arrays.asList(<span class="keyword">new</span> Tuple2(<span class="number">1</span>,<span class="number">2</span>)</div><div class="line">           , <span class="keyword">new</span> Tuple2(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">           , <span class="keyword">new</span> Tuple2(<span class="number">3</span>,<span class="number">6</span>)));</div><div class="line">   JavaRDD&lt;Tuple2&lt;Integer,Integer&gt;&gt; otherPre = sc.parallelize(Arrays.asList(<span class="keyword">new</span> Tuple2(<span class="number">3</span>,<span class="number">10</span>)));</div><div class="line"></div><div class="line"><span class="comment">//JavaRDD转换成JavaPairRDD</span></div><div class="line">   JavaPairRDD&lt;Integer, Integer&gt; rdd = JavaPairRDD.fromJavaRDD(rddPre);</div><div class="line">   JavaPairRDD&lt;Integer, Integer&gt; other = JavaPairRDD.fromJavaRDD(otherPre);</div><div class="line">   <span class="comment">//subtractByKey</span></div><div class="line">   JavaPairRDD&lt;Integer, Integer&gt; subRDD = rdd.subtractByKey(other);</div><div class="line">   </div><div class="line">   <span class="comment">//join</span></div><div class="line">   JavaPairRDD&lt;Integer, Tuple2&lt;Float, Integer&gt;&gt; joinRDD =  rdd.join(other);</div><div class="line">   </div><div class="line">   <span class="comment">//leftOuterJoin</span></div><div class="line">   JavaPairRDD&lt;Integer, Tuple2&lt;Integer, Optional&lt;Integer&gt;&gt;&gt; integerTuple2JavaPairRDD = rdd.leftOuterJoin(other);</div><div class="line">   </div><div class="line">   <span class="comment">//rightOutJoin</span></div><div class="line">   JavaPairRDD&lt;Integer, Tuple2&lt;Optional&lt;Integer&gt;, Integer&gt;&gt; rightOutJoin = rdd.rightOuterJoin(other);</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-8.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-8.html" title="spark RDD算子（八）之键值对关联操作 subtractByKey, join, rightOuterJoin, leftOuterJoin">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/8.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-7.html">
    		spark RDD算子（七）之键值对分组操作 groupByKey，cogroup
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-07T13:25:21.000Z">2017-03-07</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="groupByKey"><a href="#groupByKey" class="headerlink" title="groupByKey"></a><strong>groupByKey</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">def groupByKey(): RDD[(K, Iterable[V])]</div><div class="line"></div><div class="line">def groupByKey(numPartitions: Int): RDD[(K, Iterable[V])]</div><div class="line"></div><div class="line">def groupByKey(partitioner: Partitioner): RDD[(K, Iterable[V])]</div></pre></td></tr></table></figure>
<p>groupByKey会将RDD[key,value] 按照相同的key进行分组，形成RDD[key,Iterable[value]]的形式， 有点类似于sql中的groupby，例如类似于mysql中的group_concat<br>例如这个例子， 我们对学生的成绩进行分组<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">val</span> scoreDetail = sc.parallelize(<span class="type">List</span>((<span class="string">"xiaoming"</span>,<span class="number">75</span>),(<span class="string">"xiaoming"</span>,<span class="number">90</span>),(<span class="string">"lihua"</span>,<span class="number">95</span>),(<span class="string">"lihua"</span>,<span class="number">100</span>),(<span class="string">"xiaofeng"</span>,<span class="number">85</span>)))</div><div class="line">    scoreDetail.groupByKey().collect().foreach(println(_));</div><div class="line">    <span class="comment">/*输出</span></div><div class="line"><span class="comment">(lihua,CompactBuffer(95, 100))</span></div><div class="line"><span class="comment">(xiaoming,CompactBuffer(75, 90))</span></div><div class="line"><span class="comment">(xiaofeng,CompactBuffer(85))</span></div><div class="line"><span class="comment">    */</span></div></pre></td></tr></table></figure></p>
<p><strong>java版本</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;Tuple2&lt;String,Float&gt;&gt; scoreDetails = sc.parallelize(Arrays.asList(<span class="keyword">new</span> Tuple2(<span class="string">"xiaoming"</span>, <span class="number">75</span>)</div><div class="line">        , <span class="keyword">new</span> Tuple2(<span class="string">"xiaoming"</span>, <span class="number">90</span>)</div><div class="line">        , <span class="keyword">new</span> Tuple2(<span class="string">"lihua"</span>, <span class="number">95</span>)</div><div class="line">        , <span class="keyword">new</span> Tuple2(<span class="string">"lihua"</span>, <span class="number">188</span>)));</div><div class="line"><span class="comment">//将JavaRDD&lt;Tuple2&lt;String,Float&gt;&gt; 类型转换为 JavaPairRDD&lt;String, Float&gt;</span></div><div class="line">JavaPairRDD&lt;String, Float&gt; scoreMapRDD = JavaPairRDD.fromJavaRDD(scoreDetails);</div><div class="line">Map&lt;String, Iterable&lt;Float&gt;&gt; resultMap = scoreMapRDD.groupByKey().collectAsMap();</div><div class="line"><span class="keyword">for</span> (String key:resultMap.keySet()) &#123;</div><div class="line">    System.out.println(<span class="string">"("</span>+key+<span class="string">", "</span>+resultMap.get(key)+<span class="string">")"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="cogroup"><a href="#cogroup" class="headerlink" title="cogroup"></a><strong>cogroup</strong></h1><p>groupByKey是对单个 RDD 的数据进行分组，还可以使用一个叫作 cogroup() 的函数对多个共享同一个键的 RDD 进行分组<br>例如<br>RDD1.cogroup(RDD2) 会将RDD1和RDD2按照相同的key进行分组，得到(key,RDD[key,Iterable[value1],Iterable[value2]])的形式<br>cogroup也可以多个进行分组<br>例如RDD1.cogroup(RDD2,RDD3,…RDDN), 可以得到(key,Iterable[value1],Iterable[value2],Iterable[value3],…,Iterable[valueN])<br>案例,scoreDetail存放的是学生的优秀学科的分数，scoreDetai2存放的是刚刚及格的分数，scoreDetai3存放的是没有及格的科目的分数，我们要对每一个学生的优秀学科，刚及格和不及格的分数给分组统计出来<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">val</span> scoreDetail = sc.parallelize(<span class="type">List</span>((<span class="string">"xiaoming"</span>,<span class="number">95</span>),(<span class="string">"xiaoming"</span>,<span class="number">90</span>),(<span class="string">"lihua"</span>,<span class="number">95</span>),(<span class="string">"lihua"</span>,<span class="number">98</span>),(<span class="string">"xiaofeng"</span>,<span class="number">97</span>)))</div><div class="line">scala&gt; <span class="keyword">val</span> scoreDetai2 = sc.parallelize(<span class="type">List</span>((<span class="string">"xiaoming"</span>,<span class="number">65</span>),(<span class="string">"lihua"</span>,<span class="number">63</span>),(<span class="string">"lihua"</span>,<span class="number">62</span>),(<span class="string">"xiaofeng"</span>,<span class="number">67</span>)))</div><div class="line">scala&gt; <span class="keyword">val</span> scoreDetai3 = sc.parallelize(<span class="type">List</span>((<span class="string">"xiaoming"</span>,<span class="number">25</span>),(<span class="string">"xiaoming"</span>,<span class="number">15</span>),(<span class="string">"lihua"</span>,<span class="number">35</span>),(<span class="string">"lihua"</span>,<span class="number">28</span>),(<span class="string">"xiaofeng"</span>,<span class="number">36</span>)))</div><div class="line">scala&gt; scoreDetail.cogroup(scoreDetai2,scoreDetai3)</div><div class="line"></div><div class="line"><span class="comment">//输出</span></div><div class="line">res1: <span class="type">Array</span>[(<span class="type">String</span>, (<span class="type">Iterable</span>[<span class="type">Int</span>], <span class="type">Iterable</span>[<span class="type">Int</span>], <span class="type">Iterable</span>[<span class="type">Int</span>]))] = <span class="type">Array</span>((xiaoming,(<span class="type">CompactBuffer</span>(<span class="number">95</span>, <span class="number">90</span>),<span class="type">CompactBuffer</span>(<span class="number">65</span>),<span class="type">CompactBuffer</span>(<span class="number">25</span>, <span class="number">15</span>))), (lihua,(<span class="type">CompactBuffer</span>(<span class="number">95</span>, <span class="number">98</span>),<span class="type">CompactBuffer</span>(<span class="number">63</span>, <span class="number">62</span>),<span class="type">CompactBuffer</span>(<span class="number">35</span>, <span class="number">28</span>))), (xiaofeng,(<span class="type">CompactBuffer</span>(<span class="number">97</span>),<span class="type">CompactBuffer</span>(<span class="number">67</span>),<span class="type">CompactBuffer</span>(<span class="number">36</span>))))</div><div class="line"></div><div class="line">```  </div><div class="line">**java版本**  </div><div class="line">```java</div><div class="line">        <span class="type">JavaRDD</span>&lt;<span class="type">Tuple2</span>&lt;<span class="type">String</span>,<span class="type">Float</span>&gt;&gt; scoreDetails1 = sc.parallelize(<span class="type">Arrays</span>.asList(<span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"xiaoming"</span>, <span class="number">75</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"xiaoming"</span>, <span class="number">90</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">95</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">96</span>)));</div><div class="line">        <span class="type">JavaRDD</span>&lt;<span class="type">Tuple2</span>&lt;<span class="type">String</span>,<span class="type">Float</span>&gt;&gt; scoreDetails2 = sc.parallelize(<span class="type">Arrays</span>.asList(<span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"xiaoming"</span>, <span class="number">75</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">60</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">62</span>)));</div><div class="line">        <span class="type">JavaRDD</span>&lt;<span class="type">Tuple2</span>&lt;<span class="type">String</span>,<span class="type">Float</span>&gt;&gt; scoreDetails3 = sc.parallelize(<span class="type">Arrays</span>.asList(<span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"xiaoming"</span>, <span class="number">75</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"xiaoming"</span>, <span class="number">45</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">24</span>)</div><div class="line">                , <span class="keyword">new</span> <span class="type">Tuple2</span>(<span class="string">"lihua"</span>, <span class="number">57</span>)));</div><div class="line">        </div><div class="line">        <span class="type">JavaPairRDD</span>&lt;<span class="type">String</span>, <span class="type">Float</span>&gt; scoreMapRDD1 = <span class="type">JavaPairRDD</span>.fromJavaRDD(scoreDetails1);</div><div class="line">        <span class="type">JavaPairRDD</span>&lt;<span class="type">String</span>, <span class="type">Float</span>&gt; scoreMapRDD2 = <span class="type">JavaPairRDD</span>.fromJavaRDD(scoreDetails2);</div><div class="line">        <span class="type">JavaPairRDD</span>&lt;<span class="type">String</span>, <span class="type">Float</span>&gt; scoreMapRDD3 = <span class="type">JavaPairRDD</span>.fromJavaRDD(scoreDetails2);</div><div class="line">        </div><div class="line">        <span class="type">JavaPairRDD</span>&lt;<span class="type">String</span>, <span class="type">Tuple3</span>&lt;<span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;&gt;&gt; cogroupRDD = (<span class="type">JavaPairRDD</span>&lt;<span class="type">String</span>, <span class="type">Tuple3</span>&lt;<span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;&gt;&gt;) scoreMapRDD1.cogroup(scoreMapRDD2, scoreMapRDD3);</div><div class="line">        <span class="type">Map</span>&lt;<span class="type">String</span>, <span class="type">Tuple3</span>&lt;<span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;, <span class="type">Iterable</span>&lt;<span class="type">Float</span>&gt;&gt;&gt; tuple3 = cogroupRDD.collectAsMap();</div><div class="line">        <span class="keyword">for</span> (<span class="type">String</span> key:tuple3.keySet()) &#123;</div><div class="line">            <span class="type">System</span>.out.println(<span class="string">"("</span>+key+<span class="string">", "</span>+tuple3.get(key)+<span class="string">")"</span>);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">-----输出----------</div><div class="line">(lihua, ([<span class="number">95</span>, <span class="number">96</span>],[<span class="number">60</span>, <span class="number">62</span>],[<span class="number">60</span>, <span class="number">62</span>]))</div><div class="line">(xiaoming, ([<span class="number">75</span>, <span class="number">90</span>],[<span class="number">75</span>],[<span class="number">75</span>]))</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-7.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-7.html" title="spark RDD算子（七）之键值对分组操作 groupByKey，cogroup">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/7.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-6.html">
    		spark RDD算子（六）之键值对聚合操作reduceByKey，foldByKey，排序操作sortByKey
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-06T13:25:21.000Z">2017-03-06</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="reduceByKey"><a href="#reduceByKey" class="headerlink" title="reduceByKey"></a><strong>reduceByKey</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">def reduceByKey(func: (V, V) =&gt; V): RDD[(K, V)]</div><div class="line"></div><div class="line">def reduceByKey(func: (V, V) =&gt; V, numPartitions: Int): RDD[(K, V)]</div><div class="line"></div><div class="line">def reduceByKey(partitioner: Partitioner, func: (V, V) =&gt; V): RDD[(K, V)]</div></pre></td></tr></table></figure>
<p>接收一个函数，按照相同的key进行reduce操作，类似于scala的reduce的操作<br>例如RDD {(1, 2), (3, 4), (3, 6)}进行reduce<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">var</span> mapRDD = sc.parallelize(<span class="type">List</span>((<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">4</span>),(<span class="number">3</span>,<span class="number">6</span>)))</div><div class="line">    <span class="keyword">var</span> reduceRDD = mapRDD.reduceByKey((x,y)=&gt;x+y)</div><div class="line">    reduceRDD.foreach(x=&gt;println(x))</div><div class="line">------输出---------</div><div class="line">(<span class="number">1</span>,<span class="number">2</span>)</div><div class="line">(<span class="number">3</span>,<span class="number">10</span>)</div></pre></td></tr></table></figure></p>
<p>再举例<br><strong>单词计数</strong><br>F:\sparktest\sample.txt中的内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">aa bb cc aa aa aa dd dd ee ee ee ee </div><div class="line">ff aa bb zks</div><div class="line">ee kks</div><div class="line">ee  zz zks</div></pre></td></tr></table></figure></p>
<p><strong>scala版本</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">val</span> lines = sc.textFile(<span class="string">"F:\\sparktest\\sample.txt"</span>)</div><div class="line">    <span class="keyword">val</span> wordsRDD = lines.flatMap(x=&gt;x.split(<span class="string">"\\s+"</span>)).map(x=&gt;(x,<span class="number">1</span>))</div><div class="line">    <span class="keyword">val</span> wordCountRDD = wordsRDD.reduceByKey((x,y)=&gt;x+y)</div><div class="line">    wordCountRDD.foreach(x=&gt;println(x))</div><div class="line">---------输出-----------</div><div class="line">(ee,<span class="number">6</span>)</div><div class="line">(aa,<span class="number">5</span>)</div><div class="line">(dd,<span class="number">2</span>)</div><div class="line">(zz,<span class="number">1</span>)</div><div class="line">(zks,<span class="number">2</span>)</div><div class="line">(kks,<span class="number">1</span>)</div><div class="line">(ff,<span class="number">1</span>)</div><div class="line">(bb,<span class="number">2</span>)</div><div class="line">(cc,<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><strong>java版本</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"> JavaRDD&lt;String&gt; lines = sc.textFile(<span class="string">"F:\\sparktest\\sample.txt"</span>);</div><div class="line"></div><div class="line">        JavaPairRDD&lt;String, Integer&gt; wordPairRDD = lines.flatMapToPair(<span class="keyword">new</span> PairFlatMapFunction&lt;String, String, Integer&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> Iterable&lt;Tuple2&lt;String, Integer&gt;&gt; call(String s) <span class="keyword">throws</span> Exception &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt; tpLists = <span class="keyword">new</span> ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt;();</div><div class="line">                String[] split = s.split(<span class="string">"\\s+"</span>);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;split.length ; i++) &#123;</div><div class="line">                    Tuple2 tp = <span class="keyword">new</span> Tuple2&lt;String,Integer&gt;(split[i], <span class="number">1</span>);</div><div class="line">                    tpLists.add(tp);</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">return</span> tpLists;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        JavaPairRDD&lt;String, Integer&gt; wordCountRDD = wordPairRDD.reduceByKey(<span class="keyword">new</span> Function2&lt;Integer, Integer, Integer&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">(Integer i1, Integer i2)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                <span class="keyword">return</span> i1 + i2;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        Map&lt;String, Integer&gt; collectAsMap = wordCountRDD.collectAsMap();</div><div class="line">        <span class="keyword">for</span> (String key:collectAsMap.keySet()) &#123;</div><div class="line">            System.out.println(<span class="string">"("</span>+key+<span class="string">","</span>+collectAsMap.get(key)+<span class="string">")"</span>);</div><div class="line">        &#125;</div><div class="line">----------输出-------------------------------</div><div class="line">(kks,<span class="number">1</span>)</div><div class="line">(ee,<span class="number">6</span>)</div><div class="line">(bb,<span class="number">2</span>)</div><div class="line">(zz,<span class="number">1</span>)</div><div class="line">(ff,<span class="number">1</span>)</div><div class="line">(cc,<span class="number">1</span>)</div><div class="line">(zks,<span class="number">2</span>)</div><div class="line">(dd,<span class="number">2</span>)</div><div class="line">(aa,<span class="number">5</span>)</div></pre></td></tr></table></figure></p>
<h1 id="foldByKey"><a href="#foldByKey" class="headerlink" title="foldByKey"></a><strong>foldByKey</strong></h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foldByKey</span></span>(zeroValue: <span class="type">V</span>)(func: (<span class="type">V</span>, <span class="type">V</span>) =&gt; <span class="type">V</span>): <span class="type">RDD</span>[(<span class="type">K</span>, <span class="type">V</span>)]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foldByKey</span></span>(zeroValue: <span class="type">V</span>, numPartitions: <span class="type">Int</span>)(func: (<span class="type">V</span>, <span class="type">V</span>) =&gt; <span class="type">V</span>): <span class="type">RDD</span>[(<span class="type">K</span>, <span class="type">V</span>)]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foldByKey</span></span>(zeroValue: <span class="type">V</span>, partitioner: <span class="type">Partitioner</span>)(func: (<span class="type">V</span>, <span class="type">V</span>) =&gt; <span class="type">V</span>): <span class="type">RDD</span>[(<span class="type">K</span>, <span class="type">V</span>)]</div></pre></td></tr></table></figure>
<p>该函数用于RDD[K,V]根据K将V做折叠、合并处理，其中的参数zeroValue表示先根据映射函数将zeroValue应用于V,进行初始化V,再将映射函数应用于初始化后的V.<br>foldByKey可以参考我之前的<a href="http://blog.csdn.net/t1dmzks/article/details/69858060#t27" target="_blank" rel="external">scala的fold的介绍</a><br>与reduce不同的是 foldByKey开始折叠的第一个元素不是集合中的第一个元素，而是传入的一个元素<br><a href="http://lxw1234.com/archives/2015/07/358.htm" target="_blank" rel="external">参考LXW的博客  scala的例子</a><br><strong>直接看例子</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">scala&gt; <span class="keyword">var</span> rdd1 = sc.makeRDD(<span class="type">Array</span>((<span class="string">"A"</span>,<span class="number">0</span>),(<span class="string">"A"</span>,<span class="number">2</span>),(<span class="string">"B"</span>,<span class="number">1</span>),(<span class="string">"B"</span>,<span class="number">2</span>),(<span class="string">"C"</span>,<span class="number">1</span>)))</div><div class="line">scala&gt; rdd1.foldByKey(<span class="number">0</span>)(_+_).collect</div><div class="line">res75: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="type">A</span>,<span class="number">2</span>), (<span class="type">B</span>,<span class="number">3</span>), (<span class="type">C</span>,<span class="number">1</span>)) </div><div class="line"><span class="comment">//将rdd1中每个key对应的V进行累加，注意zeroValue=0,需要先初始化V,映射函数为+操</span></div><div class="line"><span class="comment">//作，比如("A",0), ("A",2)，先将zeroValue应用于每个V,得到：("A",0+0), ("A",2+0)，即：</span></div><div class="line"><span class="comment">//("A",0), ("A",2)，再将映射函数应用于初始化后的V，最后得到(A,0+2),即(A,2)</span></div></pre></td></tr></table></figure></p>
<p><strong>再看：</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">scala&gt; rdd1.foldByKey(<span class="number">2</span>)(_+_).collect</div><div class="line">res76: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="type">A</span>,<span class="number">6</span>), (<span class="type">B</span>,<span class="number">7</span>), (<span class="type">C</span>,<span class="number">3</span>))</div><div class="line"><span class="comment">//先将zeroValue=2应用于每个V,得到：("A",0+2), ("A",2+2)，即：("A",2), ("A",4)，再将映射函</span></div><div class="line"><span class="comment">//数应用于初始化后的V，最后得到：(A,2+4)，即：(A,6)</span></div></pre></td></tr></table></figure></p>
<p><strong>再看乘法操作：</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">scala&gt; rdd1.foldByKey(<span class="number">0</span>)(_*_).collect</div><div class="line">res77: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="type">A</span>,<span class="number">0</span>), (<span class="type">B</span>,<span class="number">0</span>), (<span class="type">C</span>,<span class="number">0</span>))</div><div class="line"><span class="comment">//先将zeroValue=0应用于每个V,注意，这次映射函数为乘法，得到：("A",0*0), ("A",2*0)，</span></div><div class="line"><span class="comment">//即：("A",0), ("A",0)，再将映射函//数应用于初始化后的V，最后得到：(A,0*0)，即：(A,0)</span></div><div class="line"><span class="comment">//其他K也一样，最终都得到了V=0</span></div><div class="line"> </div><div class="line">scala&gt; rdd1.foldByKey(<span class="number">1</span>)(_*_).collect</div><div class="line">res78: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="type">A</span>,<span class="number">0</span>), (<span class="type">B</span>,<span class="number">2</span>), (<span class="type">C</span>,<span class="number">1</span>))</div><div class="line"><span class="comment">//映射函数为乘法时，需要将zeroValue设为1，才能得到我们想要的结果。</span></div></pre></td></tr></table></figure></p>
<h1 id="SortByKey"><a href="#SortByKey" class="headerlink" title="SortByKey"></a><strong>SortByKey</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">def sortByKey(ascending : scala.Boolean = &#123; /* compiled code */ &#125;, numPartitions : scala.Int = &#123; /* compiled code */ &#125;) : org.apache.spark.rdd.RDD[scala.Tuple2[K, V]] = &#123; /* compiled code */ &#125;</div></pre></td></tr></table></figure>
<p>SortByKey用于对pairRDD按照key进行排序，第一个参数可以设置true或者false，默认是true<br><strong>scala例子</strong></p>
<pre><code class="scala">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">Array</span>((<span class="number">3</span>, <span class="number">4</span>),(<span class="number">1</span>, <span class="number">2</span>),(<span class="number">4</span>,<span class="number">4</span>),(<span class="number">2</span>,<span class="number">5</span>), (<span class="number">6</span>,<span class="number">5</span>), (<span class="number">5</span>, <span class="number">6</span>)))  

<span class="comment">// sortByKey不是Action操作，只能算是转换操作</span>
scala&gt; rdd.sortByKey()
res9: org.apache.spark.rdd.<span class="type">RDD</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = <span class="type">ShuffledRDD</span>[<span class="number">28</span>] at sortByKey at &lt;console&gt;:<span class="number">24</span> 

<span class="comment">//看看sortByKey后是什么类型</span>
scala&gt; rdd.sortByKey().collect() 
res10: <span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="number">1</span>,<span class="number">2</span>), (<span class="number">2</span>,<span class="number">5</span>), (<span class="number">3</span>,<span class="number">4</span>), (<span class="number">4</span>,<span class="number">4</span>), (<span class="number">5</span>,<span class="number">6</span>), (<span class="number">6</span>,<span class="number">5</span>)) 

<span class="comment">//降序排序</span>
scala&gt; rdd.sortByKey(<span class="literal">false</span>).collect() 
res12: <span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((<span class="number">6</span>,<span class="number">5</span>), (<span class="number">5</span>,<span class="number">6</span>), (<span class="number">4</span>,<span class="number">4</span>), (<span class="number">3</span>,<span class="number">4</span>), (<span class="number">2</span>,<span class="number">5</span>), (<span class="number">1</span>,<span class="number">2</span>))
</code></pre>
<p>java例子也是一样的，这里就不写了</p>
<p>参考文章: Spark快速大数据分析,<a href="http://lxw1234.com/archives/2015/07/358.htm" target="_blank" rel="external">LXW的大数据田地</a>,spark官网  </p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-6.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-6.html" title="spark RDD算子（六）之键值对聚合操作reduceByKey，foldByKey，排序操作sortByKey">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/6.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-5.html">
    		spark RDD算子（五）之键值对聚合操作 combineByKey
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-05T13:25:21.000Z">2017-03-05</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="combineByKey"><a href="#combineByKey" class="headerlink" title="combineByKey"></a><strong>combineByKey</strong></h1><p>聚合数据一般在集中式数据比较方便，如果涉及到分布式的数据集，该如何去实现呢。这里介绍一下combineByKey, 这个是各种聚集操作的鼻祖，应该要好好了解一下,<a href="http://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.rdd.PairRDDFunctions" target="_blank" rel="external">参考scala API</a>  </p>
<h2 id="简要介绍"><a href="#简要介绍" class="headerlink" title="简要介绍"></a><strong>简要介绍</strong></h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">combineByKey</span></span>[<span class="type">C</span>](createCombiner: (<span class="type">V</span>) =&gt; <span class="type">C</span>,  </div><div class="line">                    mergeValue: (<span class="type">C</span>, <span class="type">V</span>) =&gt; <span class="type">C</span>,   </div><div class="line">                    mergeCombiners: (<span class="type">C</span>, <span class="type">C</span>) =&gt; <span class="type">C</span>): <span class="type">RD</span></div></pre></td></tr></table></figure>
<ul>
<li><strong>createCombiner</strong>: combineByKey() 会遍历分区中的所有元素，因此每个元素的键要么还没有遇到过，要么就<br>和之前的某个元素的键相同。如果这是一个新的元素， combineByKey() 会使用一个叫作 createCombiner() 的函数来创建<br>那个键对应的累加器的初始值</li>
<li><strong>mergeValue:</strong> 如果这是一个在处理当前分区之前已经遇到的键， 它会使用 mergeValue() 方法将该键的累加器对应的当前值与这个新的值进行合并  </li>
<li><strong>mergeCombiners:</strong> 由于每个分区都是独立处理的， 因此对于同一个键可以有多个累加器。如果有两个或者更<br>多的分区都有对应同一个键的累加器， 就需要使用用户提供的 mergeCombiners() 方法将各<br>个分区的结果进行合并。</li>
</ul>
<h2 id="计算学生平均成绩例子"><a href="#计算学生平均成绩例子" class="headerlink" title="计算学生平均成绩例子"></a><strong>计算学生平均成绩例子</strong></h2><p>这里举一个计算学生平均成绩的例子,例子参考至<a href="https://www.edureka.co/blog/apache-spark-combinebykey-explained" target="_blank" rel="external">https://www.edureka.co/blog/apache-spark-combinebykey-explained</a>, <a href="https://github.com/prithvirajbose/spark-dev/blob/master/src/main/scala/examples/TestCombineByKey.scala" target="_blank" rel="external">github源码</a>  我对此进行了解析<br><strong>创建一个学生成绩说明的类</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">ScoreDetail</span>(<span class="params">studentName: <span class="type">String</span>, subject: <span class="type">String</span>, score: <span class="type">Float</span></span>)</span></div></pre></td></tr></table></figure></p>
<p><strong>下面是一些测试数据</strong>，加载测试数据集合  key = Students name and value = ScoreDetail instance<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> scores = <span class="type">List</span>(</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"xiaoming"</span>, <span class="string">"Math"</span>, <span class="number">98</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"xiaoming"</span>, <span class="string">"English"</span>, <span class="number">88</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"wangwu"</span>, <span class="string">"Math"</span>, <span class="number">75</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"wangwu"</span>, <span class="string">"English"</span>, <span class="number">78</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"lihua"</span>, <span class="string">"Math"</span>, <span class="number">90</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"lihua"</span>, <span class="string">"English"</span>, <span class="number">80</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"zhangsan"</span>, <span class="string">"Math"</span>, <span class="number">91</span>),</div><div class="line">  <span class="type">ScoreDetail</span>(<span class="string">"zhangsan"</span>, <span class="string">"English"</span>, <span class="number">80</span>))</div></pre></td></tr></table></figure></p>
<p><strong>将集合转换成二元组</strong>， 也可以理解成转换成一个map, 利用了for 和 yield的组合<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> scoresWithKey = <span class="keyword">for</span> &#123; i &lt;- scores &#125; <span class="keyword">yield</span> (i.studentName, i)</div></pre></td></tr></table></figure></p>
<p><strong>创建RDD, 并且指定三个分区</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> scoresWithKeyRDD = sc.parallelize(scoresWithKey).partitionBy(<span class="keyword">new</span> <span class="type">HashPartitioner</span>(<span class="number">3</span>)).cache</div></pre></td></tr></table></figure></p>
<p><strong>输出打印一下各个分区的长度和各个分区的一些数据</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">    println(<span class="string">"&gt;&gt;&gt;&gt; Elements in each partition"</span>)</div><div class="line"></div><div class="line">    scoresWithKeyRDD.foreachPartition(partition =&gt; println(partition.length))</div><div class="line"></div><div class="line">    <span class="comment">// explore each partition...</span></div><div class="line">    println(<span class="string">"&gt;&gt;&gt;&gt; Exploring partitions' data..."</span>)</div><div class="line"></div><div class="line">    scoresWithKeyRDD.foreachPartition(</div><div class="line">      partition =&gt; partition.foreach(</div><div class="line">        item =&gt; println(item._2)))</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">会输出 </span></div><div class="line"><span class="comment">&gt;&gt;&gt;&gt; Elements in each partition</span></div><div class="line"><span class="comment">6</span></div><div class="line"><span class="comment">2</span></div><div class="line"><span class="comment">0</span></div><div class="line"><span class="comment">&gt;&gt;&gt;&gt; Exploring partitions' data...</span></div><div class="line"><span class="comment">ScoreDetail(xiaoming,Math,98.0)</span></div><div class="line"><span class="comment">ScoreDetail(xiaoming,English,88.0)</span></div><div class="line"><span class="comment">ScoreDetail(lihua,Math,90.0)</span></div><div class="line"><span class="comment">ScoreDetail(lihua,English,80.0)</span></div><div class="line"><span class="comment">ScoreDetail(zhangsan,Math,91.0)</span></div><div class="line"><span class="comment">ScoreDetail(zhangsan,English,80.0)</span></div><div class="line"><span class="comment">ScoreDetail(wangwu,Math,75.0)</span></div><div class="line"><span class="comment">ScoreDetail(wangwu,English,78.0)</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure></p>
<p><strong>聚合求平均值让后打印</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">      <span class="keyword">val</span> avgScoresRDD = scoresWithKeyRDD.combineByKey(</div><div class="line">      (x: <span class="type">ScoreDetail</span>) =&gt; (x.score, <span class="number">1</span>) <span class="comment">/*createCombiner*/</span>,</div><div class="line">      (acc: (<span class="type">Float</span>, <span class="type">Int</span>), x: <span class="type">ScoreDetail</span>) =&gt; (acc._1 + x.score, acc._2 + <span class="number">1</span>) <span class="comment">/*mergeValue*/</span>,</div><div class="line">      (acc1: (<span class="type">Float</span>, <span class="type">Int</span>), acc2: (<span class="type">Float</span>, <span class="type">Int</span>)) =&gt; (acc1._1 + acc2._1, acc1._2 + acc2._2) <span class="comment">/*mergeCombiners*/</span></div><div class="line">      <span class="comment">// calculate the average</span></div><div class="line">    ).map( &#123; <span class="keyword">case</span>(key, value) =&gt; (key, value._1/value._2) &#125;)</div><div class="line"></div><div class="line">    avgScoresRDD.collect.foreach(println)</div><div class="line"><span class="comment">/*输出:</span></div><div class="line"><span class="comment">(zhangsan,85.5)</span></div><div class="line"><span class="comment">(lihua,85.0)</span></div><div class="line"><span class="comment">(xiaoming,93.0)</span></div><div class="line"><span class="comment">(wangwu,76.5)</span></div><div class="line"><span class="comment">*/</span></div><div class="line">```   </div><div class="line">**解释一下scoresWithKeyRDD.combineByKey**  </div><div class="line">**createCombiner:**  (x: <span class="type">ScoreDetail</span>) =&gt; (x.score, <span class="number">1</span>)  </div><div class="line">这是第一次遇到zhangsan，创建一个函数，把map中的value转成另外一个类型   ，这里是把(zhangsan,(<span class="type">ScoreDetail</span>类))**转换成**(zhangsan,(<span class="number">91</span>,<span class="number">1</span>))  </div><div class="line">**mergeValue:** (acc: (<span class="type">Float</span>, <span class="type">Int</span>), x: <span class="type">ScoreDetail</span>) =&gt; (acc._1 + x.score, acc._2 + <span class="number">1</span>)  再次碰到张三， 就把这两个合并, 这里是将(zhangsan,(<span class="number">91</span>,<span class="number">1</span>)) 这种类型 和 (zhangsan,(<span class="type">ScoreDetail</span>类))这种类型合并，合并成了(zhangsan,(<span class="number">171</span>,<span class="number">2</span>))  </div><div class="line">**mergeCombiners** (acc1: (<span class="type">Float</span>, <span class="type">Int</span>), acc2: (<span class="type">Float</span>, <span class="type">Int</span>))  这个是将多个分区中的zhangsan的数据进行合并， 我们这里zhansan在同一个分区，这个地方就没有用上  </div><div class="line"></div><div class="line">## java版本的介绍</div><div class="line">**<span class="type">ScoreDetail</span>类**</div><div class="line">```java</div><div class="line"></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ScoreDetail</span> <span class="title">implements</span> <span class="title">Serializable</span></span>&#123;</div><div class="line">    <span class="comment">//case class ScoreDetail(studentName: String, subject: String, score: Float)</span></div><div class="line">    public <span class="type">String</span> studentName;</div><div class="line">    public <span class="type">String</span> subject;</div><div class="line">    public float score;</div><div class="line"></div><div class="line">    public <span class="type">ScoreDetail</span>(<span class="type">String</span> studentName, <span class="type">String</span> subject, float score) &#123;</div><div class="line">        <span class="keyword">this</span>.studentName = studentName;</div><div class="line">        <span class="keyword">this</span>.subject = subject;</div><div class="line">        <span class="keyword">this</span>.score = score;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>CombineByKey的测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CombineTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SparkConf sparkConf = <span class="keyword">new</span> SparkConf().setAppName(<span class="string">"JavaWordCount"</span>).setMaster(<span class="string">"local"</span>);</div><div class="line">        JavaSparkContext sc = <span class="keyword">new</span> JavaSparkContext(sparkConf);</div><div class="line">        ArrayList&lt;ScoreDetail&gt; scoreDetails = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"xiaoming"</span>, <span class="string">"Math"</span>, <span class="number">98</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"xiaoming"</span>, <span class="string">"English"</span>, <span class="number">88</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"wangwu"</span>, <span class="string">"Math"</span>, <span class="number">75</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"wangwu"</span>, <span class="string">"Englist"</span>, <span class="number">78</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"lihua"</span>, <span class="string">"Math"</span>, <span class="number">90</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"lihua"</span>, <span class="string">"English"</span>, <span class="number">80</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"zhangsan"</span>, <span class="string">"Math"</span>, <span class="number">91</span>));</div><div class="line">        scoreDetails.add(<span class="keyword">new</span> ScoreDetail(<span class="string">"zhangsan"</span>, <span class="string">"English"</span>, <span class="number">80</span>));</div><div class="line"></div><div class="line">        JavaRDD&lt;ScoreDetail&gt; scoreDetailsRDD = sc.parallelize(scoreDetails);</div><div class="line"></div><div class="line">        JavaPairRDD&lt;String, ScoreDetail&gt; pairRDD = scoreDetailsRDD.mapToPair(<span class="keyword">new</span> PairFunction&lt;ScoreDetail, String, ScoreDetail&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;String, ScoreDetail&gt; <span class="title">call</span><span class="params">(ScoreDetail scoreDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(scoreDetail.studentName, scoreDetail);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"><span class="comment">//        new Function&lt;ScoreDetail, Float,Integer&gt;();</span></div><div class="line"></div><div class="line">        Function&lt;ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt; createCombine = <span class="keyword">new</span> Function&lt;ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;Float, Integer&gt; <span class="title">call</span><span class="params">(ScoreDetail scoreDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(scoreDetail.score, <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        <span class="comment">// Function2传入两个值，返回一个值</span></div><div class="line">        Function2&lt;Tuple2&lt;Float, Integer&gt;, ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt; mergeValue = <span class="keyword">new</span> Function2&lt;Tuple2&lt;Float, Integer&gt;, ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;Float, Integer&gt; <span class="title">call</span><span class="params">(Tuple2&lt;Float, Integer&gt; tp, ScoreDetail scoreDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(tp._1 + scoreDetail.score, tp._2 + <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        Function2&lt;Tuple2&lt;Float, Integer&gt;, Tuple2&lt;Float, Integer&gt;, Tuple2&lt;Float, Integer&gt;&gt; mergeCombiners = <span class="keyword">new</span> Function2&lt;Tuple2&lt;Float, Integer&gt;, Tuple2&lt;Float, Integer&gt;, Tuple2&lt;Float, Integer&gt;&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;Float, Integer&gt; <span class="title">call</span><span class="params">(Tuple2&lt;Float, Integer&gt; tp1, Tuple2&lt;Float, Integer&gt; tp2)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(tp1._1 + tp2._1, tp1._2 + tp2._2);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        JavaPairRDD&lt;String, Tuple2&lt;Float,Integer&gt;&gt; combineByRDD  = pairRDD.combineByKey(createCombine,mergeValue,mergeCombiners);</div><div class="line"></div><div class="line">        <span class="comment">//打印平均数</span></div><div class="line">        Map&lt;String, Tuple2&lt;Float, Integer&gt;&gt; stringTuple2Map = combineByRDD.collectAsMap();</div><div class="line">        <span class="keyword">for</span> ( String et:stringTuple2Map.keySet()) &#123;</div><div class="line">            System.out.println(et+<span class="string">" "</span>+stringTuple2Map.get(et)._1/stringTuple2Map.get(et)._2);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>注意有个坑的地方</strong>  createCombine方法必须是这样的<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Function&lt;ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt; createCombine = <span class="keyword">new</span> Function&lt;ScoreDetail, Tuple2&lt;Float, Integer&gt;&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;Float, Integer&gt; <span class="title">call</span><span class="params">(ScoreDetail scoreDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(scoreDetail.score, <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><strong>而不能是这样的</strong>, 即使最后的RDD都类似<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">PairFunction&lt;ScoreDetail, Float, Integer&gt; createCombine = <span class="keyword">new</span> PairFunction&lt;ScoreDetail, Float, Integer&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;Float, Integer&gt; <span class="title">call</span><span class="params">(ScoreDetail scoreDetail)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(scoreDetail.score, <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>再推荐几篇比较好的文章 <a href="http://lxw1234.com/archives/2015/07/358.htm" target="_blank" rel="external">LXW的大数据田地: combineByKey</a><br> 推荐图书快速大数据分析中combineByKey的讲解</p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-5.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-5.html" title="spark RDD算子（五）之键值对聚合操作 combineByKey">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/5.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    
        <!-- 文章 -->
<article class="post">
    <header>
        <!-- 标签这有且只能显示一个 -->
        
        <a class="cat-link" href="/categories/hadoop/">大数据</a>
        
        <!-- 文章标题 -->
        
    <h3 class="post-title">
    	<a href="http://localhost:4000/hadoop/spark/spark-rdd-4.html">
    		spark RDD算子（四）之创建键值对RDD mapToPair flatMapToPair
    	</a>
    </h3>

    </header>
    <p class="post-meta">
        kaishun 发表于
        <time datetime="2017-03-04T13:25:21.000Z">2017-03-04</time>
        &nbsp;&nbsp;
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/spark/" title="spark">spark</a>
    

        </span>
    </p>

    <div class="post-content">
        <div class="post-excerpt">
            
                <h1 id="mapToPair"><a href="#mapToPair" class="headerlink" title="mapToPair"></a><strong>mapToPair</strong></h1><p>举例，在F:\sparktest\sample.txt 文件的内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">aa bb cc aa aa aa dd dd ee ee ee ee </div><div class="line">ff aa bb zks</div><div class="line">ee kks</div><div class="line">ee  zz zks</div><div class="line">``` </div><div class="line">将每一行的第一个单词作为键，1 作为value创建pairRDD</div><div class="line">**scala版本**  </div><div class="line">scala是没有mapToPair函数的，scala版本只需要map就可以了</div><div class="line">```scala</div><div class="line">    scala&gt; val lines = sc.textFile(&quot;F:\\sparktest\\sample.txt&quot;)</div><div class="line">    </div><div class="line">    scala&gt; val pairs = lines.map(x =&gt; (x.split(&quot;\\s+&quot;)(0), 1))</div><div class="line">    </div><div class="line">    scala&gt; pairs.collect</div><div class="line">    res0: Array[(String, Int)] = Array((aa,1), (ff,1), (ee,1), (ee,1))</div></pre></td></tr></table></figure></p>
<p><strong>java版本</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">JavaRDD&lt;String&gt; lines = sc.textFile(<span class="string">"F:\\sparktest\\sample.txt"</span>);</div><div class="line"><span class="comment">//输入的是一个string的字符串，输出的是一个(String, Integer) 的map</span></div><div class="line">JavaPairRDD&lt;String, Integer&gt; pairRDD = lines.mapToPair(<span class="keyword">new</span> PairFunction&lt;String, String, Integer&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;String, Integer&gt; <span class="title">call</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;String, Integer&gt;(s.split(<span class="string">"\\s+"</span>)[<span class="number">0</span>], <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h1 id="flatMapToPair"><a href="#flatMapToPair" class="headerlink" title="flatMapToPair"></a><strong>flatMapToPair</strong></h1><p>类似于xxx连接  mapToPair是一对一，一个元素返回一个元素，而flatMapToPair可以一个元素返回多个，相当于先flatMap,在mapToPair<br>例子: 将每一个单词都分成键为<br><strong>scala版本</strong><br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> lines = sc.textFile(<span class="string">"F:\\sparktest\\sample.txt"</span>)</div><div class="line"><span class="keyword">val</span> flatRDD = lines.flatMap(x =&gt; (x.split(<span class="string">"\\s+"</span>)))</div><div class="line"><span class="keyword">val</span> pairs = flatRDD.map(x=&gt;(x,<span class="number">1</span>))</div><div class="line"></div><div class="line">scala&gt; pairs.collect</div><div class="line">res1: <span class="type">Array</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">Array</span>((aa,<span class="number">1</span>), (bb,<span class="number">1</span>), (cc,<span class="number">1</span>), (aa,<span class="number">1</span>), (aa,<span class="number">1</span>), (aa,<span class="number">1</span>), (dd,<span class="number">1</span>), (dd,<span class="number">1</span>), (ee,<span class="number">1</span>), (ee,<span class="number">1</span>), (ee,<span class="number">1</span>), (ee,<span class="number">1</span>), (ff,<span class="number">1</span>), (aa,<span class="number">1</span>), (bb,<span class="number">1</span>), (zks,<span class="number">1</span>), (ee,<span class="number">1</span>), (kks,<span class="number">1</span>), (ee,<span class="number">1</span>), (zz,<span class="number">1</span>), (zks,<span class="number">1</span>))</div></pre></td></tr></table></figure></p>
<p><strong>java版本 spark2.0以下</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">JavaPairRDD&lt;String, Integer&gt; wordPairRDD = lines.flatMapToPair(<span class="keyword">new</span> PairFlatMapFunction&lt;String, String, Integer&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> Iterable&lt;Tuple2&lt;String, Integer&gt;&gt; call(String s) <span class="keyword">throws</span> Exception &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt; tpLists = <span class="keyword">new</span> ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt;();</div><div class="line">                String[] split = s.split(<span class="string">"\\s+"</span>);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;split.length ; i++) &#123;</div><div class="line">                    Tuple2 tp = <span class="keyword">new</span> Tuple2&lt;String,Integer&gt;(split[i], <span class="number">1</span>);</div><div class="line">                    tpLists.add(tp);</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">return</span> tpLists;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">```  </div><div class="line">**java版本 spark2.0以上**</div><div class="line">主要是iterator和iteratable的一些区别</div><div class="line">```java</div><div class="line">        JavaPairRDD&lt;String, Integer&gt; wordPairRDD = lines.flatMapToPair(<span class="keyword">new</span> PairFlatMapFunction&lt;String, String, Integer&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> Iterator&lt;Tuple2&lt;String, Integer&gt;&gt; call(String s) <span class="keyword">throws</span> Exception &#123;</div><div class="line">                ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt; tpLists = <span class="keyword">new</span> ArrayList&lt;Tuple2&lt;String, Integer&gt;&gt;();</div><div class="line">                String[] split = s.split(<span class="string">"\\s+"</span>);</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;split.length ; i++) &#123;</div><div class="line">                    Tuple2 tp = <span class="keyword">new</span> Tuple2&lt;String,Integer&gt;(split[i], <span class="number">1</span>);</div><div class="line">                    tpLists.add(tp);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> tpLists.iterator();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure></p>

            
            <p class="more">
                <a href="http://localhost:4000/hadoop/spark/spark-rdd-4.html">阅读剩下更多</a>
            </p>
        </div>
        <div class="post-thumbnail" data-img="">
            <a href="http://localhost:4000/hadoop/spark/spark-rdd-4.html" title="spark RDD算子（四）之创建键值对RDD mapToPair flatMapToPair">
                
                    <img class="thumbnail" src="/img/default.png" data-echo="/img/thumbnail/4.jpg" alt="默认配图" >
                
            </a>
        </div>
    </div>
</article>

    

    
    <nav class="page-navigator">
        <a class="extend prev" rel="prev" href="/">前一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">后一页</a>
    </nav>
    




            </div>

        </section>
        <!-- 侧栏部分 -->
<aside class="sidebar">
    <section class="widget">
        <h3 class="widget-hd"><strong>文章分类</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
    <li>
        <a href="/categories/hadoop/">大数据</a>
        <span class="badge">(33)</span>
    </li>
    
    <li>
        <a href="/categories/hadoop/hdfs/">hdfs</a>
        <span class="badge">(8)</span>
    </li>
    
    <li>
        <a href="/categories/hadoop/hadoop/">hadoop</a>
        <span class="badge">(9)</span>
    </li>
    
    <li>
        <a href="/categories/Linux/">Linux</a>
        <span class="badge">(2)</span>
    </li>
    
    <li>
        <a href="/categories/programme/">programme</a>
        <span class="badge">(6)</span>
    </li>
    
    <li>
        <a href="/categories/hadoop/spark/">spark</a>
        <span class="badge">(16)</span>
    </li>
    
    <li>
        <a href="/categories/再测试sss/">再测试sss</a>
        <span class="badge">(0)</span>
    </li>
    
    <li>
        <a href="/categories/随笔/">随笔</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="/categories/测试一下目录/">测试一下目录</a>
        <span class="badge">(1)</span>
    </li>
    
    <li>
        <a href="/categories/测试一下目录/hadoop/">大数据</a>
        <span class="badge">(1)</span>
    </li>
    
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-hd"><strong>热门标签</strong></h3>
        <!-- 文章标签 -->
<div class="widget-bd tag-wrap">
  
    <a class="tag-item" href="/tags/hdfs/" title="hdfs">hdfs (8)</a>
  
    <a class="tag-item" href="/tags/hadoop/" title="hadoop">hadoop (9)</a>
  
    <a class="tag-item" href="/tags/linux/" title="linux">linux (2)</a>
  
    <a class="tag-item" href="/tags/crontab/" title="crontab">crontab (1)</a>
  
    <a class="tag-item" href="/tags/java/" title="java">java (3)</a>
  
    <a class="tag-item" href="/tags/JDBC/" title="JDBC">JDBC (1)</a>
  
    <a class="tag-item" href="/tags/工具类/" title="工具类">工具类 (1)</a>
  
    <a class="tag-item" href="/tags/spark/" title="spark">spark (16)</a>
  
    <a class="tag-item" href="/tags/npm/" title="npm">npm (0)</a>
  
    <a class="tag-item" href="/tags/hexo/" title="hexo">hexo (0)</a>
  
    <a class="tag-item" href="/tags/github/" title="github">github (0)</a>
  
    <a class="tag-item" href="/tags/tags1/" title="tags1">tags1 (0)</a>
  
    <a class="tag-item" href="/tags/tags2/" title="tags2">tags2 (0)</a>
  
    <a class="tag-item" href="/tags/scala/" title="scala">scala (3)</a>
  
    <a class="tag-item" href="/tags/曲线拟合/" title="曲线拟合">曲线拟合 (1)</a>
  
    <a class="tag-item" href="/tags/随笔/" title="随笔">随笔 (1)</a>
  
    <a class="tag-item" href="/tags/标签1/" title="标签1">标签1 (1)</a>
  
    <a class="tag-item" href="/tags/标签2/" title="标签2">标签2 (1)</a>
  
    <a class="tag-item" href="/tags/Exception/" title="Exception">Exception (1)</a>
  
</div>
    </section>
    

    

    
    <!-- 友情链接 -->
    <section class="widget">
        <h3 class="widget-hd"><strong>友情链接</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
        <li>
            <a href="http://blog.sina.com.cn/u/1825875765" target="_blank" title="网络安全博客">Haoren博客</a>
        </li>
    
        <li>
            <a href="http://blog.csdn.net/yeweiouyang" target="_blank" title="技术博客">Maxwell博客</a>
        </li>
    
        <li>
            <a href="http://xuanzh.cc/" target="_blank" title="技术博客">朱旋个人博客</a>
        </li>
    
</ul>
    </section>
    
</aside>
<!-- / 侧栏部分 -->
    </div>

    <!-- 博客底部 -->
    <footer class="footer">
    &copy;
    
        2016-2018
    

    <a href="/">Jelon Loves You</a>
</footer>
<div class="back-to-top" id="JELON__backToTop" title="返回顶部">返回顶部</div>

    <!--博客js脚本 -->
    <!-- 这里放网站js脚本 -->
<script src="/js/main.js"></script>
</body>
</html>